=
;C:\work\BSUIR\crypto-wallet\Backend\Services\UserService.cs∙	
>C:\work\BSUIR\crypto-wallet\Backend\Services\ServiceService.cs
	namespace 	
UP
 
. 

Migrations 
. 
Services  
;  !
public 
class 
ServiceService 
: 
IServiceService -
{ 
private		 
readonly		 
IDbRepository		 "
_repository		# .
;		. /
public 

ServiceService 
( 
IDbRepository '

repository( 2
)2 3
{ 
_repository 
= 

repository  
;  !
} 
public 

Task 
< 
IEnumerable 
< 
Service #
># $
>$ %
GetServices& 1
(1 2
)2 3
{ 
return 
Task 
. 

FromResult 
< 
IEnumerable *
<* +
Service+ 2
>2 3
>3 4
(4 5
_repository5 @
.@ A
GetAllA G
<G H
ServiceH O
>O P
(P Q
)Q R
)R S
;S T
} 
} I
GC:\work\BSUIR\crypto-wallet\Backend\Services\Interfaces\IUserService.csй
JC:\work\BSUIR\crypto-wallet\Backend\Services\Interfaces\IServiceService.cs
	namespace 	
UP
 
. 

Migrations 
. 
Services  
.  !

Interfaces! +
;+ ,
public 
	interface 
IServiceService  
{ 
public 

Task 
< 
IEnumerable 
< 
Service #
># $
>$ %
GetServices& 1
(1 2
)2 3
;3 4
} ▓

HC:\work\BSUIR\crypto-wallet\Backend\Services\Interfaces\IEmailService.cs
	namespace 	
UP
 
. 
Services 
. 

Interfaces  
;  !
public 
	interface 
IEmailService 
{ 
public 

Task  
SendVerificationCode $
($ %
Guid% )
id* ,
), -
;- .
public

 

Task

 
VerifyEmail

 
(

 
VerifyEmailRequest

 .
request

/ 6
)

6 7
;

7 8
public 

Task 
RestorePassword 
(  "
RestorePasswordRequest  6
request7 >
)> ?
;? @
public 

Task 
SendMessageBlock  
(  !
SendMessageRequest! 3
request4 ;
); <
;< =
public 

Task -
!SendEmailMessageTransactionsAsync 1
(1 2
Guid2 6
id7 9
,9 :
string; A
coinNameB J
,J K
doubleL R
quantityS [
,[ \
bool 
isGet 
, 
Guid 

recieverId #
)# $
;$ %
} В
KC:\work\BSUIR\crypto-wallet\Backend\Services\Interfaces\ICurrencyService.cs
	namespace 	
UP
 
. 
Services 
. 

Interfaces  
;  !
public 
	interface 
ICurrencyService !
{ 
public 

void 
AddIfNotExists 
( 
string %
coinShortName& 3
,3 4
double5 ;
price< A
)A B
;B C
} є
GC:\work\BSUIR\crypto-wallet\Backend\Services\Interfaces\IAuthService.cs
	namespace 	
UP
 
. 
Services 
. 

Interfaces  
;  !
public 
	interface 
IAuthService 
{ 
public 

Task 
< 
AuthResponse 
> 
GetTokenAsync +
(+ ,
string, 2
email3 8
)8 9
;9 :
}		 ун
<C:\work\BSUIR\crypto-wallet\Backend\Services\EmailService.cs
	namespace 	
UP
 
. 
Services 
; 
public 
class 
EmailService 
: 
IEmailService )
{ 
private 
readonly 
IDbRepository "
_dbRepository# 0
;0 1
public 

EmailService 
( 
IDbRepository %
dbRepository& 2
)2 3
{ 
_dbRepository 
= 
dbRepository $
;$ %
} 
public 

async 
Task 
VerifyEmail !
(! "
VerifyEmailRequest" 4
request5 <
)< =
{ 
if 

( 
request 
. 
Code 
== 
null  
)  !
throw" '
new( +#
EntityNotFoundException, C
(C D
$strD X
)X Y
;Y Z
var 
code 
= 
await 
_dbRepository &
.& '
Get' *
<* +&
EmailVerificationCodeModel+ E
>E F
(F G
)G H
. 
FirstOrDefaultAsync  
(  !
x! "
=># %
x& '
.' (
UserId( .
==/ 1
request2 9
.9 :
Id: <
)< =
;= >
if 

( 
code 
== 
null 
) 
throw 
new  ##
EntityNotFoundException$ ;
(; <
$str< H
)H I
;I J
if   

(   
code   
.   
Code   
!=   
request    
.    !
Code  ! %
)  % &
throw  ' ,
new  - 0#
AuthenticationException  1 H
(  H I
$str  I U
)  U V
;  V W
await!!  
DeleteEmailCodeAsync!! "
(!!" #
request!!# *
.!!* +
Id!!+ -
)!!- .
;!!. /
}"" 
private$$ 
async$$ 
Task$$  
DeleteEmailCodeAsync$$ +
($$+ ,
Guid$$, 0
id$$1 3
)$$3 4
{%% 
var&& 
code&& 
=&& 
await&& 
_dbRepository&& &
.&&& '
Get&&' *
<&&* +&
EmailVerificationCodeModel&&+ E
>&&E F
(&&F G
)&&G H
.&&H I
FirstOrDefaultAsync&&I \
(&&\ ]
x&&] ^
=>&&_ a
x&&b c
.&&c d
UserId&&d j
==&&k m
id&&n p
)&&p q
;&&q r
if'' 

('' 
code'' 
=='' 
null'' 
)'' 
throw'' 
new''  ##
EntityNotFoundException''$ ;
(''; <
$str''< L
)''L M
;''M N
code(( 
.(( 

IsApproved(( 
=(( 
true(( 
;(( 
code)) 
.)) 
DateUpdated)) 
=)) 
DateTime)) #
.))# $
UtcNow))$ *
;))* +
await** 
_dbRepository** 
.** 
SaveChangesAsync** ,
(**, -
)**- .
;**. /
}++ 
public-- 

async-- 
Task--  
SendVerificationCode-- *
(--* +
Guid--+ /
id--0 2
)--2 3
{.. 
var// 
existedCode// 
=// 
await00 
_dbRepository00 
.00  
Get00  #
<00# $&
EmailVerificationCodeModel00$ >
>00> ?
(00? @
)00@ A
.00A B
FirstOrDefaultAsync00B U
(00U V
x00V W
=>00X Z
x00[ \
.00\ ]
UserId00] c
==00d f
id00g i
)00i j
;00j k
var11 
random11 
=11 
new11 
Random11 
(11  
)11  !
;11! "
var22 
code22 
=22 
random22 
.22 
Next22 
(22 
$num22 #
,22# $
$num22% )
)22) *
.22* +
ToString22+ 3
(223 4
)224 5
;225 6
if33 

(33 
existedCode33 
!=33 
null33 
)33  
{44 	
existedCode55 
.55 
Code55 
=55 
code55 #
;55# $
existedCode66 
.66 
DateUpdated66 #
=66$ %
DateTime66& .
.66. /
UtcNow66/ 5
;665 6
await77 
_dbRepository77 
.77  
SaveChangesAsync77  0
(770 1
)771 2
;772 3
await88 %
SendVerificationCodeAsync88 +
(88+ ,
id88, .
,88. /
code880 4
)884 5
;885 6
return99 
;99 
}:: 	
var;; 
user;; 
=;; 
await;; 
_dbRepository;; &
.;;& '
Get;;' *
<;;* +
User;;+ /
>;;/ 0
(;;0 1
x;;1 2
=>;;3 5
x;;6 7
.;;7 8
Id;;8 :
==;;; =
id;;> @
);;@ A
.;;A B
FirstOrDefaultAsync;;B U
(;;U V
);;V W
;;;W X
if<< 

(<< 
user<< 
==<< 
null<< 
)<< 
throw== 
new== "
IncorrectDataException== ,
(==, -
$str==- E
)==E F
;==F G
var?? 
entity?? 
=?? 
new?? &
EmailVerificationCodeModel?? 3
{@@ 	
IdAA 
=AA 
GuidAA 
.AA 
NewGuidAA 
(AA 
)AA 
,AA  
EmailBB 
=BB 
userBB 
.BB 
EmailBB 
,BB 
UserIdCC 
=CC 
userCC 
.CC 
IdCC 
,CC 
CodeDD 
=DD 
codeDD 
,DD 
DateCreatedEE 
=EE 
DateTimeEE "
.EE" #
UtcNowEE# )
,EE) *
}FF 	
;FF	 

varGG 
resultGG 
=GG 
awaitGG 
_dbRepositoryGG (
.GG( )
AddGG) ,
(GG, -
entityGG- 3
)GG3 4
;GG4 5
awaitHH 
_dbRepositoryHH 
.HH 
SaveChangesAsyncHH ,
(HH, -
)HH- .
;HH. /
awaitII %
SendVerificationCodeAsyncII '
(II' (
idII( *
,II* +
codeII, 0
)II0 1
;II1 2
}JJ 
privateLL 
asyncLL 
TaskLL %
SendVerificationCodeAsyncLL 0
(LL0 1
GuidLL1 5
idLL6 8
,LL8 9
stringLL: @
codeLLA E
)LLE F
{MM 
varNN 
userNN 
=NN 
awaitNN 
_dbRepositoryNN &
.NN& '
GetNN' *
<NN* +
UserNN+ /
>NN/ 0
(NN0 1
xNN1 2
=>NN3 5
xNN6 7
.NN7 8
IdNN8 :
==NN; =
idNN> @
)NN@ A
.NNA B
FirstOrDefaultAsyncNNB U
(NNU V
)NNV W
;NNW X
ifOO 

(OO 
userOO 
==OO 
nullOO 
)OO 
throwPP 
newPP "
IncorrectDataExceptionPP ,
(PP, -
$strPP- E
)PPE F
;PPF G
varRR 
mmRR 
=RR 
newRR 
MailMessageRR  
(RR  !
)RR! "
;RR" #
varSS 
scSS 
=SS 
newSS 

SmtpClientSS 
(SS  
$strSS  0
)SS0 1
;SS1 2
mmTT 

.TT
 
FromTT 
=TT 
newTT 
MailAddressTT !
(TT! "
$strTT" @
)TT@ A
;TTA B
ifUU 

(UU 
userUU 
.UU 
EmailUU 
!=UU 
nullUU 
)UU 
mmVV 
.VV 
ToVV 
.VV 
AddVV 
(VV 
userVV 
.VV 
EmailVV  
)VV  !
;VV! "
mmWW 

.WW
 
SubjectWW 
=WW 
$strWW 5
;WW5 6
mmXX 

.XX
 
BodyXX 
=XX 
$$"""
XY
$strYu Ж
{{
uuЖ И
code
uuИ М
}}
uuМ О
$str	uzО $

                    """z{ 
;{{ 
mm}} 

.}}
 

IsBodyHtml}} 
=}} 
true}} 
;}} 
sc~~ 

.~~
 
Port~~ 
=~~ 
$num~~ 
;~~ 
sc 

.
 
Credentials 
= 
new 
NetworkCredential .
(. /
$str/ M
,M N
$strO d
)d e
;e f
sc
АА 

.
АА
 
	EnableSsl
АА 
=
АА 
true
АА 
;
АА 
await
ВВ 
sc
ВВ 
.
ВВ 
SendMailAsync
ВВ 
(
ВВ 
mm
ВВ !
)
ВВ! "
;
ВВ" #
}
ГГ 
private
ЖЖ 
static
ЖЖ 
async
ЖЖ 
Task
ЖЖ *
SendRestorePasswordCodeAsync
ЖЖ :
(
ЖЖ: ;
string
ЖЖ; A
email
ЖЖB G
,
ЖЖG H
string
ЖЖI O
code
ЖЖP T
)
ЖЖT U
{
ЗЗ 
var
ИИ 
mm
ИИ 
=
ИИ 
new
ИИ 
MailMessage
ИИ  
(
ИИ  !
)
ИИ! "
;
ИИ" #
var
ЙЙ 
sc
ЙЙ 
=
ЙЙ 
new
ЙЙ 

SmtpClient
ЙЙ 
(
ЙЙ  
$str
ЙЙ  0
)
ЙЙ0 1
;
ЙЙ1 2
mm
КК 

.
КК
 
From
КК 
=
КК 
new
КК 
MailAddress
КК !
(
КК! "
$str
КК" @
)
КК@ A
;
ККA B
mm
ЛЛ 

.
ЛЛ
 
To
ЛЛ 
.
ЛЛ 
Add
ЛЛ 
(
ЛЛ 
email
ЛЛ 
)
ЛЛ 
;
ЛЛ 
mm
ММ 

.
ММ
 
Subject
ММ 
=
ММ 
$str
ММ 4
;
ММ4 5
mm
НН 

.
НН
 
Body
НН 
=
НН 
code
НН 
;
НН 
mm
ОО 

.
ОО
 

IsBodyHtml
ОО 
=
ОО 
true
ОО 
;
ОО 
sc
ПП 

.
ПП
 
Port
ПП 
=
ПП 
$num
ПП 
;
ПП 
sc
РР 

.
РР
 
Credentials
РР 
=
РР 
new
РР 
NetworkCredential
РР .
(
РР. /
$str
РР/ M
,
РРM N
$str
РРO d
)
РРd e
;
РРe f
sc
СС 

.
СС
 
	EnableSsl
СС 
=
СС 
true
СС 
;
СС 
await
УУ 
sc
УУ 
.
УУ 
SendMailAsync
УУ 
(
УУ 
mm
УУ !
)
УУ! "
;
УУ" #
}
ФФ 
private
ЦЦ 
static
ЦЦ 
bool
ЦЦ 
IsEmailValid
ЦЦ $
(
ЦЦ$ %
string
ЦЦ% +
email
ЦЦ, 1
)
ЦЦ1 2
{
ЧЧ 
if
ШШ 

(
ШШ 
email
ШШ 
.
ШШ 
Length
ШШ 
>
ШШ 
$num
ШШ 
)
ШШ 
throw
ШШ  %
new
ШШ& )$
IncorrectDataException
ШШ* @
(
ШШ@ A
$str
ШШA T
)
ШШT U
;
ШШU V
const
ЩЩ 
string
ЩЩ 
regex
ЩЩ 
=
ЩЩ 
$str
ЩЩ D
;
ЩЩD E
return
ЪЪ 
Regex
ЪЪ 
.
ЪЪ 
IsMatch
ЪЪ 
(
ЪЪ 
email
ЪЪ "
,
ЪЪ" #
regex
ЪЪ$ )
,
ЪЪ) *
RegexOptions
ЪЪ+ 7
.
ЪЪ7 8

IgnoreCase
ЪЪ8 B
)
ЪЪB C
;
ЪЪC D
}
ЫЫ 
public
ЭЭ 

async
ЭЭ 
Task
ЭЭ 
RestorePassword
ЭЭ %
(
ЭЭ% &$
RestorePasswordRequest
ЭЭ& <
request
ЭЭ= D
)
ЭЭD E
{
ЮЮ 
if
ЯЯ 

(
ЯЯ 
request
ЯЯ 
.
ЯЯ 
NewPassword
ЯЯ 
==
ЯЯ  "
null
ЯЯ# '
)
ЯЯ' (
throw
ЯЯ) .
new
ЯЯ/ 2$
IncorrectDataException
ЯЯ3 I
(
ЯЯI J
$str
ЯЯJ ]
)
ЯЯ] ^
;
ЯЯ^ _
if
аа 

(
аа 
request
аа 
.
аа 
NewPassword
аа 
.
аа  
Length
аа  &
>
аа' (
$num
аа) +
)
аа+ ,
throw
бб 
new
бб $
IncorrectDataException
бб ,
(
бб, -
$str
бб- Y
)
ббY Z
;
ббZ [
if
вв 

(
вв 
request
вв 
.
вв 
NewPassword
вв 
.
вв  
Length
вв  &
<
вв' (
$num
вв) *
)
вв* +
throw
гг 
new
гг $
IncorrectDataException
гг ,
(
гг, -
$str
гг- W
)
ггW X
;
ггX Y
var
дд 
existedCode
дд 
=
дд 
await
ее 
_dbRepository
ее 
.
ее  
Get
ее  #
<
ее# $(
EmailVerificationCodeModel
ее$ >
>
ее> ?
(
ее? @
)
ее@ A
.
ееA B!
FirstOrDefaultAsync
ееB U
(
ееU V
x
ееV W
=>
ееX Z
x
ее[ \
.
ее\ ]
UserId
ее] c
==
ееd f
request
ееg n
.
ееn o
UserId
ееo u
)
ееu v
;
ееv w
if
жж 

(
жж
 
existedCode
жж 
?
жж 
.
жж 

IsApproved
жж "
==
жж# %
false
жж& +
)
жж+ ,
throw
зз 
new
зз $
IncorrectDataException
зз ,
(
зз, -
$str
зз- C
)
ззC D
;
ззD E
var
йй 
userToUpdate
йй 
=
йй 
await
йй  
_dbRepository
йй! .
.
йй. /
Get
йй/ 2
<
йй2 3
User
йй3 7
>
йй7 8
(
йй8 9
)
йй9 :
.
кк !
FirstOrDefaultAsync
кк  
(
кк  !
x
кк! "
=>
кк# %
x
кк& '
.
кк' (
Id
кк( *
==
кк+ -
request
кк. 5
.
кк5 6
UserId
кк6 <
)
кк< =
;
кк= >
if
лл 

(
лл 
userToUpdate
лл 
==
лл 
null
лл  
)
лл  !
throw
мм 
new
мм %
EntityNotFoundException
мм -
(
мм- .
$str
мм. >
)
мм> ?
;
мм? @
userToUpdate
оо 
.
оо 
Password
оо 
=
оо 
HashHandler
оо  +
.
оо+ ,
HashPassword
оо, 8
(
оо8 9
request
оо9 @
.
оо@ A
NewPassword
ооA L
,
ооL M
userToUpdate
ооN Z
.
ооZ [
Salt
оо[ _
)
оо_ `
;
оо` a
await
пп 
_dbRepository
пп 
.
пп 
Remove
пп "
(
пп" #
existedCode
пп# .
)
пп. /
;
пп/ 0
await
░░ 
_dbRepository
░░ 
.
░░ 
SaveChangesAsync
░░ ,
(
░░, -
)
░░- .
;
░░. /
}
▒▒ 
public
││ 

async
││ 
Task
││ 
SendMessageBlock
││ &
(
││& ' 
SendMessageRequest
││' 9
request
││: A
)
││A B
{
┤┤ 
var
╡╡ 
user
╡╡ 
=
╡╡ 
await
╡╡ 
_dbRepository
╡╡ &
.
╡╡& '
Get
╡╡' *
<
╡╡* +
User
╡╡+ /
>
╡╡/ 0
(
╡╡0 1
x
╡╡1 2
=>
╡╡3 5
x
╡╡6 7
.
╡╡7 8
Id
╡╡8 :
==
╡╡; =
request
╡╡> E
.
╡╡E F
UserId
╡╡F L
)
╡╡L M
.
╡╡M N!
FirstOrDefaultAsync
╡╡N a
(
╡╡a b
)
╡╡b c
;
╡╡c d
if
╢╢ 

(
╢╢ 
user
╢╢ 
==
╢╢ 
null
╢╢ 
)
╢╢ 
throw
╖╖ 
new
╖╖ $
IncorrectDataException
╖╖ ,
(
╖╖, -
$str
╖╖- E
)
╖╖E F
;
╖╖F G
var
╣╣ 
mm
╣╣ 
=
╣╣ 
new
╣╣ 
MailMessage
╣╣  
(
╣╣  !
)
╣╣! "
;
╣╣" #
var
║║ 
sc
║║ 
=
║║ 
new
║║ 

SmtpClient
║║ 
(
║║  
$str
║║  0
)
║║0 1
;
║║1 2
mm
╗╗ 

.
╗╗
 
From
╗╗ 
=
╗╗ 
new
╗╗ 
MailAddress
╗╗ !
(
╗╗! "
$str
╗╗" @
)
╗╗@ A
;
╗╗A B
mm
╝╝ 

.
╝╝
 
To
╝╝ 
.
╝╝ 
Add
╝╝ 
(
╝╝ 
user
╝╝ 
.
╝╝ 
Email
╝╝ 
!
╝╝ 
)
╝╝ 
;
╝╝ 
mm
╜╜ 

.
╜╜
 
Subject
╜╜ 
=
╜╜ 
$str
╜╜ 
;
╜╜ 
mm
┐┐ 

.
┐┐
 
Body
┐┐ 
=
┐┐ 
$@"
┐┐ 
$str
┐┘ 
{
┘┘ 
request
┘┘ 
.
┘┘ 
Message
┘┘ #
}
┘┘# $
$str
┘▐$ 
"
▐▐ 
;
▐▐ 
mm
рр 

.
рр
 

IsBodyHtml
рр 
=
рр 
true
рр 
;
рр 
sc
сс 

.
сс
 
Port
сс 
=
сс 
$num
сс 
;
сс 
sc
тт 

.
тт
 
Credentials
тт 
=
тт 
new
тт 
NetworkCredential
тт .
(
тт. /
$str
тт/ M
,
ттM N
$str
ттO d
)
ттd e
;
ттe f
sc
уу 

.
уу
 
	EnableSsl
уу 
=
уу 
true
уу 
;
уу 
await
хх 
sc
хх 
.
хх 
SendMailAsync
хх 
(
хх 
mm
хх !
)
хх! "
;
хх" #
}
цц 
public
чч 

async
чч 
Task
чч /
!SendEmailMessageTransactionsAsync
чч 7
(
чч7 8
Guid
чч8 <
id
чч= ?
,
чч? @
string
ччA G
coinName
ччH P
,
ччP Q
double
ччR X
quantity
ччY a
,
ччa b
bool
ччc g
isGet
ччh m
,
ччm n
Guid
ччo s

recieverId
ччt ~
)
чч~ 
{
шш 
var
щщ 
user
щщ 
=
щщ 
await
щщ 
_dbRepository
щщ &
.
щщ& '
Get
щщ' *
<
щщ* +
User
щщ+ /
>
щщ/ 0
(
щщ0 1
x
щщ1 2
=>
щщ3 5
x
щщ6 7
.
щщ7 8
Id
щщ8 :
==
щщ; =
id
щщ> @
)
щщ@ A
.
щщA B!
FirstOrDefaultAsync
щщB U
(
щщU V
)
щщV W
;
щщW X
if
ъъ 

(
ъъ 
user
ъъ 
==
ъъ 
null
ъъ 
)
ъъ 
throw
ыы 
new
ыы $
IncorrectDataException
ыы ,
(
ыы, -
$str
ыы- E
)
ыыE F
;
ыыF G
var
ээ 
mm
ээ 
=
ээ 
new
ээ 
MailMessage
ээ  
(
ээ  !
)
ээ! "
;
ээ" #
var
юю 
sc
юю 
=
юю 
new
юю 

SmtpClient
юю 
(
юю  
$str
юю  0
)
юю0 1
;
юю1 2
mm
яя 

.
яя
 
From
яя 
=
яя 
new
яя 
MailAddress
яя !
(
яя! "
$str
яя" @
)
яя@ A
;
яяA B
mm
ЁЁ 

.
ЁЁ
 
To
ЁЁ 
.
ЁЁ 
Add
ЁЁ 
(
ЁЁ 
user
ЁЁ 
.
ЁЁ 
Email
ЁЁ 
!
ЁЁ 
)
ЁЁ 
;
ЁЁ 
mm
ёё 

.
ёё
 
Subject
ёё 
=
ёё 
$str
ёё 
;
ёё 
var
єє 
transactionType
єє 
=
єє 
isGet
єє #
?
єє$ %
$str
єє& >
:
єє? @
$str
єєA \
;
єє\ ]
mm
ЎЎ 

.
ЎЎ
 
Body
ЎЎ 
=
ЎЎ 
$@"
ЎЎ 
$str
ЎР 
{
РР 
transactionType
РР #
}
РР# $
$str
РР$ %
{
РР% &
quantity
РР& .
}
РР. /
$str
РР/ 0
{
РР0 1
coinName
РР1 9
}
РР9 :
$str
РР: F
{
РРF G

recieverId
РРG Q
}
РРQ R
$str
РЦR 
"
ЦЦ 
;
ЦЦ 
mm
ШШ 

.
ШШ
 

IsBodyHtml
ШШ 
=
ШШ 
true
ШШ 
;
ШШ 
sc
ЩЩ 

.
ЩЩ
 
Port
ЩЩ 
=
ЩЩ 
$num
ЩЩ 
;
ЩЩ 
sc
ЪЪ 

.
ЪЪ
 
Credentials
ЪЪ 
=
ЪЪ 
new
ЪЪ 
NetworkCredential
ЪЪ .
(
ЪЪ. /
$str
ЪЪ/ M
,
ЪЪM N
$str
ЪЪO d
)
ЪЪd e
;
ЪЪe f
sc
ЫЫ 

.
ЫЫ
 
	EnableSsl
ЫЫ 
=
ЫЫ 
true
ЫЫ 
;
ЫЫ 
await
ЭЭ 
sc
ЭЭ 
.
ЭЭ 
SendMailAsync
ЭЭ 
(
ЭЭ 
mm
ЭЭ !
)
ЭЭ! "
;
ЭЭ" #
}
ЮЮ 
}ЯЯ ╤
?C:\work\BSUIR\crypto-wallet\Backend\Services\CurrencyService.cs
	namespace 	
UP
 
. 
Services 
; 
public		 
class		 
CurrencyService		 
:		 
ICurrencyService		 /
{

 
private 
readonly 
IDbRepository "
_dbRepository# 0
;0 1
public 

CurrencyService 
( 
IDbRepository (
dbRepository) 5
)5 6
{ 
_dbRepository 
= 
dbRepository $
;$ %
} 
public 

async 
void 
AddIfNotExists $
($ %
string% +
coinShortName, 9
,9 :
double; A
priceB G
)G H
{ 
try 
{ 	
var 
coin 
= 
await 
_dbRepository *
.* +
Get+ .
<. /
CoinListInfo/ ;
>; <
(< =
)= >
. 
FirstOrDefaultAsync $
($ %
c% &
=>' )
c* +
.+ ,
	ShortName, 5
.5 6
ToLower6 =
(= >
)> ?
==@ B
coinShortNameC P
.P Q
ToLowerQ X
(X Y
)Y Z
)Z [
;[ \
if 
( 
coin 
== 
null 
) 
throw 
new #
EntityNotFoundException 1
(1 2
$"2 4
$str4 I
{I J
coinShortNameJ W
}W X
$strX c
"c d
)d e
;e f
var 
currentTime 
= 
DateTime &
.& '
UtcNow' -
;- .
var 
tenMinutesAgo 
= 
currentTime  +
.+ ,

AddMinutes, 6
(6 7
-7 8
$num8 :
): ;
;; <
var 
existingPrice 
= 
_dbRepository  -
.- .
Get. 1
<1 2 
CryptoCurrencyPrices2 F
>F G
(G H
)H I
. 
FirstOrDefault 
(  
p  !
=>" $
p% &
.& '
CoinId' -
==. 0
coin1 5
.5 6
Id6 8
&&9 ;
p< =
.= >
	Timestamp> G
>=H J
tenMinutesAgoK X
)X Y
;Y Z
if!! 
(!! 
existingPrice!! 
!=!!  
null!!! %
)!!% &
return!!' -
;!!- .
var"" 
newPrice"" 
="" 
new""  
CryptoCurrencyPrices"" 3
{## 
Id$$ 
=$$ 
Guid$$ 
.$$ 
NewGuid$$ !
($$! "
)$$" #
,$$# $
CoinShortName%% 
=%% 
coinShortName%%  -
,%%- .
Price&& 
=&& 
price&& 
,&& 
	Timestamp'' 
='' 
currentTime'' '
,''' (
CoinId(( 
=(( 
coin(( 
.(( 
Id((  
})) 
;)) 
var** 
result** 
=** 
await** 
_dbRepository** ,
.**, -
Add**- 0
(**0 1
newPrice**1 9
)**9 :
;**: ;
await++ 
_dbRepository++ 
.++  
SaveChangesAsync++  0
(++0 1
)++1 2
;++2 3
},, 	
catch-- 
(-- 
	Exception-- 
e-- 
)-- 
{.. 	
}00 	
}11 
}22 ▌3
;C:\work\BSUIR\crypto-wallet\Backend\Services\AuthService.cs
	namespace 	
UP
 
. 
Services 
; 
public 
class 
AuthService 
: 
IAuthService '
{ 
private 
readonly 
IConfiguration #
_configuration$ 2
;2 3
private 
readonly 
IDbRepository "
_dbRepository# 0
;0 1
public 

AuthService 
( 
IConfiguration %
configuration& 3
,3 4
IDbRepository5 B
dbRepositoryC O
)O P
{ 
_configuration 
= 
configuration &
;& '
_dbRepository 
= 
dbRepository $
;$ %
} 
public 

async 
Task 
< 
AuthResponse "
>" #
GetTokenAsync$ 1
(1 2
AuthRequest2 =
request> E
)E F
{ 
var 
users 
= 
await 
_dbRepository '
.' (
Get( +
<+ ,
User, 0
>0 1
(1 2
)2 3
. 
Where 
( 
x 
=> 
x 
. 
Login 
==  "
request# *
.* +
Login+ 0
)0 1
.   
ToListAsync   
(   
)   
;   
var"" 
user"" 
="" 
users"" 
."" 
FirstOrDefault"" '
(""' (
x""( )
=>""* ,
x""- .
."". /
Password""/ 7
==""8 :
HashHandler""; F
.""F G
HashPassword""G S
(""S T
request""T [
.""[ \
Password""\ d
,""d e
x""f g
.""g h
Salt""h l
)""l m
)""m n
;""n o
if$$ 

($$
 
user$$ 
==$$ 
null$$ 
)$$ 
throw$$ 
new$$ "#
EntityNotFoundException$$# :
($$: ;
$str$$; R
)$$R S
;$$S T
var&& 
token&& 
=&& 
await&& 
GenerateTokenAsync&& ,
(&&, -
user&&- 1
)&&1 2
;&&2 3
return(( 
new(( 
AuthResponse(( 
{)) 	
Token** 
=** 
new** #
JwtSecurityTokenHandler** /
(**/ 0
)**0 1
.**1 2

WriteToken**2 <
(**< =
token**= B
)**B C
,**C D
UserId++ 
=++ 
user++ 
.++ 
Id++ 
,++ 
},, 	
;,,	 

}-- 
private// 
Task// 
<// 
JwtSecurityToken// !
>//! "
GenerateTokenAsync//# 5
(//5 6
User//6 :
user//; ?
)//? @
{00 
var11 
claims11 
=11 
new11 
List11 
<11 
Claim11 #
>11# $
{22 	
new33 
(33 
$str33 
,33 
user33 
.33 
Id33 
.33 
ToString33 '
(33' (
)33( )
)33) *
,33* +
new44 
(44 
$str44 
,44 
user44 
.44 
Login44 #
)44# $
,44$ %
new55 
(55 
$str55 
,55 
$str55  
)55  !
}66 	
;66	 

var88 
key88 
=88 
new88  
SymmetricSecurityKey88 *
(88* +
Encoding88+ 3
.883 4
UTF8884 8
.888 9
GetBytes889 A
(88A B
_configuration88B P
[88P Q
$str88Q Z
]88Z [
??88\ ^
string88_ e
.88e f
Empty88f k
)88k l
)88l m
;88m n
var99 
signIn99 
=99 
new99 
SigningCredentials99 +
(99+ ,
key99, /
,99/ 0
SecurityAlgorithms991 C
.99C D

HmacSha25699D N
)99N O
;99O P
return;; 
Task;; 
.;; 

FromResult;; 
(;; 
new;; "
JwtSecurityToken;;# 3
(;;3 4
_configuration<< 
[<< 
$str<< '
]<<' (
,<<( )
_configuration== 
[== 
$str== )
]==) *
,==* +
claims>> 
,>> 
expires?? 
:?? 
DateTime?? 
.?? 
UtcNow?? $
.??$ %
AddDays??% ,
(??, -
$num??- .
)??. /
,??/ 0
signingCredentials@@ 
:@@ 
signIn@@  &
)@@& '
)@@' (
;@@( )
}AA 
publicCC 

asyncCC 
TaskCC 
<CC 
AuthResponseCC "
>CC" #
GetTokenAsyncCC$ 1
(CC1 2
stringCC2 8
emailCC9 >
)CC> ?
{DD 
varEE 
userEE 
=EE 
awaitEE 
_dbRepositoryEE &
.EE& '
GetEE' *
<EE* +
UserEE+ /
>EE/ 0
(EE0 1
)EE1 2
.FF 
FirstOrDefaultAsyncFF  
(FF  !
xFF! "
=>FF# %
xFF& '
.FF' (
EmailFF( -
==FF. 0
emailFF1 6
||FF7 9
xFF: ;
.FF; <
LoginFF< A
==FFB D
emailFFE J
)FFJ K
;FFK L
ifGG 

(GG
 
userGG 
==GG 
nullGG 
)GG 
throwGG 
newGG "#
EntityNotFoundExceptionGG# :
(GG: ;
$strGG; R
)GGR S
;GGS T
varII 
tokenII 
=II 
awaitII 
GenerateTokenAsyncII ,
(II, -
userII- 1
)II1 2
;II2 3
returnKK 
newKK 
AuthResponseKK 
{LL 	
TokenMM 
=MM 
newMM #
JwtSecurityTokenHandlerMM /
(MM/ 0
)MM0 1
.MM1 2

WriteTokenMM2 <
(MM< =
tokenMM= B
)MMB C
}NN 	
;NN	 

}OO 
}PP И4
BC:\work\BSUIR\crypto-wallet\Backend\Repositories\UserRepository.cs
	namespace 	
UP
 
. 
Repositories 
; 
public		 
class		 
UserRepository		 
(		 
DataContext		 '
context		( /
,		/ 0
ICurrencyRepository		1 D
currencyRepository		E W
)		W X
:

 
RepositoryBase

 
,

 
IUserRepository

 %
{ 
public 

List 
< 
Coin 
> 
GetUserCoins "
(" #
Guid# '
userId( .
). /
{ 
var 
	userCoins 
= 
context 
.  
Users  %
. 
Where 
( 
u 
=> 
u 
. 
Id 
== 
userId  &
)& '
. 
Include 
( 
u 
=> 
u 
. 

UsersCoins &
)& '
. 
ThenInclude 
( 
uc 
=> 
uc !
.! "
Coin" &
)& '
. 

SelectMany 
( 
u 
=> 
u 
. 

UsersCoins )
.) *
Select* 0
(0 1
uc1 3
=>4 6
uc7 9
.9 :
Coin: >
)> ?
)? @
. 
ToList 
( 
) 
; 
return 
	userCoins 
; 
} 
public 

async 
Task 
< 
List 
< 
CoinsInformation +
>+ ,
>, -
GetUserCoinsFull. >
(> ?
Guid? C
userIdD J
)J K
{ 
var 
coins 
= 
await 
context 
. 

UsersCoins (
. 	
Where	 
( 
uc 
=> 
uc 
. 
UserId 
== !
userId" (
)( )
. 	
Include	 
( 
uc 
=> 
uc 
. 
Coin 
) 
. 	
Select	 
( 
uc 
=> 
new 
CoinsInformation *
{ 	
Id 
= 
uc 
. 
Coin 
. 
Id 
, 
Quantity   
=   
uc   
.   
Coin   
.   
Quantity   '
,  ' (
	ShortName!! 
=!! 
uc!! 
.!! 
Coin!! 
.!!  
	Shortname!!  )
}"" 	
)""	 

.## 	
ToListAsync##	 
(## 
)## 
;## 
var%% 
	coinsFull%%	 
=%% 
new%% 
List%% 
<%% 
CoinsInformation%% .
>%%. /
(%%/ 0
)%%0 1
;%%1 2
foreach&& 
(&& 
var&& 
coin&& 
in&& 
coins&& 
)&& 
{'' 
var(( 
temp(( 
=(( 
await(( 
currencyRepository(( +
.((+ ,"
GetFullCoinInformation((, B
(((B C
coin((C G
.((G H
	ShortName((H Q
)((Q R
;((R S
	coinsFull)) 
.)) 
Add)) 
()) 
new)) 
CoinsInformation)) *
{** 	
Id++ 
=++ 
temp++ 
.++ 
Id++ 
,++ 
	ShortName,, 
=,, 
temp,, 
.,, 
FullName,, %
,,,% &
FullName-- 
=-- 
temp-- 
.-- 
	ShortName-- %
,--% &
IconPath.. 
=.. 
temp.. 
... 
IconPath.. $
,..$ %
DailyVolume// 
=// 
temp// 
.// 
DailyVolume// *
,//* +
DailyImpact00 
=00 
temp00 
.00 
DailyImpact00 *
,00* +
Price11 
=11 
temp11 
.11 
Price11 
,11 '
PercentagePriceChangePerDay22 '
=22( )
temp22* .
.22. /'
PercentagePriceChangePerDay22/ J
,22J K
Quantity33 
=33 '
GetCoinQuantityInUserWallet33 2
(332 3
userId333 9
,339 :
temp33; ?
.33? @
FullName33@ H
)33H I
}44 	
)44	 

;44
 
}55 
return77 

	coinsFull77 
;77 
}88 
public;; 

double;; '
GetCoinQuantityInUserWallet;; -
(;;- .
Guid;;. 2
userId;;3 9
,;;9 :
string;;; A
coinShortname;;B O
);;O P
{<< 
var== 
quantity== 
=== 
context== 
.== 
Coins== $
.>> 
Join>> 
(>> 
context?? 
.?? 

UsersCoins?? "
,??" #
coin@@ 
=>@@ 
coin@@ 
.@@ 
Id@@ 
,@@  
userCoinAA 
=>AA 
userCoinAA $
.AA$ %
CoinIdAA% +
,AA+ ,
(BB 
coinBB 
,BB 
userCoinBB 
)BB  
=>BB! #
newBB$ '
{BB( )
coinBB* .
,BB. /
userCoinBB0 8
}BB9 :
)BB: ;
.CC 
WhereCC 
(CC 
joinedCC 
=>CC 
joinedCC #
.CC# $
userCoinCC$ ,
.CC, -
UserIdCC- 3
==CC4 6
userIdCC7 =
&&CC> @
joinedCCA G
.CCG H
coinCCH L
.CCL M
	ShortnameCCM V
==CCW Y
coinShortnameCCZ g
)CCg h
.DD 
SelectDD 
(DD 
joinedDD 
=>DD 
joinedDD $
.DD$ %
coinDD% )
.DD) *
QuantityDD* 2
)DD2 3
.EE 
FirstOrDefaultEE 
(EE 
)EE 
;EE 
returnGG 
quantityGG 
;GG 
}HH 
}II √U
JC:\work\BSUIR\crypto-wallet\Backend\Repositories\TransactionsRepository.cs
	namespace 	
UP
 
. 
Repositories 
; 
public		 
class		 "
TransactionsRepository		 #
(		# $
DataContext		$ /
context		0 7
,		7 8
ICurrencyRepository		9 L
currencyRepository		M _
)		_ `
:

 
RepositoryBase

 
,

 #
ITransactionsRepository

 -
{ 
public 

void ,
 WriteNewConversionDataToDatabase 0
(0 1

Conversion1 ;

conversion< F
)F G
{ 
var 
en 
= 
new 

Conversion 
{ 	
Id 
= 
Guid 
. 
NewGuid 
( 
) 
,  

Commission 
= 

conversion #
.# $

Commission$ .
,. /
BeginCoinQuantity 
= 

conversion  *
.* +
BeginCoinQuantity+ <
,< =
EndCoinQuantity 
= 

conversion (
.( )
EndCoinQuantity) 8
,8 9
QuantityUSD 
= 

conversion $
.$ %
QuantityUSD% 0
,0 1
BeginCoinShortname 
=  

conversion! +
.+ ,
BeginCoinShortname, >
,> ?
EndCoinShortname 
= 

conversion )
.) *
EndCoinShortname* :
,: ;
UserId 
= 

conversion 
.  
UserId  &
,& '
DateCreated 
= 
DateTime "
." #
UtcNow# )
} 	
;	 

context 
. 
Conversions 
. 
Add 
(  
en  "
)" #
;# $
context 
. 
SaveChanges 
( 
) 
; 
} 
public 

List 
< 

Conversion 
> %
GetUserConversionsHistory 5
(5 6
Guid6 :
userId; A
)A B
{   
var!! 
conversions!! 
=!! 
context!! !
.!!! "
Conversions!!" -
."" 
Where"" 
("" 
c"" 
=>"" 
c"" 
."" 
UserId""  
==""! #
userId""$ *
)""* +
.""+ ,
ToList"", 2
(""2 3
)""3 4
;""4 5
return$$ 
conversions$$ 
;$$ 
}%% 
public'' 

void'' 
ReplenishTheBalance'' #
(''# $
Guid''$ (
userId'') /
,''/ 0
double''1 7
quantityUsd''8 C
)''C D
{(( 
var)) 
	userCoins)) 
=)) 
context)) 
.))  

UsersCoins))  *
.** 
Include** 
(** 
uc** 
=>** 
uc** 
.** 
Coin** "
)**" #
.++ 
Where++ 
(++ 
uc++ 
=>++ 
uc++ 
.++ 
UserId++ "
==++# %
userId++& ,
)++, -
.,, 
ToList,, 
(,, 
),, 
;,, 
var.. 
existingCoin.. 
=.. 
	userCoins.. $
...$ %
FirstOrDefault..% 3
(..3 4
uc..4 6
=>..7 9
uc..: <
...< =
Coin..= A
...A B
	Shortname..B K
==..L N
$str..O U
)..U V
;..V W
if00 

(00 
existingCoin00 
!=00 
null00  
)00  !
{11 	
existingCoin22 
.22 
Coin22 
.22 
Quantity22 &
+=22' )
quantityUsd22* 5
;225 6
}33 	
else44 
{55 	
var66 
user66 
=66 
context66 
.66 
Users66 $
.66$ %
Find66% )
(66) *
userId66* 0
)660 1
;661 2
if88 
(88 
user88 
==88 
null88 
)88 
{99 
throw:: 
new:: #
EntityNotFoundException:: 1
(::1 2
$str::2 J
)::J K
;::K L
};; 
var== 
newCoin== 
=== 
new== 
Coin== "
{>> 
Id?? 
=?? 
Guid?? 
.?? 
NewGuid?? !
(??! "
)??" #
,??# $
Quantity@@ 
=@@ 
quantityUsd@@ &
,@@& '
	ShortnameAA 
=AA 
$strAA "
}BB 
;BB 
contextDD 
.DD 
CoinsDD 
.DD 
AddDD 
(DD 
newCoinDD %
)DD% &
;DD& '
varFF 
userCoinFF 
=FF 
newFF 

UsersCoinsFF )
{GG 
UserIdHH 
=HH 
userIdHH 
,HH  
CoinIdII 
=II 
newCoinII  
.II  !
IdII! #
,II# $
CoinJJ 
=JJ 
newCoinJJ 
}KK 
;KK 
contextMM 
.MM 

UsersCoinsMM 
.MM 
AddMM "
(MM" #
userCoinMM# +
)MM+ ,
;MM, -
}NN 	
varOO 
replenishmentOO 
=OO 
newOO 
ReplenishmentOO  -
{PP 	
IdQQ 
=QQ 
GuidQQ 
.QQ 
NewGuidQQ 
(QQ 
)QQ 
,QQ  
QuantityRR 
=RR 
quantityUsdRR "
*RR# $
$numRR% )
,RR) *

CommissionSS 
=SS 
quantityUsdSS $
*SS% &
$numSS' +
,SS+ ,
UserIdTT 
=TT 
userIdTT 
}UU 	
;UU	 

contextWW 
.WW 
ReplenishmentsWW 
.WW 
AddWW "
(WW" #
replenishmentWW# 0
)WW0 1
;WW1 2
contextYY 
.YY 
SaveChangesYY 
(YY 
)YY 
;YY 
}ZZ 
public\\ 

List\\ 
<\\ 
Replenishment\\ 
>\\ !
GetUserDepositHistory\\ 4
(\\4 5
Guid\\5 9
userId\\: @
)\\@ A
{]] 
var^^ 
replenishments^^ 
=^^ 
context^^ $
.^^$ %
Replenishments^^% 3
.__ 
Where__ 
(__ 
c__ 
=>__ 
c__ 
.__ 
UserId__  
==__! #
userId__$ *
)__* +
.`` 
ToList`` 
(`` 
)`` 
;`` 
returnbb 
replenishmentsbb 
;bb 
}cc 
publicee 

voidee 
WithdrawUSDTee 
(ee 
Guidee !
userIdee" (
,ee( )
doubleee* 0
quantityUsdee1 <
)ee< =
{ff 
constgg 
doublegg 

commissiongg 
=gg  !
$numgg" &
;gg& '
currencyRepositoryhh 
.hh 

SellCryptohh %
(hh% &
userIdhh& ,
,hh, -
$strhh. 4
,hh4 5
quantityUsdhh6 A
+hhB C
quantityUsdhhD O
*hhP Q

commissionhhR \
)hh\ ]
;hh] ^
varjj 

withdrawaljj 
=jj 
newjj 

Withdrawaljj '
{kk 	
Idll 
=ll 
Guidll 
.ll 
NewGuidll 
(ll 
)ll 
,ll  
Quantitymm 
=mm 
quantityUsdmm "
,mm" #

Commissionnn 
=nn 

commissionnn #
,nn# $
UserIdoo 
=oo 
userIdoo 
}pp 	
;pp	 

contextrr 
.rr 
Withdrawalsrr 
.rr 
Addrr 
(rr  

withdrawalrr  *
)rr* +
;rr+ ,
varss 
replenishmentss 
=ss 
newss 

Withdrawalss  *
{tt 	
Iduu 
=uu 
Guiduu 
.uu 
NewGuiduu 
(uu 
)uu 
,uu  
Quantityvv 
=vv 
quantityUsdvv "
*vv# $
$numvv% )
,vv) *

Commissionww 
=ww 
quantityUsdww $
*ww% &
$numww' +
,ww+ ,
UserIdxx 
=xx 
userIdxx 
}yy 	
;yy	 

context{{ 
.{{ 
Withdrawals{{ 
.{{ 
Add{{ 
({{  
replenishment{{  -
){{- .
;{{. /
context|| 
.|| 
SaveChanges|| 
(|| 
)|| 
;|| 
}}} 
public 

List 
< 

Withdrawal 
> %
GetUserWithdrawalsHistory 5
(5 6
Guid6 :
userId; A
)A B
{
АА 
var
ББ 
withdrawals
ББ 
=
ББ 
context
ББ !
.
ББ! "
Withdrawals
ББ" -
.
ВВ 
Where
ВВ 
(
ВВ 
c
ВВ 
=>
ВВ 
c
ВВ 
.
ВВ 
UserId
ВВ  
==
ВВ! #
userId
ВВ$ *
)
ВВ* +
.
ГГ 
ToList
ГГ 
(
ГГ 
)
ГГ 
;
ГГ 
return
ЕЕ 
withdrawals
ЕЕ 
;
ЕЕ 
}
ЖЖ 
public
ИИ 

List
ИИ 
<
ИИ 
Transactions
ИИ 
>
ИИ (
GetUserTransactionsHistory
ИИ 8
(
ИИ8 9
Guid
ИИ9 =
userId
ИИ> D
)
ИИD E
{
ЙЙ 
var
КК 
transactions
КК 
=
КК 
context
КК "
.
КК" #
Transactions
КК# /
.
ЛЛ 
Where
ЛЛ 
(
ЛЛ 
c
ЛЛ 
=>
ЛЛ 
c
ЛЛ 
.
ЛЛ 

ReceiverId
ЛЛ $
==
ЛЛ% '
userId
ЛЛ( .
||
ЛЛ/ 1
c
ЛЛ2 3
.
ЛЛ3 4
SenderId
ЛЛ4 <
==
ЛЛ= ?
userId
ЛЛ@ F
)
ЛЛF G
.
ММ 
ToList
ММ 
(
ММ 
)
ММ 
;
ММ 
return
ОО 
transactions
ОО 
;
ОО 
}
ПП 
}РР ■
BC:\work\BSUIR\crypto-wallet\Backend\Repositories\RepositoryBase.cs
	namespace 	
UP
 
. 
Repositories 
; 
public 
class 
RepositoryBase 
{ 
	protected 
const 
string 
ApiKey !
=" #
$str$ f
;f g
} Ф
NC:\work\BSUIR\crypto-wallet\Backend\Repositories\Interfaces\IUserRepository.cs
	namespace 	

Repository
 
; 
public 
	interface 
IUserRepository  
{ 
public 

List 
< 
Coin 
> 
GetUserCoins "
(" #
Guid# '
userId( .
). /
;/ 0
public		 

Task		 
<		 
List		 
<		 
CoinsInformation		 %
>		% &
>		& '
GetUserCoinsFull		( 8
(		8 9
Guid		9 =
userId		> D
)		D E
;		E F
public

 

double

 '
GetCoinQuantityInUserWallet

 -
(

- .
Guid

. 2
userId

3 9
,

9 :
string

; A
coinShortname

B O
)

O P
;

P Q
} ┴
VC:\work\BSUIR\crypto-wallet\Backend\Repositories\Interfaces\ITransactionsRepository.cs
	namespace 	
UP
 
. 
Repositories 
; 
public 
	interface #
ITransactionsRepository (
{ 
void ,
 WriteNewConversionDataToDatabase	 )
() *

Conversion* 4

conversion5 ?
)? @
;@ A
List 
< 	

Conversion	 
> %
GetUserConversionsHistory .
(. /
Guid/ 3
userId4 :
): ;
;; <
void		 
ReplenishTheBalance			 
(		 
Guid		 !
userId		" (
,		( )
double		* 0
quantityUsd		1 <
)		< =
;		= >
List

 
<

 	
Replenishment

	 
>

 !
GetUserDepositHistory

 -
(

- .
Guid

. 2
userId

3 9
)

9 :
;

: ;
void 
WithdrawUSDT	 
( 
Guid 
userId !
,! "
double# )
quantityUsd* 5
)5 6
;6 7
List 
< 	

Withdrawal	 
> %
GetUserWithdrawalsHistory .
(. /
Guid/ 3
userId4 :
): ;
;; <
List 
< 	
Transactions	 
> &
GetUserTransactionsHistory 1
(1 2
Guid2 6
userId7 =
)= >
;> ?
} ├
LC:\work\BSUIR\crypto-wallet\Backend\Repositories\Interfaces\IDbRepository.cs
	namespace 	

Repository
 
; 
public 
	interface 
IDbRepository 
{ 

IQueryable 
< 
T 
> 
Get 
< 
T 
> 
( 

Expression #
<# $
Func$ (
<( )
T) *
,* +
bool, 0
>0 1
>1 2
selector3 ;
); <
where= B
TC D
:E F
classG L
,L M
IEntityN U
;U V

IQueryable		 
<		 
T		 
>		 
Get		 
<		 
T		 
>		 
(		 
)		 
where		  
T		! "
:		# $
class		% *
,		* +
IEntity		, 3
;		3 4

IQueryable

 
<

 
T

 
>

 
GetAll

 
<

 
T

 
>

 
(

 
)

 
where

 #
T

$ %
:

& '
class

( -
,

- .
IEntity

/ 6
;

6 7
Task 
< 	
Guid	 
> 
Add 
< 
T 
> 
( 
T 
	newEntity !
)! "
where# (
T) *
:+ ,
class- 2
,2 3
IEntity4 ;
;; <
Task 
AddRange	 
< 
T 
> 
( 
IEnumerable  
<  !
T! "
>" #
newEntities$ /
)/ 0
where1 6
T7 8
:9 :
class; @
,@ A
IEntityB I
;I J
Task 
Delete	 
< 
T 
> 
( 
Guid 
entity 
) 
where  %
T& '
:( )
class* /
,/ 0
IEntity1 8
;8 9
Task 
Remove	 
< 
T 
> 
( 
T 
entity 
) 
where "
T# $
:% &
class' ,
?, -
,- .
IEntity/ 6
?6 7
;7 8
Task 
RemoveRange	 
< 
T 
> 
( 
IEnumerable #
<# $
T$ %
>% &
entities' /
)/ 0
where1 6
T7 8
:9 :
class; @
,@ A
IEntityB I
;I J
Task 
Update	 
< 
T 
> 
( 
T 
entity 
) 
where "
T# $
:% &
class' ,
,, -
IEntity. 5
;5 6
Task 
UpdateRange	 
< 
T 
> 
( 
IEnumerable #
<# $
T$ %
>% &
entities' /
)/ 0
where1 6
T7 8
:9 :
class; @
,@ A
IEntityB I
;I J
Task 
< 	
int	 
> 
SaveChangesAsync 
( 
)  
;  !
} Ю
RC:\work\BSUIR\crypto-wallet\Backend\Repositories\Interfaces\ICurrencyRepository.cs
	namespace 	

Repository
 
; 
public 
	interface 
ICurrencyRepository $
{ 
void 
	BuyCrypto	 
( 
Guid 
userId 
, 
string  &
	shortname' 0
,0 1
double2 8
quantity9 A
)A B
;B C
List		 
<		 	
Coin			 
>		 
GetUserCoins		 
(		 
Guid		  
userId		! '
)		' (
;		( )
void

 !
AddCryptoToUserWallet

	 
(

 
Guid

 #
userId

$ *
,

* +
string

, 2
	shortname

3 <
,

< =
double

> D
quantity

E M
)

M N
;

N O
void 

SendCrypto	 
( 
Guid 

receiverId #
,# $
Guid% )
senderId* 2
,2 3
string4 :
	shortname; D
,D E
doubleF L
quantityM U
)U V
;V W
bool "
IsCoinAlreadyPurchased	 
(  
List  $
<$ %
Coin% )
>) *
coins+ 0
,0 1
string2 8
	shortName9 B
)B C
;C D
Task 
< 	
double	 
> 
GetCoinPrice 
( 
double $
quantity% -
,- .
string/ 5
	shortName6 ?
)? @
;@ A
Task 
< 	
double	 
> 
GetCoinQuantity  
(  !
double! '
quantityUSD( 3
,3 4
string5 ;
	shortName< E
)E F
;F G
public 

void 

SellCrypto 
( 
Guid 
userId  &
,& '
string( .
	shortname/ 8
,8 9
double: @
quantityForSaleA P
)P Q
;Q R
Task 
< 	
double	 
> 
GetUserBalance 
(  
Guid  $
userId% +
)+ ,
;, -
public 

void  
SubtractCoinFromUser $
($ %
Guid% )
userId* 0
,0 1
string2 8
	shortname9 B
,B C
doubleD J
quantityForSubtractK ^
)^ _
;_ `
void 

DeleteCoin	 
( 
Guid 
coinId 
)  
;  !
Task 
< 	
CoinsInformation	 
> "
GetFullCoinInformation 1
(1 2
string2 8
	shortName9 B
)B C
;C D
void 
UpdateCoinQuantity	 
( 
Guid  
id! #
,# $
double% +
quantity, 4
)4 5
;5 6
void &
WriteTransactionToDatabase	 #
(# $
string$ *
coinName+ 3
,3 4
double5 ;
quantity< D
,D E
GuidF J
senderIdK S
,S T
GuidU Y

receiverIdZ d
)d e
;e f
void #
WriteWithdrawToDatabase	  
(  !
double! '
quantity( 0
,0 1
double2 8

commission9 C
,C D
GuidE I
userIdJ P
)P Q
;Q R
} ╖C
@C:\work\BSUIR\crypto-wallet\Backend\Repositories\DbRepository.cs
	namespace 	
UP
 
. 
Repositories 
; 
public		 
class		 
DbRepository		 
:		 
IDbRepository		 )
{

 
private 
readonly 
DataContext  
_context! )
;) *
public 

DbRepository 
( 
DataContext #
context$ +
)+ ,
{ 
_context 
= 
context 
; 
} 
public 


IQueryable 
< 
T 
> 
Get 
< 
T 
> 
(  
)  !
where" '
T( )
:* +
class, 1
,1 2
IEntity3 :
{ 
return 
_context 
. 
Set 
< 
T 
> 
( 
)  
.  !
AsQueryable! ,
(, -
)- .
;. /
} 
public 


IQueryable 
< 
T 
> 
Get 
< 
T 
> 
(  

Expression  *
<* +
Func+ /
</ 0
T0 1
,1 2
bool3 7
>7 8
>8 9
selector: B
)B C
whereD I
TJ K
:L M
classN S
,S T
IEntityU \
{ 
return 
_context 
. 
Set 
< 
T 
> 
( 
)  
.  !
Where! &
(& '
selector' /
)/ 0
.0 1
AsQueryable1 <
(< =
)= >
;> ?
} 
public 

async 
Task 
< 
Guid 
> 
Add 
<  
T  !
>! "
(" #
T# $
	newEntity% .
). /
where0 5
T6 7
:8 9
class: ?
,? @
IEntityA H
{ 
var 
entity 
= 
await 
_context #
.# $
Set$ '
<' (
T( )
>) *
(* +
)+ ,
., -
AddAsync- 5
(5 6
	newEntity6 ?
)? @
;@ A
Console 
. 
	WriteLine 
( 
entity  
.  !
Entity! '
.' (
Id( *
)* +
;+ ,
return   
entity   
.   
Entity   
.   
Id   
;    
}!! 
public## 

async## 
Task## 
AddRange## 
<## 
T##  
>##  !
(##! "
IEnumerable##" -
<##- .
T##. /
>##/ 0
newEntities##1 <
)##< =
where##> C
T##D E
:##F G
class##H M
,##M N
IEntity##O V
{$$ 
await%% 
_context%% 
.%% 
Set%% 
<%% 
T%% 
>%% 
(%% 
)%% 
.%%  
AddRangeAsync%%  -
(%%- .
newEntities%%. 9
)%%9 :
;%%: ;
}&& 
public(( 

async(( 
Task(( 
Delete(( 
<(( 
T(( 
>(( 
(((  
Guid((  $
id((% '
)((' (
where(() .
T((/ 0
:((1 2
class((3 8
,((8 9
IEntity((: A
{)) 
var** 
entity** 
=** 
await** 
_context** #
.**# $
Set**$ '
<**' (
T**( )
>**) *
(*** +
)**+ ,
.**, -
FirstOrDefaultAsync**- @
(**@ A
x**A B
=>**C E
x**F G
.**G H
Id**H J
==**K M
id**N P
)**P Q
;**Q R
if++ 

(++ 
entity++ 
!=++ 
null++ 
)++ 
{,, 	
_context-- 
.-- 
Set-- 
<-- 
T-- 
>-- 
(-- 
)-- 
.-- 
Remove-- $
(--$ %
entity--% +
)--+ ,
;--, -
await.. 
_context.. 
... 
SaveChangesAsync.. +
(..+ ,
).., -
;..- .
}// 	
}00 
public33 

async33 
Task33 
Remove33 
<33 
T33 
>33 
(33  
T33  !
entity33" (
)33( )
where33* /
T330 1
:332 3
class334 9
,339 :
IEntity33; B
{44 
await55 
Task55 
.55 
Run55 
(55 
(55 
)55 
=>55 
_context55 %
.55% &
Set55& )
<55) *
T55* +
>55+ ,
(55, -
)55- .
.55. /
Remove55/ 5
(555 6
entity556 <
)55< =
)55= >
;55> ?
}66 
public88 

async88 
Task88 
RemoveRange88 !
<88! "
T88" #
>88# $
(88$ %
IEnumerable88% 0
<880 1
T881 2
>882 3
entities884 <
)88< =
where88> C
T88D E
:88F G
class88H M
,88M N
IEntity88O V
{99 
await:: 
Task:: 
.:: 
Run:: 
(:: 
(:: 
):: 
=>:: 
_context:: %
.::% &
Set::& )
<::) *
T::* +
>::+ ,
(::, -
)::- .
.::. /
RemoveRange::/ :
(::: ;
entities::; C
)::C D
)::D E
;::E F
};; 
public== 

async== 
Task== 
Update== 
<== 
T== 
>== 
(==  
T==  !
entity==" (
)==( )
where==* /
T==0 1
:==2 3
class==4 9
,==9 :
IEntity==; B
{>> 
await?? 
Task?? 
.?? 
Run?? 
(?? 
(?? 
)?? 
=>?? 
_context?? %
.??% &
Set??& )
<??) *
T??* +
>??+ ,
(??, -
)??- .
.??. /
Update??/ 5
(??5 6
entity??6 <
)??< =
)??= >
;??> ?
}@@ 
publicBB 

asyncBB 
TaskBB 
UpdateRangeBB !
<BB! "
TBB" #
>BB# $
(BB$ %
IEnumerableBB% 0
<BB0 1
TBB1 2
>BB2 3
entitiesBB4 <
)BB< =
whereBB> C
TBBD E
:BBF G
classBBH M
,BBM N
IEntityBBO V
{CC 
awaitDD 
TaskDD 
.DD 
RunDD 
(DD 
(DD 
)DD 
=>DD 
_contextDD %
.DD% &
SetDD& )
<DD) *
TDD* +
>DD+ ,
(DD, -
)DD- .
.DD. /
UpdateRangeDD/ :
(DD: ;
entitiesDD; C
)DDC D
)DDD E
;DDE F
}EE 
publicGG 

asyncGG 
TaskGG 
<GG 
intGG 
>GG 
SaveChangesAsyncGG +
(GG+ ,
)GG, -
{HH 
returnII 
awaitII 
_contextII 
.II 
SaveChangesAsyncII .
(II. /
)II/ 0
;II0 1
}JJ 
publicLL 


IQueryableLL 
<LL 
TLL 
>LL 
GetAllLL 
<LL  
TLL  !
>LL! "
(LL" #
)LL# $
whereLL% *
TLL+ ,
:LL- .
classLL/ 4
,LL4 5
IEntityLL6 =
{MM 
returnNN 
_contextNN 
.NN 
SetNN 
<NN 
TNN 
>NN 
(NN 
)NN  
.NN  !
AsQueryableNN! ,
(NN, -
)NN- .
;NN. /
}OO 
}PP Б╞
FC:\work\BSUIR\crypto-wallet\Backend\Repositories\CurrencyRepository.cs
	namespace 	
UP
 
. 
Repositories 
; 
public 
class 
CurrencyRepository 
:  !
RepositoryBase" 0
,0 1
ICurrencyRepository2 E
{ 
private 
const 
string 
CryptoCompareApiUrl ,
=- .
$str/ R
;R S
private 
static 
readonly 

HttpClient &

httpClient' 1
=2 3
new4 7
(7 8
)8 9
;9 :
private 
readonly 
DataContext  
_context! )
;) *
private 
readonly 
IUserRepository $
_userRepository% 4
;4 5
private 
readonly 
IDbRepository "
_dbRepository# 0
;0 1
public 

CurrencyRepository 
( 
DataContext )
context* 1
,1 2
IDbRepository3 @
dbRepositoryA M
)M N
{ 
_context 
= 
context 
; 
_dbRepository 
= 
dbRepository $
;$ %
} 
public 

void 
	BuyCrypto 
( 
Guid 
userId %
,% &
string' -
	shortname. 7
,7 8
double9 ?
quantity@ H
)H I
{ !
AddCryptoToUserWallet   
(   
userId   $
,  $ %
	shortname  & /
,  / 0
quantity  1 9
)  9 :
;  : ;
}!! 
public## 

List## 
<## 
Coin## 
>## 
GetUserCoins## "
(##" #
Guid### '
userId##( .
)##. /
{$$ 
var%% 
	userCoins%% 
=%% 
_context%%  
.%%  !
Users%%! &
.&& 
Where&& 
(&& 
u&& 
=>&& 
u&& 
.&& 
Id&& 
==&& 
userId&&  &
)&&& '
.'' 

SelectMany'' 
('' 
u'' 
=>'' 
u'' 
.'' 

UsersCoins'' )
)'') *
.(( 
Select(( 
((( 
uc(( 
=>(( 
uc(( 
.(( 
Coin(( !
)((! "
.)) 
ToList)) 
()) 
))) 
;)) 
return++ 
	userCoins++ 
;++ 
},, 
public.. 

void.. !
AddCryptoToUserWallet.. %
(..% &
Guid..& *
userId..+ 1
,..1 2
string..3 9
	shortname..: C
,..C D
double..E K
quantity..L T
)..T U
{// 
var00 
user00 
=00 
_context00 
.00 
Users00 !
.00! "
FirstOrDefault00" 0
(000 1
uc001 3
=>004 6
uc007 9
.009 :
Id00: <
==00= ?
userId00@ F
)00F G
;00G H
if22 

(22
 
user22 
?22 
.22 
Login22 
==22 
$str22 #
||22$ &
user22' +
==22, .
null22/ 3
)223 4
return33 
;33 
var55 
	userCoins55 
=55 
_context55  
.55  !

UsersCoins55! +
.66 
Include66 
(66 
uc66 
=>66 
uc66 
.66 
Coin66 "
)66" #
.77 
Where77 
(77 
uc77 
=>77 
uc77 
.77 
UserId77 "
==77# %
userId77& ,
)77, -
.88 
ToList88 
(88 
)88 
;88 
var:: 
existingCoin:: 
=:: 
	userCoins:: $
.::$ %
FirstOrDefault::% 3
(::3 4
uc::4 6
=>::7 9
uc::: <
.::< =
Coin::= A
.::A B
	Shortname::B K
==::L N
	shortname::O X
)::X Y
;::Y Z
if<< 

(<< 
existingCoin<< 
!=<< 
null<<  
)<<  !
{== 	
existingCoin>> 
.>> 
Coin>> 
.>> 
Quantity>> &
+=>>' )
quantity>>* 2
;>>2 3
}?? 	
else@@ 
{AA 	
varBB 
newCoinBB 
=BB 
newBB 
CoinBB "
{CC 
QuantityDD 
=DD 
quantityDD #
,DD# $
	ShortnameEE 
=EE 
	shortnameEE %
}FF 
;FF 
_contextHH 
.HH 
CoinsHH 
.HH 
AddHH 
(HH 
newCoinHH &
)HH& '
;HH' (
varJJ 
userCoinJJ 
=JJ 
newJJ 

UsersCoinsJJ )
{KK 
UserIdLL 
=LL 
userIdLL 
,LL  
CoinMM 
=MM 
newCoinMM 
}NN 
;NN 
_contextPP 
.PP 

UsersCoinsPP 
.PP  
AddPP  #
(PP# $
userCoinPP$ ,
)PP, -
;PP- .
}QQ 	
_contextRR 
.RR 
SaveChangesRR 
(RR 
)RR 
;RR 
}SS 
publicUU 

voidUU 

SendCryptoUU 
(UU 
GuidUU 

receiverIdUU  *
,UU* +
GuidUU, 0
senderIdUU1 9
,UU9 :
stringUU; A
	shortnameUUB K
,UUK L
doubleUUM S
quantityUUT \
)UU\ ]
{VV  
SubtractCoinFromUserWW 
(WW 
senderIdWW %
,WW% &
	shortnameWW' 0
,WW0 1
quantityWW2 :
)WW: ;
;WW; <!
AddCryptoToUserWalletXX 
(XX 

receiverIdXX (
,XX( )
	shortnameXX* 3
,XX3 4
quantityXX5 =
)XX= >
;XX> ?
}YY 
public[[ 

bool[[ "
IsCoinAlreadyPurchased[[ &
([[& '
List[[' +
<[[+ ,
Coin[[, 0
>[[0 1
coins[[2 7
,[[7 8
string[[9 ?
	shortName[[@ I
)[[I J
{\\ 
try]] 
{^^ 	
return__ 
coins__ 
.__ 
Any__ 
(__ 
i__ 
=>__ !
i__" #
.__# $
	Shortname__$ -
==__. 0
	shortName__1 :
)__: ;
;__; <
}`` 	
catchaa 
(aa 
	Exceptionaa 
eaa 
)aa 
{bb 	
returncc 
falsecc 
;cc 
}dd 	
}ee 
publicgg 

asyncgg 
voidgg 

SellCryptogg  
(gg  !
Guidgg! %
userIdgg& ,
,gg, -
stringgg. 4
	shortnamegg5 >
,gg> ?
doublegg@ F
quantityForSaleggG V
)ggV W
{hh 
varii  
quantityInUserWalletii  
=ii! "
_userRepositoryii# 2
.ii2 3'
GetCoinQuantityInUserWalletii3 N
(iiN O
userIdiiO U
,iiU V
$striiW ]
)ii] ^
;ii^ _
ifjj 

(jj 
awaitjj 
GetCoinPricejj 
(jj  
quantityInUserWalletjj 3
,jj3 4
$strjj5 ;
)jj; <
<jj= >
awaitjj? D
GetCoinPricejjE Q
(jjQ R
quantityForSalejjR a
,jja b
	shortnamejjc l
)jjl m
)jjm n
returnkk 
;kk  
SubtractCoinFromUsermm 
(mm 
userIdmm #
,mm# $
	shortnamemm% .
,mm. /
quantityForSalemm0 ?
)mm? @
;mm@ A
}nn 
publicpp 

voidpp  
SubtractCoinFromUserpp $
(pp$ %
Guidpp% )
userIdpp* 0
,pp0 1
stringpp2 8
	shortnamepp9 B
,ppB C
doubleppD J
quantityForSubtractppK ^
)pp^ _
{qq 
varrr 
	userCoinsrr 
=rr 
_contextrr  
.rr  !

UsersCoinsrr! +
.ss 
Includess 
(ss 
ucss 
=>ss 
ucss 
.ss 
Coinss "
)ss" #
.tt 
Wherett 
(tt 
uctt 
=>tt 
uctt 
.tt 
UserIdtt "
==tt# %
userIdtt& ,
)tt, -
.uu 
ToListuu 
(uu 
)uu 
;uu 
varww 
existingCoinww 
=ww 
	userCoinsww $
.ww$ %
FirstOrDefaultww% 3
(ww3 4
ucww4 6
=>ww7 9
ucww: <
.ww< =
Coinww= A
.wwA B
	ShortnamewwB K
==wwL N
	shortnamewwO X
)wwX Y
;wwY Z
ifyy 

(yy 
existingCoinyy 
?yy 
.yy 
Coinyy 
.yy 
	Shortnameyy (
!=yy) +
nullyy, 0
)yy0 1
{zz 	
existingCoin{{ 
.{{ 
Coin{{ 
.{{ 
Quantity{{ &
-={{' )
quantityForSubtract{{* =
;{{= >
if|| 
(|| 
existingCoin|| 
.|| 
Coin|| !
.||! "
Quantity||" *
/||+ ,
quantityForSubtract||- @
<||A B
$num||C G
)||G H
{}} 
_context~~ 
.~~ 
Remove~~ 
(~~  
existingCoin~~  ,
)~~, -
;~~- .
} 
}
АА 	
_context
ВВ 
.
ВВ 
SaveChanges
ВВ 
(
ВВ 
)
ВВ 
;
ВВ 
}
ГГ 
public
ЕЕ 

async
ЕЕ 
Task
ЕЕ 
<
ЕЕ 
double
ЕЕ 
>
ЕЕ 
GetCoinPrice
ЕЕ *
(
ЕЕ* +
double
ЕЕ+ 1
quantity
ЕЕ2 :
,
ЕЕ: ;
string
ЕЕ< B
	shortName
ЕЕC L
)
ЕЕL M
{
ЖЖ 
using
ЗЗ 
var
ЗЗ 

httpClient
ЗЗ 
=
ЗЗ 
new
ЗЗ "

HttpClient
ЗЗ# -
(
ЗЗ- .
)
ЗЗ. /
;
ЗЗ/ 0

httpClient
ИИ 
.
ИИ #
DefaultRequestHeaders
ИИ (
.
ИИ( )
Add
ИИ) ,
(
ИИ, -
$str
ИИ- ;
,
ИИ; <
ApiKey
ИИ= C
)
ИИC D
;
ИИD E
var
ЙЙ 
url
ЙЙ 
=
ЙЙ 
$str
ЙЙ F
+
ЙЙG H
	shortName
ЙЙI R
+
ЙЙS T
$str
ЙЙU a
;
ЙЙa b
var
КК 
response
КК 
=
КК 
await
КК 

httpClient
КК '
.
КК' (
GetAsync
КК( 0
(
КК0 1
url
КК1 4
)
КК4 5
;
КК5 6
var
ЛЛ 
responseContent
ЛЛ 
=
ЛЛ 
await
ЛЛ #
response
ЛЛ$ ,
.
ЛЛ, -
Content
ЛЛ- 4
.
ЛЛ4 5
ReadAsStringAsync
ЛЛ5 F
(
ЛЛF G
)
ЛЛG H
;
ЛЛH I
Console
ММ 
.
ММ 
	WriteLine
ММ 
(
ММ 
responseContent
ММ )
)
ММ) *
;
ММ* +
var
НН 
json
НН 
=
НН 
JObject
НН 
.
НН 
Parse
НН  
(
НН  !
responseContent
НН! 0
)
НН0 1
;
НН1 2
var
ОО 
price
ОО 
=
ОО 
(
ОО 
double
ОО 
)
ОО 
json
ОО  
[
ОО  !
$str
ОО! &
]
ОО& '
*
ОО( )
quantity
ОО* 2
;
ОО2 3
return
ПП 
price
ПП 
;
ПП 
}
РР 
public
ТТ 

async
ТТ 
Task
ТТ 
<
ТТ 
double
ТТ 
>
ТТ 
GetCoinQuantity
ТТ -
(
ТТ- .
double
ТТ. 4
quantityUSD
ТТ5 @
,
ТТ@ A
string
ТТB H
	shortName
ТТI R
)
ТТR S
{
УУ 
var
ФФ 
price
ФФ 
=
ФФ 
await
ФФ 
GetCoinPrice
ФФ &
(
ФФ& '
$num
ФФ' (
,
ФФ( )
	shortName
ФФ* 3
)
ФФ3 4
;
ФФ4 5
return
ХХ 
quantityUSD
ХХ 
/
ХХ 
price
ХХ "
;
ХХ" #
}
ЦЦ 
public
ШШ 

async
ШШ 
Task
ШШ 
<
ШШ 
double
ШШ 
>
ШШ 
GetUserBalance
ШШ ,
(
ШШ, -
Guid
ШШ- 1
userId
ШШ2 8
)
ШШ8 9
{
ЩЩ 
var
ЪЪ 
coins
ЪЪ 
=
ЪЪ 
_context
ЪЪ 
.
ЪЪ 
Users
ЪЪ "
.
ЫЫ 
Where
ЫЫ 
(
ЫЫ 
u
ЫЫ 
=>
ЫЫ 
u
ЫЫ 
.
ЫЫ 
Id
ЫЫ 
==
ЫЫ 
userId
ЫЫ  &
)
ЫЫ& '
.
ЬЬ 
Include
ЬЬ 
(
ЬЬ 
u
ЬЬ 
=>
ЬЬ 
u
ЬЬ 
.
ЬЬ 

UsersCoins
ЬЬ &
)
ЬЬ& '
.
ЭЭ 
ThenInclude
ЭЭ 
(
ЭЭ 
uc
ЭЭ 
=>
ЭЭ 
uc
ЭЭ !
.
ЭЭ! "
Coin
ЭЭ" &
)
ЭЭ& '
.
ЮЮ 

SelectMany
ЮЮ 
(
ЮЮ 
u
ЮЮ 
=>
ЮЮ 
u
ЮЮ 
.
ЮЮ 

UsersCoins
ЮЮ )
.
ЮЮ) *
Select
ЮЮ* 0
(
ЮЮ0 1
uc
ЮЮ1 3
=>
ЮЮ4 6
uc
ЮЮ7 9
.
ЮЮ9 :
Coin
ЮЮ: >
)
ЮЮ> ?
)
ЮЮ? @
.
ЯЯ 
ToList
ЯЯ 
(
ЯЯ 
)
ЯЯ 
;
ЯЯ 
double
аа 
balance
аа 
=
аа 
$num
аа 
;
аа 
foreach
бб 
(
бб 
var
бб 
i
бб 
in
бб 
coins
бб 
)
бб  
balance
бб! (
+=
бб) +
await
бб, 1
GetCoinPrice
бб2 >
(
бб> ?
i
бб? @
.
бб@ A
Quantity
ббA I
,
ббI J
i
ббK L
.
ббL M
	Shortname
ббM V
)
ббV W
;
ббW X
return
вв 
balance
вв 
;
вв 
}
гг 
public
ее 

void
ее 

DeleteCoin
ее 
(
ее 
Guid
ее 
coinId
ее  &
)
ее& '
{
жж 
var
зз 
coinToDelete
зз 
=
зз 
_context
зз #
.
зз# $
Coins
зз$ )
.
зз) *
Find
зз* .
(
зз. /
coinId
зз/ 5
)
зз5 6
;
зз6 7
if
йй 

(
йй 
coinToDelete
йй 
!=
йй 
null
йй  
)
йй  !
{
кк 	
_context
лл 
.
лл 
Coins
лл 
.
лл 
Remove
лл !
(
лл! "
coinToDelete
лл" .
)
лл. /
;
лл/ 0
_context
мм 
.
мм 
SaveChanges
мм  
(
мм  !
)
мм! "
;
мм" #
}
нн 	
else
оо 
{
пп 	
throw
░░ 
new
░░ 
	Exception
░░ 
(
░░  
$str
░░  ;
)
░░; <
;
░░< =
}
▒▒ 	
}
▓▓ 
public
┤┤ 

async
┤┤ 
Task
┤┤ 
<
┤┤ 
CoinsInformation
┤┤ &
>
┤┤& '$
GetFullCoinInformation
┤┤( >
(
┤┤> ?
string
┤┤? E
	shortName
┤┤F O
)
┤┤O P
{
╡╡ 
var
╢╢ 
	coinsList
╢╢ 
=
╢╢ 
await
╢╢ 
_dbRepository
╢╢ +
.
╢╢+ ,
Get
╢╢, /
<
╢╢/ 0
CoinListInfo
╢╢0 <
>
╢╢< =
(
╢╢= >
)
╢╢> ?
.
╖╖ 
Where
╖╖ 
(
╖╖ 
x
╖╖ 
=>
╖╖ 
x
╖╖ 
.
╖╖ 
IsActive
╖╖ "
)
╖╖" #
.
╕╕ 
ToListAsync
╕╕ 
(
╕╕ 
)
╕╕ 
;
╕╕ 
var
║║ 
cryptoDictionary
║║ 
=
║║ 
	coinsList
║║ (
.
║║( )
ToDictionary
║║) 5
(
║║5 6
coin
╗╗ 
=>
╗╗ 
coin
╗╗ 
.
╗╗ 
	ShortName
╗╗ "
.
╗╗" #
ToLower
╗╗# *
(
╗╗* +
)
╗╗+ ,
,
╗╗, -
coin
╝╝ 
=>
╝╝ 
coin
╝╝ 
.
╝╝ 
FullName
╝╝ !
.
╝╝! "
ToLower
╝╝" )
(
╝╝) *
)
╝╝* +
)
╜╜ 	
;
╜╜	 

var
╛╛ 
fullName
╛╛ 
=
╛╛ 
cryptoDictionary
╛╛ '
[
╛╛' (
	shortName
╛╛( 1
]
╛╛1 2
;
╛╛2 3
var
└└ 
url
└└ 
=
└└ 
$"
└└ 
{
└└ !
CryptoCompareApiUrl
└└ (
}
└└( )
$str
└└) D
{
└└D E
	shortName
└└E N
}
└└N O
$str
└└O Y
"
└└Y Z
;
└└Z [
using
┴┴ 
var
┴┴ 
request
┴┴ 
=
┴┴ 
new
┴┴  
HttpRequestMessage
┴┴  2
(
┴┴2 3

HttpMethod
┴┴3 =
.
┴┴= >
Get
┴┴> A
,
┴┴A B
url
┴┴C F
)
┴┴F G
;
┴┴G H
request
┬┬ 
.
┬┬ 
Headers
┬┬ 
.
┬┬ 
Add
┬┬ 
(
┬┬ 
$str
┬┬ *
,
┬┬* +
ApiKey
┬┬, 2
)
┬┬2 3
;
┬┬3 4
using
├├ 
var
├├ 
response
├├ 
=
├├ 
await
├├ "

httpClient
├├# -
.
├├- .
	SendAsync
├├. 7
(
├├7 8
request
├├8 ?
,
├├? @"
HttpCompletionOption
├├A U
.
├├U V!
ResponseHeadersRead
├├V i
)
├├i j
;
├├j k
if
┼┼ 

(
┼┼ 
!
┼┼ 
response
┼┼ 
.
┼┼ !
IsSuccessStatusCode
┼┼ )
)
┼┼) *
throw
╞╞ 
new
╞╞ "
HttpRequestException
╞╞ *
(
╞╞* +
$"
╞╞+ -
$str
╞╞- M
{
╞╞M N
response
╞╞N V
.
╞╞V W

StatusCode
╞╞W a
}
╞╞a b
"
╞╞b c
)
╞╞c d
;
╞╞d e
var
╚╚ 
responseContent
╚╚ 
=
╚╚ 
await
╚╚ #
response
╚╚$ ,
.
╚╚, -
Content
╚╚- 4
.
╚╚4 5
ReadAsStringAsync
╚╚5 F
(
╚╚F G
)
╚╚G H
;
╚╚H I
var
╔╔ 
data
╔╔ 
=
╔╔ 
JObject
╔╔ 
.
╔╔ 
Parse
╔╔  
(
╔╔  !
responseContent
╔╔! 0
)
╔╔0 1
;
╔╔1 2
var
╩╩ 
	priceData
╩╩ 
=
╩╩ 
data
╩╩ 
[
╩╩ 
$str
╩╩ "
]
╩╩" #
[
╩╩# $
	shortName
╩╩$ -
.
╩╩- .
ToUpper
╩╩. 5
(
╩╩5 6
)
╩╩6 7
]
╩╩7 8
[
╩╩8 9
$str
╩╩9 >
]
╩╩> ?
;
╩╩? @
var
╦╦ 
priceChange
╦╦ 
=
╦╦ 
(
╦╦ 
double
╦╦ !
)
╦╦! "
	priceData
╦╦" +
[
╦╦+ ,
$str
╦╦, 7
]
╦╦7 8
;
╦╦8 9
var
╠╠ 
dailyVolume
╠╠ 
=
╠╠ 
(
╠╠ 
double
╠╠ !
)
╠╠! "
	priceData
╠╠" +
[
╠╠+ ,
$str
╠╠, :
]
╠╠: ;
;
╠╠; <
var
══ 
number
══ 
=
══ 
dailyVolume
══  
;
══  !
var
╬╬ 
price
╬╬ 
=
╬╬ 
(
╬╬ 
double
╬╬ 
)
╬╬ 
	priceData
╬╬ %
[
╬╬% &
$str
╬╬& -
]
╬╬- .
;
╬╬. /
var
╧╧ 
previousPrice
╧╧ 
=
╧╧ 
price
╧╧ !
-
╧╧" #
priceChange
╧╧$ /
;
╧╧/ 0
var
╨╨ )
percentagePriceChangePerDay
╨╨ '
=
╨╨( )
priceChange
╨╨* 5
/
╨╨6 7
previousPrice
╨╨8 E
*
╨╨F G
$num
╨╨H K
;
╨╨K L
return
╤╤ 
new
╤╤ 
CoinsInformation
╤╤ #
(
╤╤# $
fullName
╤╤$ ,
,
╤╤, -
	shortName
╤╤. 7
,
╤╤7 8
$str
╥╥ F
+
╥╥G H
	shortName
╥╥I R
.
╥╥R S
ToLower
╥╥S Z
(
╥╥Z [
)
╥╥[ \
,
╥╥\ ]
dailyVolume
╥╥^ i
,
╥╥i j
priceChange
╥╥k v
,
╥╥v w
price
╙╙ 
,
╙╙ )
percentagePriceChangePerDay
╙╙ .
)
╙╙. /
;
╙╙/ 0
}
╘╘ 
public
╓╓ 

void
╓╓  
UpdateCoinQuantity
╓╓ "
(
╓╓" #
Guid
╓╓# '
id
╓╓( *
,
╓╓* +
double
╓╓, 2
quantity
╓╓3 ;
)
╓╓; <
{
╫╫ 
var
╪╪ 
coinToUpdate
╪╪ 
=
╪╪ 
_context
╪╪ #
.
╪╪# $
Coins
╪╪$ )
.
╪╪) *
Find
╪╪* .
(
╪╪. /
id
╪╪/ 1
)
╪╪1 2
;
╪╪2 3
if
┌┌ 

(
┌┌ 
coinToUpdate
┌┌ 
==
┌┌ 
null
┌┌  
)
┌┌  !
return
┌┌" (
;
┌┌( )
coinToUpdate
██ 
.
██ 
Quantity
██ 
=
██ 
quantity
██  (
;
██( )
_context
▄▄ 
.
▄▄ 
SaveChanges
▄▄ 
(
▄▄ 
)
▄▄ 
;
▄▄ 
}
▌▌ 
public
▀▀ 

void
▀▀ (
WriteTransactionToDatabase
▀▀ *
(
▀▀* +
string
▀▀+ 1
coinName
▀▀2 :
,
▀▀: ;
double
▀▀< B
quantity
▀▀C K
,
▀▀K L
Guid
▀▀M Q
senderId
▀▀R Z
,
▀▀Z [
Guid
▀▀\ `

receiverId
▀▀a k
)
▀▀k l
{
рр 
var
сс 
transaction
сс 
=
сс 
new
сс 
Transactions
сс *
{
тт 	
Id
уу 
=
уу 
Guid
уу 
.
уу 
NewGuid
уу 
(
уу 
)
уу 
,
уу  
CoinName
фф 
=
фф 
coinName
фф 
,
фф  
Quantity
хх 
=
хх 
quantity
хх 
,
хх  
SenderId
цц 
=
цц 
senderId
цц 
,
цц  

ReceiverId
чч 
=
чч 

receiverId
чч #
,
чч# $
DateCreated
шш 
=
шш 
DateTime
шш "
.
шш" #
UtcNow
шш# )
}
щщ 	
;
щщ	 

_context
ыы 
.
ыы 
Transactions
ыы 
.
ыы 
Add
ыы !
(
ыы! "
transaction
ыы" -
)
ыы- .
;
ыы. /
try
ьь 
{
ээ 	
_context
юю 
.
юю 
SaveChanges
юю  
(
юю  !
)
юю! "
;
юю" #
}
яя 	
catch
ЁЁ 
(
ЁЁ 
	Exception
ЁЁ 
e
ЁЁ 
)
ЁЁ 
{
ёё 	
Console
ЄЄ 
.
ЄЄ 
	WriteLine
ЄЄ 
(
ЄЄ 
e
ЄЄ 
)
ЄЄ  
;
ЄЄ  !
}
єє 	
}
ЇЇ 
public
ЎЎ 

void
ЎЎ %
WriteWithdrawToDatabase
ЎЎ '
(
ЎЎ' (
double
ЎЎ( .
quantity
ЎЎ/ 7
,
ЎЎ7 8
double
ЎЎ9 ?

commission
ЎЎ@ J
,
ЎЎJ K
Guid
ЎЎL P
userId
ЎЎQ W
)
ЎЎW X
{
ўў 
var
°° 

withdrawal
°° 
=
°° 
new
°° 

Withdrawal
°° '
{
∙∙ 	
Id
·· 
=
·· 
Guid
·· 
.
·· 
NewGuid
·· 
(
·· 
)
·· 
,
··  
Quantity
√√ 
=
√√ 
quantity
√√ 
,
√√  

Commission
№№ 
=
№№ 

commission
№№ #
,
№№# $
UserId
¤¤ 
=
¤¤ 
userId
¤¤ 
,
¤¤ 
DateCreated
■■ 
=
■■ 
DateTime
■■ "
.
■■" #
UtcNow
■■# )
}
   	
;
  	 

_context
ББ 
.
ББ 
Withdrawals
ББ 
.
ББ 
Add
ББ  
(
ББ  !

withdrawal
ББ! +
)
ББ+ ,
;
ББ, -
_context
ВВ 
.
ВВ 
SaveChanges
ВВ 
(
ВВ 
)
ВВ 
;
ВВ 
}
ГГ 
}ДД ▒e
.C:\work\BSUIR\crypto-wallet\Backend\Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder 
. 
Services 
. 
AddControllers 
(  
)  !
;! "
builder 
. 
Services 
. #
AddEndpointsApiExplorer (
(( )
)) *
;* +
builder 
. 
Services 
. 
AddSwaggerGen 
( 
options &
=>' )
{ 
options 
. !
AddSecurityDefinition !
(! "
$str" *
,* +
new, /!
OpenApiSecurityScheme0 E
{ 
Description 
= 
$str +
,+ ,
Name   
=   
$str   
,   
In!! 

=!! 
ParameterLocation!! 
.!! 
Header!! %
,!!% &
Scheme$$ 
=$$ 
$str$$ 
}%% 
)%% 
;%% 
options&& 
.&& "
AddSecurityRequirement&& "
(&&" #
new&&# &&
OpenApiSecurityRequirement&&' A
{'' 
{(( 	
new)) !
OpenApiSecurityScheme)) %
{** 
	Reference++ 
=++ 
new++ 
OpenApiReference++  0
{,, 
Type-- 
=-- 
ReferenceType-- (
.--( )
SecurityScheme--) 7
,--7 8
Id.. 
=.. 
$str.. !
}// 
,// 
Scheme00 
=00 
$str00 !
,00! "
Name11 
=11 
$str11 
,11  
In22 
=22 
ParameterLocation22 &
.22& '
Header22' -
}33 
,33 
new44 
List44 
<44 
string44 
>44 
(44 
)44 
}55 	
}66 
)66 
;66 
options77 
.77 

SwaggerDoc77 
(77 
$str77 
,77 
new77  
OpenApiInfo77! ,
{88 
Version99 
=99 
$str99 
,99 
Title:: 
=:: 
$str:: 
};; 
);; 
;;; 
var== 
xmlFile== 
=== 
$"== 
{== 
Assembly== 
.==  
GetExecutingAssembly== 2
(==2 3
)==3 4
.==4 5
GetName==5 <
(==< =
)=== >
.==> ?
Name==? C
}==C D
$str==D H
"==H I
;==I J
var>> 
xmlPath>> 
=>> 
Path>> 
.>> 
Combine>> 
(>> 

AppContext>> )
.>>) *
BaseDirectory>>* 7
,>>7 8
xmlFile>>9 @
)>>@ A
;>>A B
options?? 
.?? 
IncludeXmlComments?? 
(?? 
xmlPath?? &
)??& '
;??' (
options@@ 
.@@ 
EnableAnnotations@@ 
(@@ 
)@@ 
;@@  
}AA 
)AA 
;AA 
builderCC 
.CC 
ServicesCC 
.CC 
	AddScopedCC 
<CC 
IDbRepositoryCC (
,CC( )
DbRepositoryCC* 6
>CC6 7
(CC7 8
)CC8 9
;CC9 :
builderDD 
.DD 
ServicesDD 
.DD 
	AddScopedDD 
<DD 
IHashHelpersDD '
,DD' (
HashHelpersDD) 4
>DD4 5
(DD5 6
)DD6 7
;DD7 8
builderEE 
.EE 
ServicesEE 
.EE 
	AddScopedEE 
<EE 
IUserRepositoryEE *
,EE* +
UserRepositoryEE, :
>EE: ;
(EE; <
)EE< =
;EE= >
builderFF 
.FF 
ServicesFF 
.FF 
	AddScopedFF 
<FF 
ICurrencyRepositoryFF .
,FF. /
CurrencyRepositoryFF0 B
>FFB C
(FFC D
)FFD E
;FFE F
builderGG 
.GG 
ServicesGG 
.GG 
	AddScopedGG 
<GG 
IUserRepositoryGG *
,GG* +
UserRepositoryGG, :
>GG: ;
(GG; <
)GG< =
;GG= >
builderHH 
.HH 
ServicesHH 
.HH 
	AddScopedHH 
<HH #
ITransactionsRepositoryHH 2
,HH2 3"
TransactionsRepositoryHH4 J
>HHJ K
(HHK L
)HHL M
;HHM N
builderII 
.II 
ServicesII 
.II 
	AddScopedII 
<II 
IServiceServiceII *
,II* +
ServiceServiceII, :
>II: ;
(II; <
)II< =
;II= >
builderJJ 
.JJ 
ServicesJJ 
.JJ 
	AddScopedJJ 
<JJ 
IEmailServiceJJ (
,JJ( )
EmailServiceJJ* 6
>JJ6 7
(JJ7 8
)JJ8 9
;JJ9 :
builderKK 
.KK 
ServicesKK 
.KK 
	AddScopedKK 
<KK 
ICurrencyServiceKK +
,KK+ ,
CurrencyServiceKK- <
>KK< =
(KK= >
)KK> ?
;KK? @
builderLL 
.LL 
ServicesLL 
.LL 
	AddScopedLL 
<LL 
IAuthServiceLL '
,LL' (
AuthServiceLL) 4
>LL4 5
(LL5 6
)LL6 7
;LL7 8
builderOO 
.OO 
ServicesOO 
.OO 
AddControllersOO 
(OO  
)OO  !
.PP 
AddJsonOptionsPP 
(PP 
optionsPP 
=>PP 
{PP  
optionsPP! (
.PP( )!
JsonSerializerOptionsPP) >
.PP> ?
ReferenceHandlerPP? O
=PPP Q
ReferenceHandlerPPR b
.PPb c
PreservePPc k
;PPk l
}PPm n
)PPn o
;PPo p
	SQLitePCLRR 	
.RR	 

Batteries_V2RR
 
.RR 
InitRR 
(RR 
)RR 
;RR 
builderSS 
.SS 
ServicesSS 
.SS 
AddDbContextSS 
<SS 
DataContextSS )
>SS) *
(SS* +
optionsSS+ 2
=>SS3 5
optionsTT 
.TT 
	UseSqliteTT 
(TT 
$strTT )
)TT) *
)TT* +
;TT+ ,
builderVV 
.VV 
ServicesVV 
.VV 
AddCorsVV 
(VV 
optionsVV  
=>VV! #
{WW 
optionsXX 
.XX 
	AddPolicyXX 
(XX 
$strXX &
,XX& '
policyYY 
=>YY 
{ZZ 	
policy[[ 
.[[ 
AllowAnyOrigin[[ !
([[! "
)[[" #
.\\ 
AllowAnyHeader\\ 
(\\  
)\\  !
.]] 
AllowAnyMethod]] 
(]]  
)]]  !
;]]! "
}^^ 	
)^^	 

;^^
 
}__ 
)__ 
;__ 
builder`` 
.`` 
Services`` 
.`` 
AddAuthentication`` "
(``" #
JwtBearerDefaults``# 4
.``4 5 
AuthenticationScheme``5 I
)``I J
.``J K
AddJwtBearer``K W
(``W X
options``X _
=>``` b
{aa 
optionsbb 
.bb  
RequireHttpsMetadatabb  
=bb! "
falsebb# (
;bb( )
optionscc 
.cc 
	SaveTokencc 
=cc 
truecc 
;cc 
optionsdd 
.dd %
TokenValidationParametersdd %
=dd& '
newdd( +%
TokenValidationParametersdd, E
{ee 
ValidateIssuerff 
=ff 
trueff 
,ff 
ValidateAudiencegg 
=gg 
truegg 
,gg  
ValidAudiencehh 
=hh 
builderhh 
.hh  
Configurationhh  -
[hh- .
$strhh. <
]hh< =
,hh= >
ValidIssuerii 
=ii 
builderii 
.ii 
Configurationii +
[ii+ ,
$strii, 8
]ii8 9
,ii9 :
IssuerSigningKeyjj 
=jj 
newjj  
SymmetricSecurityKeyjj 3
(jj3 4
Encodingjj4 <
.jj< =
UTF8jj= A
.jjA B
GetBytesjjB J
(jjJ K
builderjjK R
.jjR S
ConfigurationjjS `
[jj` a
$strjja j
]jjj k
??jjl n
stringjjo u
.jju v
Emptyjjv {
)jj{ |
)jj| }
}kk 
;kk 
}ll 
)ll 
;ll 
varnn 
appnn 
=nn 	
buildernn
 
.nn 
Buildnn 
(nn 
)nn 
;nn 
appoo 
.oo 
UseCorsoo 
(oo 
xoo 
=>oo 
xoo 
.pp 
AllowAnyOriginpp 
(pp 
)pp 
.qq 
AllowAnyMethodqq 
(qq 
)qq 
.rr 
AllowAnyHeaderrr 
(rr 
)rr 
)rr 
;rr 
apptt 
.tt 
MapControllerstt 
(tt 
)tt 
;tt 
appvv 
.vv 
UseCookiePolicyvv 
(vv 
newvv 
CookiePolicyOptionsvv +
{ww !
MinimumSameSitePolicyxx 
=xx 
SameSiteModexx (
.xx( )
Strictxx) /
,xx/ 0
HttpOnlyyy 
=yy 
HttpOnlyPolicyyy 
.yy 
Alwaysyy $
,yy$ %
Securezz 

=zz 
CookieSecurePolicyzz 
.zz  
Alwayszz  &
}{{ 
){{ 
;{{ 
app}} 
.}} 
UseStaticFiles}} 
(}} 
)}} 
;}} 
if 
( 
app 
. 
Environment 
. 
IsDevelopment !
(! "
)" #
)# $
{АА 
app
ББ 
.
ББ 

UseSwagger
ББ 
(
ББ 
)
ББ 
;
ББ 
app
ВВ 
.
ВВ 
UseSwaggerUI
ВВ 
(
ВВ 
options
ВВ 
=>
ВВ 
{
ГГ 
options
ДД 
.
ДД 
SwaggerEndpoint
ДД 
(
ДД  
$str
ДД  :
,
ДД: ;
$str
ДД< @
)
ДД@ A
;
ДДA B
options
ЕЕ 
.
ЕЕ 
InjectStylesheet
ЕЕ  
(
ЕЕ  !
$str
ЕЕ! >
)
ЕЕ> ?
;
ЕЕ? @
options
ЖЖ 
.
ЖЖ 
RoutePrefix
ЖЖ 
=
ЖЖ 
string
ЖЖ $
.
ЖЖ$ %
Empty
ЖЖ% *
;
ЖЖ* +
}
ЗЗ 
)
ЗЗ 
;
ЗЗ 
}ИИ 
appКК 
.
КК 
UseAuthentication
КК 
(
КК 
)
КК 
;
КК 
appЛЛ 
.
ЛЛ 
UseAuthorization
ЛЛ 
(
ЛЛ 
)
ЛЛ 
;
ЛЛ 
appНН 
.
НН 
MapControllers
НН 
(
НН 
)
НН 
;
НН 
appПП 
.
ПП 
UseMiddleware
ПП 
<
ПП )
ExceptionHandlingMiddleware
ПП -
>
ПП- .
(
ПП. /
)
ПП/ 0
;
ПП0 1
appСС 
.
СС !
UseHttpsRedirection
СС 
(
СС 
)
СС 
;
СС 
usingУУ 
(
УУ 
var
УУ 

scope
УУ 
=
УУ 
app
УУ 
.
УУ 
Services
УУ 
.
УУ  
CreateScope
УУ  +
(
УУ+ ,
)
УУ, -
)
УУ- .
{ФФ 
var
ХХ 
services
ХХ 
=
ХХ 
scope
ХХ 
.
ХХ 
ServiceProvider
ХХ (
;
ХХ( )
var
ЦЦ 
context
ЦЦ 
=
ЦЦ 
services
ЦЦ 
.
ЦЦ  
GetRequiredService
ЦЦ -
<
ЦЦ- .
DataContext
ЦЦ. 9
>
ЦЦ9 :
(
ЦЦ: ;
)
ЦЦ; <
;
ЦЦ< =
DataInitializer
ЧЧ 
.
ЧЧ 

Initialize
ЧЧ 
(
ЧЧ 
context
ЧЧ &
)
ЧЧ& '
;
ЧЧ' (
}ШШ 
appЪЪ 
.
ЪЪ 
Run
ЪЪ 
(
ЪЪ 
)
ЪЪ 	
;
ЪЪ	 
ь	
8C:\work\BSUIR\crypto-wallet\Backend\Models\Withdrawal.cs
	namespace 	
UP
 
. 
ModelsEF 
; 
public 
class 

Withdrawal 
: 
	BaseModel #
{ 
[ 
Key 
] 	
public
 
Guid 
Id 
{ 
get 
; 
set  #
;# $
}% &
[

 
Required

 
]

 
public

 
double

 
Quantity

 %
{

& '
get

( +
;

+ ,
set

- 0
;

0 1
}

2 3
[ 
Required 
] 
public 
double 

Commission '
{( )
get* -
;- .
set/ 2
;2 3
}4 5
[ 
Required 
] 
public 
Guid 
UserId !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 

virtual 
User 
User 
{ 
get "
;" #
set$ '
;' (
}) *
} ┴	
8C:\work\BSUIR\crypto-wallet\Backend\Models\UsersCoins.cs
	namespace 	
UP
 
. 
ModelsEF 
; 
public 
class 

UsersCoins 
: 
	BaseModel #
{ 
[ 
Key 
] 	
public
 
Guid 
Id 
{ 
get 
; 
set  #
;# $
}% &
[

 
Required

 
]

 
public

 
Guid

 
UserId

 !
{

" #
get

$ '
;

' (
set

) ,
;

, -
}

. /
[ 
Required 
] 
public 
Guid 
CoinId !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 

virtual 
User 
User 
{ 
get "
;" #
set$ '
;' (
}) *
public 

virtual 
Coin 
Coin 
{ 
get "
;" #
set$ '
;' (
}) *
} ╠
2C:\work\BSUIR\crypto-wallet\Backend\Models\User.cs
	namespace 	
UP
 
. 
ModelsEF 
; 
public 
class 
User 
: 
	BaseModel 
{ 
[ 
Key 
] 	
public
 
Guid 
Id 
{ 
get 
; 
set  #
;# $
}% &
[

 
Required

 
]

 
public

 
string

 
Login

 "
{

# $
get

% (
;

( )
set

* -
;

- .
}

/ 0
[ 
Required 
] 
public 
string 
Password %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
public 

string 
? 
Email 
{ 
get 
; 
set  #
;# $
}% &
[ 
Required 
] 
public 
bool 
	IsDeleted $
{% &
get' *
;* +
set, /
;/ 0
}1 2
[ 
Required 
] 
public 
int 
RoleId  
{! "
get# &
;& '
set( +
;+ ,
}- .
[ 
Required 
] 
public 
bool 
	IsBlocked $
{% &
get' *
;* +
set, /
;/ 0
}1 2
[ 
Required 
] 
public 
string 
Salt !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 

virtual 
ICollection 
< 
Blocking '
>' (
	Blockings) 2
{3 4
get5 8
;8 9
set: =
;= >
}? @
public 

virtual 
ICollection 
< 

Conversion )
>) *
Conversions+ 6
{7 8
get9 <
;< =
set> A
;A B
}C D
public 

virtual 
ICollection 
< 

UsersCoins )
>) *

UsersCoins+ 5
{6 7
get8 ;
;; <
set= @
;@ A
}B C
public 

virtual 
ICollection 
< 
LoginHistory +
>+ ,
LoginHistories- ;
{< =
get> A
;A B
setC F
;F G
}H I
public 

virtual 
ICollection 
< 
PreviousPassword /
>/ 0
PreviousPasswords1 B
{C D
getE H
;H I
setJ M
;M N
}O P
public 

virtual 
ICollection 
< 
Replenishment ,
>, -
Replenishments. <
{= >
get? B
;B C
setD G
;G H
}I J
public 

virtual 
ICollection 
< 
Transactions +
>+ ,
SentTransactions- =
{> ?
get@ C
;C D
setE H
;H I
}J K
public 

virtual 
ICollection 
< 
Transactions +
>+ , 
ReceivedTransactions- A
{B C
getD G
;G H
setI L
;L M
}N O
public   

virtual   
ICollection   
<   

Withdrawal   )
>  ) *
Withdrawals  + 6
{  7 8
get  9 <
;  < =
set  > A
;  A B
}  C D
}!! ё
:C:\work\BSUIR\crypto-wallet\Backend\Models\Transactions.cs
	namespace 	
UP
 
. 
ModelsEF 
; 
public 
class 
Transactions 
: 
	BaseModel %
{ 
[		 
Key		 
]		 	
public		
 
Guid		 
Id		 
{		 
get		 
;		 
set		  #
;		# $
}		% &
[ 
Required 
] 
public 
string 
CoinName %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
[ 
Required 
] 
public 
double 
Quantity %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
[ 
Required 
] 
public 
Guid 
SenderId #
{$ %
get& )
;) *
set+ .
;. /
}0 1
[ 
Required 
] 
public 
Guid 

ReceiverId %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
public 

virtual 
User 
Sender 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 

virtual 
User 
Receiver  
{! "
get# &
;& '
set( +
;+ ,
}- .
} ╡
5C:\work\BSUIR\crypto-wallet\Backend\Models\Service.cs
	namespace 	
UP
 
. 
Models 
; 
public 
class 
Service 
: 
	BaseModel  
{ 
[ 
Key 
] 	
public
 
Guid 
Id 
{ 
get 
; 
set  #
;# $
}% &
[

 
Required

 
]

 
public

 
string

 
Name

 !
{

" #
get

$ '
;

' (
set

) ,
;

, -
}

. /
[ 
Required 
] 
public 
string 
About "
{# $
get% (
;( )
set* -
;- .
}/ 0
[ 
Required 
] 
public 
string 
	PhotoName &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
} И
FC:\work\BSUIR\crypto-wallet\Backend\Models\RestorePasswordCodeModel.cs
	namespace 	
UP
 
. 
ModelsEF 
; 
public 
class $
RestorePasswordCodeModel %
:& '
	BaseModel( 1
{ 
[ 
Key 
] 	
public
 
Guid 
Id 
{ 
get 
; 
set  #
;# $
}% &
[

 
Required

 
]

 
public

 
string

 
Code

 !
{

" #
get

$ '
;

' (
set

) ,
;

, -
}

. /
[ 
Required 
] 
public 
string 
Email "
{# $
get% (
;( )
set* -
;- .
}/ 0
} Є	
;C:\work\BSUIR\crypto-wallet\Backend\Models\Replenishment.cs
	namespace 	
UP
 
. 
ModelsEF 
; 
public 
class 
Replenishment 
: 
	BaseModel &
{ 
[ 
Key 
] 	
public
 
Guid 
Id 
{ 
get 
; 
set  #
;# $
}% &
[

 
Required

 
]

 
public

 
double

 
Quantity

 %
{

& '
get

( +
;

+ ,
set

- 0
;

0 1
}

2 3
[ 
Required 
] 
public 
double 

Commission '
{( )
get* -
;- .
set/ 2
;2 3
}4 5
[ 
Required 
] 
public 
Guid 
UserId !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 

virtual 
User 
User 
{ 
get "
;" #
set$ '
;' (
}) *
} ┤
>C:\work\BSUIR\crypto-wallet\Backend\Models\PreviousPassword.cs
	namespace 	
UP
 
. 
ModelsEF 
; 
public 
class 
PreviousPassword 
: 
	BaseModel  )
{ 
[ 
Key 
] 	
public
 
Guid 
Id 
{ 
get 
; 
set  #
;# $
}% &
[

 
Required

 
]

 
public

 
Guid

 
UserId

 !
{

" #
get

$ '
;

' (
set

) ,
;

, -
}

. /
[ 
Required 
] 
public 
string "
PreviousPasswordHashed 3
{4 5
get6 9
;9 :
set; >
;> ?
}@ A
public 

virtual 
User 
User 
{ 
get "
;" #
set$ '
;' (
}) *
} ╤
:C:\work\BSUIR\crypto-wallet\Backend\Models\LoginHistory.cs
	namespace 	
UP
 
. 
ModelsEF 
; 
public 
class 
LoginHistory 
: 
	BaseModel %
{		 
[

 
Key

 
]

 	
public


 
Guid

 
Id

 
{

 
get

 
;

 
set

  #
;

# $
}

% &
[ 
Required 
] 
public 
string 
	IPAddress &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
[ 
Required 
] 
public 
Guid 
UserId !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 

virtual 
User 
User 
{ 
get "
;" #
set$ '
;' (
}) *
public 

static 
string 
GetIPAddress %
(% &
)& '
{ 
var 
	ipAddress 
= 
Dns 
. 
GetHostEntry (
(( )
Dns) ,
., -
GetHostName- 8
(8 9
)9 :
): ;
.; <
AddressList< G
. 
FirstOrDefault 
( 
ip 
=> !
ip" $
.$ %
AddressFamily% 2
==3 5
AddressFamily6 C
.C D
InterNetworkD P
)P Q
?Q R
.R S
ToStringS [
([ \
)\ ]
;] ^
return 
	ipAddress 
; 
} 
} ╘
@C:\work\BSUIR\crypto-wallet\Backend\Models\interfaces\IEntity.cs
	namespace 	
Entities
 
; 
public 
	interface 
IEntity 
{ 
Guid 
Id	 
{ 
get 
; 
set 
; 
} 
} ш

HC:\work\BSUIR\crypto-wallet\Backend\Models\EmailVerificationCodeModel.cs
	namespace 	
UP
 
. 
ModelsEF 
; 
public 
class &
EmailVerificationCodeModel '
:( )
	BaseModel* 3
{ 
[ 
Key 
] 	
public
 
Guid 
Id 
{ 
get 
; 
set  #
;# $
}% &
[

 
Required

 
]

 
public

 
string

 
Code

 !
{

" #
get

$ '
;

' (
set

) ,
;

, -
}

. /
[ 
Required 
] 
public 
string 
? 
Email #
{$ %
get& )
;) *
set+ .
;. /
}0 1
[ 
Required 
] 
public 
bool 

IsApproved %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
=4 5
false6 ;
;; <
[ 
Required 
] 
public 
Guid 
UserId !
{" #
get$ '
;' (
set) ,
;, -
}. /
} ╜

BC:\work\BSUIR\crypto-wallet\Backend\Models\CryptoCurrencyPrices.cs
	namespace 	
UP
 
. 
Models 
; 
public 
class  
CryptoCurrencyPrices !
:" #
	BaseModel$ -
{ 
[ 
Key 
] 	
public
 
Guid 
Id 
{ 
get 
; 
set  #
;# $
}% &
public

 

string

 
CoinShortName

 
{

  !
get

" %
;

% &
set

' *
;

* +
}

, -
public 

double 
Price 
{ 
get 
; 
set "
;" #
}$ %
public 

DateTime 
	Timestamp 
{ 
get  #
;# $
set% (
;( )
}* +
[ 
Required 
] 
public 
Guid 
CoinId !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 

virtual 
CoinListInfo 
Coin  $
{% &
get' *
;* +
set, /
;/ 0
}1 2
} ╤
8C:\work\BSUIR\crypto-wallet\Backend\Models\Conversion.cs
	namespace 	
UP
 
. 
ModelsEF 
; 
public 
class 

Conversion 
: 
	BaseModel #
{ 
[ 
Key 
] 	
public
 
Guid 
Id 
{ 
get 
; 
set  #
;# $
}% &
[

 
Required

 
]

 
public

 
double

 

Commission

 '
{

( )
get

* -
;

- .
set

/ 2
;

2 3
}

4 5
[ 
Required 
] 
public 
double 
BeginCoinQuantity .
{/ 0
get1 4
;4 5
set6 9
;9 :
}; <
[ 
Required 
] 
public 
double 
EndCoinQuantity ,
{- .
get/ 2
;2 3
set4 7
;7 8
}9 :
[ 
Required 
] 
public 
double 
QuantityUSD (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
[ 
Required 
] 
public 
string 
BeginCoinShortname /
{0 1
get2 5
;5 6
set7 :
;: ;
}< =
[ 
Required 
] 
public 
string 
EndCoinShortname -
{. /
get0 3
;3 4
set5 8
;8 9
}: ;
[ 
Required 
] 
public 
Guid 
UserId !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 

virtual 
User 
User 
{ 
get "
;" #
set$ '
;' (
}) *
} ─
:C:\work\BSUIR\crypto-wallet\Backend\Models\CoinListInfo.cs
	namespace 	
UP
 
. 
Models 
; 
public 
class 
CoinListInfo 
: 
	BaseModel %
{ 
[ 
Key 
] 	
public
 
Guid 
Id 
{ 
get 
; 
set  #
;# $
}% &
[

 
Required

 
]

 
public

 
string

 
	ShortName

 &
{

' (
get

) ,
;

, -
set

. 1
;

1 2
}

3 4
[ 
Required 
] 
public 
string 
FullName %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
[ 
Required 
] 
public 
bool 
IsActive #
{$ %
get& )
;) *
set+ .
;. /
}0 1
} Ъ*
>C:\work\BSUIR\crypto-wallet\Backend\Models\CoinsInformation.cs
	namespace 	
UP
 
. 
Models 
. 
Base 
; 
public 
class 
CoinsInformation 
{ 
public 

CoinsInformation 
( 
Guid  
id! #
,# $
string% +
fullName, 4
,4 5
string6 <
	shortName= F
,F G
stringH N
iconPathO W
,W X
doubleY _
dailyVolume` k
,k l
double 
dailyImpact 
, 
double "
price# (
,( )
double* 0'
percentagePriceChangePerDay1 L
,L M
doubleN T
quantityU ]
)] ^
{ 
Id 

= 
id 
; 
FullName		 
=		 
fullName		 
;		 
	ShortName

 
=

 
	shortName

 
;

 
IconPath 
= 
iconPath 
; 
DailyVolume 
= 
dailyVolume !
;! "
DailyImpact 
= 
dailyImpact !
;! "
Price 
= 
price 
; '
PercentagePriceChangePerDay #
=$ %'
percentagePriceChangePerDay& A
;A B
Quantity 
= 
quantity 
; 
} 
public 

CoinsInformation 
( 
string "
	shortName# ,
,, -
string. 4
fullName5 =
,= >
string? E
iconPathF N
,N O
doubleP V
dailyVolumeW b
,b c
doubled j
dailyImpactk v
,v w
double 
price 
, 
double '
percentagePriceChangePerDay 8
)8 9
{ 
FullName 
= 
fullName 
; 
	ShortName 
= 
	shortName 
; 
IconPath 
= 
iconPath 
; 
DailyVolume 
= 
dailyVolume !
;! "
DailyImpact 
= 
dailyImpact !
;! "
Price 
= 
price 
; '
PercentagePriceChangePerDay #
=$ %'
percentagePriceChangePerDay& A
;A B
} 
public 

CoinsInformation 
( 
) 
{   
}!! 
public## 

CoinsInformation## 
(## 
Guid##  
id##! #
,### $
string##% +
fullName##, 4
,##4 5
string##6 <
	shortName##= F
,##F G
double##H N
dailyVolume##O Z
,##Z [
double##\ b
dailyImpact##c n
,##n o
double$$ 
price$$ 
,$$ 
double$$ '
percentagePriceChangePerDay$$ 8
,$$8 9
double$$: @
quantity$$A I
)$$I J
{%% 
Id&& 

=&& 
id&& 
;&& 
FullName'' 
='' 
fullName'' 
;'' 
	ShortName(( 
=(( 
	shortName(( 
;(( 
DailyVolume)) 
=)) 
dailyVolume)) !
;))! "
DailyImpact** 
=** 
dailyImpact** !
;**! "
Price++ 
=++ 
price++ 
;++ '
PercentagePriceChangePerDay,, #
=,,$ %'
percentagePriceChangePerDay,,& A
;,,A B
Quantity-- 
=-- 
quantity-- 
;-- 
}.. 
public00 

Guid00 
Id00 
{00 
get00 
;00 
set00 
;00 
}00  
public11 

string11 
FullName11 
{11 
get11  
;11  !
set11" %
;11% &
}11' (
public22 

string22 
	ShortName22 
{22 
get22 !
;22! "
set22# &
;22& '
}22( )
public33 

string33 
IconPath33 
{33 
get33  
;33  !
set33" %
;33% &
}33' (
public44 

double44 
DailyVolume44 
{44 
get44  #
;44# $
set44% (
;44( )
}44* +
public55 

double55 
DailyImpact55 
{55 
get55  #
;55# $
set55% (
;55( )
}55* +
public66 

double66 
Price66 
{66 
get66 
;66 
set66 "
;66" #
}66$ %
public77 

double77 '
PercentagePriceChangePerDay77 -
{77. /
get770 3
;773 4
set775 8
;778 9
}77: ;
public99 

double99 
Quantity99 
{99 
get99  
;99  !
set99" %
;99% &
}99' (
}:: г'
6C:\work\BSUIR\crypto-wallet\Backend\Models\CoinList.cs
	namespace 	
UP
 
. 
Models 
; 
public 
class 
CoinList 
{		 
private

 
readonly

 
IDbRepository

 "
_dbRepository

# 0
;

0 1
public 

CoinList 
( 
IDbRepository !
dbRepository" .
). /
{ 
_dbRepository 
= 
dbRepository $
;$ %
} 
private 
static 
readonly 

Dictionary &
<& '
string' -
,- .
string/ 5
>5 6
CryptoDictionary7 G
=H I
newJ M
(M N
)N O
{ 
{ 	
$str
 
, 
$str 
} 
, 
{ 	
$str
 
, 
$str 
} 
, 
{ 	
$str	 
, 
$str 
} 
, 
{ 	
$str	 
, 
$str 
} 
,  
{ 	
$str	 
, 
$str 
} 
, 
{ 	
$str	 
, 
$str 
} 
, 
{ 	
$str	 
, 
$str 
} 
, 
{ 	
$str	 
, 
$str 
} 
, 
{ 	
$str	 
, 
$str 
} 
, 
{ 	
$str	 
, 
$str 
} 
, 
{ 	
$str	 
, 
$str 
} 
, 
{ 	
$str	 
, 
$str 
} 
, 
{ 	
$str	 
, 
$str 
} 
, 
{   	
$str  	 
,   
$str   
}   
,   
{!! 	
$str!!	 
,!! 
$str!! 
}!! 
,!! 
{"" 	
$str""	 
,"" 
$str"" 
}"" 
,"" 
{## 	
$str##	 
,## 
$str## 
}## 
,## 
{$$ 	
$str$$	 
,$$ 
$str$$ 
}$$ 
,$$ 
{%% 	
$str%%	 
,%% 
$str%% 
}%% 
,%% 
{&& 	
$str&&	 
,&& 
$str&& 
}&& 
,&& 
{'' 	
$str''	 
,'' 
$str'' 
}'' 
,'' 
{(( 	
$str((	 
,(( 
$str(( 
}(( 
,(( 
{)) 	
$str))	 
,)) 
$str)) 
})) 
,)) 
{** 	
$str**	 
,** 
$str** 
}** 
,** 
{++ 	
$str++	 
,++ 
$str++ 
}++ 
,++ 
{,, 	
$str,,	 
,,, 
$str,, 
},, 
,,,  
{-- 	
$str--	 
,-- 
$str-- 
}-- 
,--  
{.. 	
$str..	 
,.. 
$str.. 
}.. 
,.. 
{// 	
$str//	 
,// 
$str// 
}// 
,// 
{00 	
$str00
 
,00 
$str00 
}00 
}11 
;11 
public33 

async33 
Task33 
<33 

Dictionary33  
<33  !
string33! '
,33' (
string33) /
>33/ 0
>330 1
GetActiveCoins332 @
(33@ A
)33A B
{44 
var55 
	coinsList55 
=55 
await55 
_dbRepository55 +
.55+ ,
Get55, /
<55/ 0
CoinListInfo550 <
>55< =
(55= >
)55> ?
.66 
Where66 
(66 
x66 
=>66 
x66 
.66 
IsActive66 "
)66" #
.77 
ToListAsync77 
(77 
)77 
;77 
var99 
coins99 
=99 
	coinsList99 
.99 
ToDictionary99 *
(99* +
coin:: 
=>:: 
coin:: 
.:: 
	ShortName:: "
.::" #
ToLower::# *
(::* +
)::+ ,
,::, -
coin;; 
=>;; 
coin;; 
.;; 
FullName;; !
.;;! "
ToLower;;" )
(;;) *
);;* +
)<< 	
;<<	 

return>> 
coins>> 
;>> 
}?? 
}@@ ш
2C:\work\BSUIR\crypto-wallet\Backend\Models\Coin.cs
	namespace 	
UP
 
. 
ModelsEF 
; 
public 
class 
Coin 
: 
	BaseModel 
{ 
[ 
Key 
] 	
public
 
Guid 
Id 
{ 
get 
; 
set  #
;# $
}% &
[

 
Required

 
]

 
public

 
double

 
Quantity

 %
{

& '
get

( +
;

+ ,
set

- 0
;

0 1
}

2 3
[ 
Required 
] 
public 
string 
	Shortname &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
} ║
6C:\work\BSUIR\crypto-wallet\Backend\Models\Blocking.cs
public 
class 
Blocking 
: 
	BaseModel !
{ 
[ 
Key 
] 	
public
 
Guid 
Id 
{ 
get 
; 
set  #
;# $
}% &
[		 
Required		 
]		 
public		 
string		 
Cause		 "
{		# $
get		% (
;		( )
set		* -
;		- .
}		/ 0
[ 
Required 
] 
public 
Guid 
UserId !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 

virtual 
User 
User 
{ 
get "
;" #
set$ '
;' (
}) *
} й
7C:\work\BSUIR\crypto-wallet\Backend\Models\BaseModel.cs
	namespace 	
Entities
 
; 
public 
class 
	BaseModel 
: 
IEntity  
{ 
public 

DateTime 
DateCreated 
{  !
get" %
;% &
set' *
;* +
}, -
=. /
DateTime0 8
.8 9
UtcNow9 ?
;? @
public 

DateTime 
? 
DateUpdated  
{! "
get# &
;& '
set( +
;+ ,
}- .
public		 

Guid		 
Id		 
{		 
get		 
;		 
set		 
;		 
}		  
}

 ╖м
HC:\work\BSUIR\crypto-wallet\Backend\Migrations\20240218134628_initial.cs
	namespace 	
UP
 
. 

Migrations 
{ 
public		 

partial		 
class		 
initial		  
:		! "
	Migration		# ,
{

 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str %
,% &
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
Guid& *
>* +
(+ ,
type, 0
:0 1
$str2 8
,8 9
nullable: B
:B C
falseD I
)I J
,J K
	ShortName 
= 
table  %
.% &
Column& ,
<, -
string- 3
>3 4
(4 5
type5 9
:9 :
$str; A
,A B
nullableC K
:K L
falseM R
)R S
,S T
FullName 
= 
table $
.$ %
Column% +
<+ ,
string, 2
>2 3
(3 4
type4 8
:8 9
$str: @
,@ A
nullableB J
:J K
falseL Q
)Q R
,R S
IsActive 
= 
table $
.$ %
Column% +
<+ ,
bool, 0
>0 1
(1 2
type2 6
:6 7
$str8 A
,A B
nullableC K
:K L
falseM R
)R S
,S T
DateCreated 
=  !
table" '
.' (
Column( .
<. /
DateTime/ 7
>7 8
(8 9
type9 =
:= >
$str? Y
,Y Z
nullable[ c
:c d
falsee j
)j k
,k l
DateUpdated 
=  !
table" '
.' (
Column( .
<. /
DateTime/ 7
>7 8
(8 9
type9 =
:= >
$str? Y
,Y Z
nullable[ c
:c d
truee i
)i j
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 7
,7 8
x9 :
=>; =
x> ?
.? @
Id@ B
)B C
;C D
} 
) 
; 
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str 
, 
columns   
:   
table   
=>   !
new  " %
{!! 
Id"" 
="" 
table"" 
."" 
Column"" %
<""% &
Guid""& *
>""* +
(""+ ,
type"", 0
:""0 1
$str""2 8
,""8 9
nullable"": B
:""B C
false""D I
)""I J
,""J K
Quantity## 
=## 
table## $
.##$ %
Column##% +
<##+ ,
double##, 2
>##2 3
(##3 4
type##4 8
:##8 9
$str##: L
,##L M
nullable##N V
:##V W
false##X ]
)##] ^
,##^ _
	Shortname$$ 
=$$ 
table$$  %
.$$% &
Column$$& ,
<$$, -
string$$- 3
>$$3 4
($$4 5
type$$5 9
:$$9 :
$str$$; A
,$$A B
nullable$$C K
:$$K L
false$$M R
)$$R S
,$$S T
DateCreated%% 
=%%  !
table%%" '
.%%' (
Column%%( .
<%%. /
DateTime%%/ 7
>%%7 8
(%%8 9
type%%9 =
:%%= >
$str%%? Y
,%%Y Z
nullable%%[ c
:%%c d
false%%e j
)%%j k
,%%k l
DateUpdated&& 
=&&  !
table&&" '
.&&' (
Column&&( .
<&&. /
DateTime&&/ 7
>&&7 8
(&&8 9
type&&9 =
:&&= >
$str&&? Y
,&&Y Z
nullable&&[ c
:&&c d
true&&e i
)&&i j
}'' 
,'' 
constraints(( 
:(( 
table(( "
=>((# %
{)) 
table** 
.** 

PrimaryKey** $
(**$ %
$str**% /
,**/ 0
x**1 2
=>**3 5
x**6 7
.**7 8
Id**8 :
)**: ;
;**; <
}++ 
)++ 
;++ 
migrationBuilder-- 
.-- 
CreateTable-- (
(--( )
name.. 
:.. 
$str.. 2
,..2 3
columns// 
:// 
table// 
=>// !
new//" %
{00 
Id11 
=11 
table11 
.11 
Column11 %
<11% &
Guid11& *
>11* +
(11+ ,
type11, 0
:110 1
$str112 8
,118 9
nullable11: B
:11B C
false11D I
)11I J
,11J K
Code22 
=22 
table22  
.22  !
Column22! '
<22' (
string22( .
>22. /
(22/ 0
type220 4
:224 5
$str226 <
,22< =
nullable22> F
:22F G
false22H M
)22M N
,22N O
Email33 
=33 
table33 !
.33! "
Column33" (
<33( )
string33) /
>33/ 0
(330 1
type331 5
:335 6
$str337 =
,33= >
nullable33? G
:33G H
false33I N
)33N O
,33O P

IsApproved44 
=44  
table44! &
.44& '
Column44' -
<44- .
bool44. 2
>442 3
(443 4
type444 8
:448 9
$str44: C
,44C D
nullable44E M
:44M N
false44O T
)44T U
,44U V
UserId55 
=55 
table55 "
.55" #
Column55# )
<55) *
Guid55* .
>55. /
(55/ 0
type550 4
:554 5
$str556 <
,55< =
nullable55> F
:55F G
false55H M
)55M N
,55N O
DateCreated66 
=66  !
table66" '
.66' (
Column66( .
<66. /
DateTime66/ 7
>667 8
(668 9
type669 =
:66= >
$str66? Y
,66Y Z
nullable66[ c
:66c d
false66e j
)66j k
,66k l
DateUpdated77 
=77  !
table77" '
.77' (
Column77( .
<77. /
DateTime77/ 7
>777 8
(778 9
type779 =
:77= >
$str77? Y
,77Y Z
nullable77[ c
:77c d
true77e i
)77i j
}88 
,88 
constraints99 
:99 
table99 "
=>99# %
{:: 
table;; 
.;; 

PrimaryKey;; $
(;;$ %
$str;;% D
,;;D E
x;;F G
=>;;H J
x;;K L
.;;L M
Id;;M O
);;O P
;;;P Q
}<< 
)<< 
;<< 
migrationBuilder>> 
.>> 
CreateTable>> (
(>>( )
name?? 
:?? 
$str?? ,
,??, -
columns@@ 
:@@ 
table@@ 
=>@@ !
new@@" %
{AA 
IdBB 
=BB 
tableBB 
.BB 
ColumnBB %
<BB% &
GuidBB& *
>BB* +
(BB+ ,
typeBB, 0
:BB0 1
$strBB2 8
,BB8 9
nullableBB: B
:BBB C
falseBBD I
)BBI J
,BBJ K
CodeCC 
=CC 
tableCC  
.CC  !
ColumnCC! '
<CC' (
stringCC( .
>CC. /
(CC/ 0
typeCC0 4
:CC4 5
$strCC6 <
,CC< =
nullableCC> F
:CCF G
falseCCH M
)CCM N
,CCN O
EmailDD 
=DD 
tableDD !
.DD! "
ColumnDD" (
<DD( )
stringDD) /
>DD/ 0
(DD0 1
typeDD1 5
:DD5 6
$strDD7 =
,DD= >
nullableDD? G
:DDG H
falseDDI N
)DDN O
,DDO P
DateCreatedEE 
=EE  !
tableEE" '
.EE' (
ColumnEE( .
<EE. /
DateTimeEE/ 7
>EE7 8
(EE8 9
typeEE9 =
:EE= >
$strEE? Y
,EEY Z
nullableEE[ c
:EEc d
falseEEe j
)EEj k
,EEk l
DateUpdatedFF 
=FF  !
tableFF" '
.FF' (
ColumnFF( .
<FF. /
DateTimeFF/ 7
>FF7 8
(FF8 9
typeFF9 =
:FF= >
$strFF? Y
,FFY Z
nullableFF[ c
:FFc d
trueFFe i
)FFi j
}GG 
,GG 
constraintsHH 
:HH 
tableHH "
=>HH# %
{II 
tableJJ 
.JJ 

PrimaryKeyJJ $
(JJ$ %
$strJJ% >
,JJ> ?
xJJ@ A
=>JJB D
xJJE F
.JJF G
IdJJG I
)JJI J
;JJJ K
}KK 
)KK 
;KK 
migrationBuilderMM 
.MM 
CreateTableMM (
(MM( )
nameNN 
:NN 
$strNN  
,NN  !
columnsOO 
:OO 
tableOO 
=>OO !
newOO" %
{PP 
IdQQ 
=QQ 
tableQQ 
.QQ 
ColumnQQ %
<QQ% &
GuidQQ& *
>QQ* +
(QQ+ ,
typeQQ, 0
:QQ0 1
$strQQ2 8
,QQ8 9
nullableQQ: B
:QQB C
falseQQD I
)QQI J
,QQJ K
NameRR 
=RR 
tableRR  
.RR  !
ColumnRR! '
<RR' (
stringRR( .
>RR. /
(RR/ 0
typeRR0 4
:RR4 5
$strRR6 <
,RR< =
nullableRR> F
:RRF G
falseRRH M
)RRM N
,RRN O
AboutSS 
=SS 
tableSS !
.SS! "
ColumnSS" (
<SS( )
stringSS) /
>SS/ 0
(SS0 1
typeSS1 5
:SS5 6
$strSS7 =
,SS= >
nullableSS? G
:SSG H
falseSSI N
)SSN O
,SSO P
	PhotoNameTT 
=TT 
tableTT  %
.TT% &
ColumnTT& ,
<TT, -
stringTT- 3
>TT3 4
(TT4 5
typeTT5 9
:TT9 :
$strTT; A
,TTA B
nullableTTC K
:TTK L
falseTTM R
)TTR S
,TTS T
DateCreatedUU 
=UU  !
tableUU" '
.UU' (
ColumnUU( .
<UU. /
DateTimeUU/ 7
>UU7 8
(UU8 9
typeUU9 =
:UU= >
$strUU? Y
,UUY Z
nullableUU[ c
:UUc d
falseUUe j
)UUj k
,UUk l
DateUpdatedVV 
=VV  !
tableVV" '
.VV' (
ColumnVV( .
<VV. /
DateTimeVV/ 7
>VV7 8
(VV8 9
typeVV9 =
:VV= >
$strVV? Y
,VVY Z
nullableVV[ c
:VVc d
trueVVe i
)VVi j
}WW 
,WW 
constraintsXX 
:XX 
tableXX "
=>XX# %
{YY 
tableZZ 
.ZZ 

PrimaryKeyZZ $
(ZZ$ %
$strZZ% 2
,ZZ2 3
xZZ4 5
=>ZZ6 8
xZZ9 :
.ZZ: ;
IdZZ; =
)ZZ= >
;ZZ> ?
}[[ 
)[[ 
;[[ 
migrationBuilder]] 
.]] 
CreateTable]] (
(]]( )
name^^ 
:^^ 
$str^^ 
,^^ 
columns__ 
:__ 
table__ 
=>__ !
new__" %
{`` 
Idaa 
=aa 
tableaa 
.aa 
Columnaa %
<aa% &
Guidaa& *
>aa* +
(aa+ ,
typeaa, 0
:aa0 1
$straa2 8
,aa8 9
nullableaa: B
:aaB C
falseaaD I
)aaI J
,aaJ K
Loginbb 
=bb 
tablebb !
.bb! "
Columnbb" (
<bb( )
stringbb) /
>bb/ 0
(bb0 1
typebb1 5
:bb5 6
$strbb7 =
,bb= >
nullablebb? G
:bbG H
falsebbI N
)bbN O
,bbO P
Passwordcc 
=cc 
tablecc $
.cc$ %
Columncc% +
<cc+ ,
stringcc, 2
>cc2 3
(cc3 4
typecc4 8
:cc8 9
$strcc: @
,cc@ A
nullableccB J
:ccJ K
falseccL Q
)ccQ R
,ccR S
Emaildd 
=dd 
tabledd !
.dd! "
Columndd" (
<dd( )
stringdd) /
>dd/ 0
(dd0 1
typedd1 5
:dd5 6
$strdd7 =
,dd= >
nullabledd? G
:ddG H
trueddI M
)ddM N
,ddN O
	IsDeletedee 
=ee 
tableee  %
.ee% &
Columnee& ,
<ee, -
boolee- 1
>ee1 2
(ee2 3
typeee3 7
:ee7 8
$stree9 B
,eeB C
nullableeeD L
:eeL M
falseeeN S
)eeS T
,eeT U
RoleIdff 
=ff 
tableff "
.ff" #
Columnff# )
<ff) *
intff* -
>ff- .
(ff. /
typeff/ 3
:ff3 4
$strff5 >
,ff> ?
nullableff@ H
:ffH I
falseffJ O
)ffO P
,ffP Q
	IsBlockedgg 
=gg 
tablegg  %
.gg% &
Columngg& ,
<gg, -
boolgg- 1
>gg1 2
(gg2 3
typegg3 7
:gg7 8
$strgg9 B
,ggB C
nullableggD L
:ggL M
falseggN S
)ggS T
,ggT U
Salthh 
=hh 
tablehh  
.hh  !
Columnhh! '
<hh' (
stringhh( .
>hh. /
(hh/ 0
typehh0 4
:hh4 5
$strhh6 <
,hh< =
nullablehh> F
:hhF G
falsehhH M
)hhM N
,hhN O
DateCreatedii 
=ii  !
tableii" '
.ii' (
Columnii( .
<ii. /
DateTimeii/ 7
>ii7 8
(ii8 9
typeii9 =
:ii= >
$strii? Y
,iiY Z
nullableii[ c
:iic d
falseiie j
)iij k
,iik l
DateUpdatedjj 
=jj  !
tablejj" '
.jj' (
Columnjj( .
<jj. /
DateTimejj/ 7
>jj7 8
(jj8 9
typejj9 =
:jj= >
$strjj? Y
,jjY Z
nullablejj[ c
:jjc d
truejje i
)jji j
}kk 
,kk 
constraintsll 
:ll 
tablell "
=>ll# %
{mm 
tablenn 
.nn 

PrimaryKeynn $
(nn$ %
$strnn% /
,nn/ 0
xnn1 2
=>nn3 5
xnn6 7
.nn7 8
Idnn8 :
)nn: ;
;nn; <
}oo 
)oo 
;oo 
migrationBuilderqq 
.qq 
CreateTableqq (
(qq( )
namerr 
:rr 
$strrr #
,rr# $
columnsss 
:ss 
tabless 
=>ss !
newss" %
{tt 
Iduu 
=uu 
tableuu 
.uu 
Columnuu %
<uu% &
Guiduu& *
>uu* +
(uu+ ,
typeuu, 0
:uu0 1
$struu2 8
,uu8 9
nullableuu: B
:uuB C
falseuuD I
)uuI J
,uuJ K
CoinShortNamevv !
=vv" #
tablevv$ )
.vv) *
Columnvv* 0
<vv0 1
stringvv1 7
>vv7 8
(vv8 9
typevv9 =
:vv= >
$strvv? E
,vvE F
nullablevvG O
:vvO P
falsevvQ V
)vvV W
,vvW X
Priceww 
=ww 
tableww !
.ww! "
Columnww" (
<ww( )
doubleww) /
>ww/ 0
(ww0 1
typeww1 5
:ww5 6
$strww7 I
,wwI J
nullablewwK S
:wwS T
falsewwU Z
)wwZ [
,ww[ \
	Timestampxx 
=xx 
tablexx  %
.xx% &
Columnxx& ,
<xx, -
DateTimexx- 5
>xx5 6
(xx6 7
typexx7 ;
:xx; <
$strxx= W
,xxW X
nullablexxY a
:xxa b
falsexxc h
)xxh i
,xxi j
CoinIdyy 
=yy 
tableyy "
.yy" #
Columnyy# )
<yy) *
Guidyy* .
>yy. /
(yy/ 0
typeyy0 4
:yy4 5
$stryy6 <
,yy< =
nullableyy> F
:yyF G
falseyyH M
)yyM N
,yyN O
DateCreatedzz 
=zz  !
tablezz" '
.zz' (
Columnzz( .
<zz. /
DateTimezz/ 7
>zz7 8
(zz8 9
typezz9 =
:zz= >
$strzz? Y
,zzY Z
nullablezz[ c
:zzc d
falsezze j
)zzj k
,zzk l
DateUpdated{{ 
={{  !
table{{" '
.{{' (
Column{{( .
<{{. /
DateTime{{/ 7
>{{7 8
({{8 9
type{{9 =
:{{= >
$str{{? Y
,{{Y Z
nullable{{[ c
:{{c d
true{{e i
){{i j
}|| 
,|| 
constraints}} 
:}} 
table}} "
=>}}# %
{~~ 
table 
. 

PrimaryKey $
($ %
$str% 5
,5 6
x7 8
=>9 ;
x< =
.= >
Id> @
)@ A
;A B
table
АА 
.
АА 

ForeignKey
АА $
(
АА$ %
name
ББ 
:
ББ 
$str
ББ C
,
ББC D
column
ВВ 
:
ВВ 
x
ВВ  !
=>
ВВ" $
x
ВВ% &
.
ВВ& '
CoinId
ВВ' -
,
ВВ- .
principalTable
ГГ &
:
ГГ& '
$str
ГГ( 7
,
ГГ7 8
principalColumn
ДД '
:
ДД' (
$str
ДД) -
,
ДД- .
onDelete
ЕЕ  
:
ЕЕ  !
ReferentialAction
ЕЕ" 3
.
ЕЕ3 4
Cascade
ЕЕ4 ;
)
ЕЕ; <
;
ЕЕ< =
}
ЖЖ 
)
ЖЖ 
;
ЖЖ 
migrationBuilder
ИИ 
.
ИИ 
CreateTable
ИИ (
(
ИИ( )
name
ЙЙ 
:
ЙЙ 
$str
ЙЙ !
,
ЙЙ! "
columns
КК 
:
КК 
table
КК 
=>
КК !
new
КК" %
{
ЛЛ 
Id
ММ 
=
ММ 
table
ММ 
.
ММ 
Column
ММ %
<
ММ% &
Guid
ММ& *
>
ММ* +
(
ММ+ ,
type
ММ, 0
:
ММ0 1
$str
ММ2 8
,
ММ8 9
nullable
ММ: B
:
ММB C
false
ММD I
)
ММI J
,
ММJ K
Cause
НН 
=
НН 
table
НН !
.
НН! "
Column
НН" (
<
НН( )
string
НН) /
>
НН/ 0
(
НН0 1
type
НН1 5
:
НН5 6
$str
НН7 =
,
НН= >
nullable
НН? G
:
ННG H
false
ННI N
)
ННN O
,
ННO P
UserId
ОО 
=
ОО 
table
ОО "
.
ОО" #
Column
ОО# )
<
ОО) *
Guid
ОО* .
>
ОО. /
(
ОО/ 0
type
ОО0 4
:
ОО4 5
$str
ОО6 <
,
ОО< =
nullable
ОО> F
:
ООF G
false
ООH M
)
ООM N
,
ООN O
DateCreated
ПП 
=
ПП  !
table
ПП" '
.
ПП' (
Column
ПП( .
<
ПП. /
DateTime
ПП/ 7
>
ПП7 8
(
ПП8 9
type
ПП9 =
:
ПП= >
$str
ПП? Y
,
ППY Z
nullable
ПП[ c
:
ППc d
false
ППe j
)
ППj k
,
ППk l
DateUpdated
РР 
=
РР  !
table
РР" '
.
РР' (
Column
РР( .
<
РР. /
DateTime
РР/ 7
>
РР7 8
(
РР8 9
type
РР9 =
:
РР= >
$str
РР? Y
,
РРY Z
nullable
РР[ c
:
РРc d
true
РРe i
)
РРi j
}
СС 
,
СС 
constraints
ТТ 
:
ТТ 
table
ТТ "
=>
ТТ# %
{
УУ 
table
ФФ 
.
ФФ 

PrimaryKey
ФФ $
(
ФФ$ %
$str
ФФ% 3
,
ФФ3 4
x
ФФ5 6
=>
ФФ7 9
x
ФФ: ;
.
ФФ; <
Id
ФФ< >
)
ФФ> ?
;
ФФ? @
table
ХХ 
.
ХХ 

ForeignKey
ХХ $
(
ХХ$ %
name
ЦЦ 
:
ЦЦ 
$str
ЦЦ 9
,
ЦЦ9 :
column
ЧЧ 
:
ЧЧ 
x
ЧЧ  !
=>
ЧЧ" $
x
ЧЧ% &
.
ЧЧ& '
UserId
ЧЧ' -
,
ЧЧ- .
principalTable
ШШ &
:
ШШ& '
$str
ШШ( /
,
ШШ/ 0
principalColumn
ЩЩ '
:
ЩЩ' (
$str
ЩЩ) -
,
ЩЩ- .
onDelete
ЪЪ  
:
ЪЪ  !
ReferentialAction
ЪЪ" 3
.
ЪЪ3 4
Cascade
ЪЪ4 ;
)
ЪЪ; <
;
ЪЪ< =
}
ЫЫ 
)
ЫЫ 
;
ЫЫ 
migrationBuilder
ЭЭ 
.
ЭЭ 
CreateTable
ЭЭ (
(
ЭЭ( )
name
ЮЮ 
:
ЮЮ 
$str
ЮЮ #
,
ЮЮ# $
columns
ЯЯ 
:
ЯЯ 
table
ЯЯ 
=>
ЯЯ !
new
ЯЯ" %
{
аа 
Id
бб 
=
бб 
table
бб 
.
бб 
Column
бб %
<
бб% &
Guid
бб& *
>
бб* +
(
бб+ ,
type
бб, 0
:
бб0 1
$str
бб2 8
,
бб8 9
nullable
бб: B
:
ббB C
false
ббD I
)
ббI J
,
ббJ K

Commission
вв 
=
вв  
table
вв! &
.
вв& '
Column
вв' -
<
вв- .
double
вв. 4
>
вв4 5
(
вв5 6
type
вв6 :
:
вв: ;
$str
вв< N
,
ввN O
nullable
ввP X
:
ввX Y
false
ввZ _
)
вв_ `
,
вв` a
BeginCoinQuantity
гг %
=
гг& '
table
гг( -
.
гг- .
Column
гг. 4
<
гг4 5
double
гг5 ;
>
гг; <
(
гг< =
type
гг= A
:
ггA B
$str
ггC U
,
ггU V
nullable
ггW _
:
гг_ `
false
ггa f
)
ггf g
,
ггg h
EndCoinQuantity
дд #
=
дд$ %
table
дд& +
.
дд+ ,
Column
дд, 2
<
дд2 3
double
дд3 9
>
дд9 :
(
дд: ;
type
дд; ?
:
дд? @
$str
ддA S
,
ддS T
nullable
ддU ]
:
дд] ^
false
дд_ d
)
ддd e
,
ддe f
QuantityUSD
ее 
=
ее  !
table
ее" '
.
ее' (
Column
ее( .
<
ее. /
double
ее/ 5
>
ее5 6
(
ее6 7
type
ее7 ;
:
ее; <
$str
ее= O
,
ееO P
nullable
ееQ Y
:
ееY Z
false
ее[ `
)
ее` a
,
ееa b 
BeginCoinShortname
жж &
=
жж' (
table
жж) .
.
жж. /
Column
жж/ 5
<
жж5 6
string
жж6 <
>
жж< =
(
жж= >
type
жж> B
:
жжB C
$str
жжD J
,
жжJ K
nullable
жжL T
:
жжT U
false
жжV [
)
жж[ \
,
жж\ ]
EndCoinShortname
зз $
=
зз% &
table
зз' ,
.
зз, -
Column
зз- 3
<
зз3 4
string
зз4 :
>
зз: ;
(
зз; <
type
зз< @
:
зз@ A
$str
ззB H
,
ззH I
nullable
ззJ R
:
ззR S
false
ззT Y
)
ззY Z
,
ззZ [
UserId
ии 
=
ии 
table
ии "
.
ии" #
Column
ии# )
<
ии) *
Guid
ии* .
>
ии. /
(
ии/ 0
type
ии0 4
:
ии4 5
$str
ии6 <
,
ии< =
nullable
ии> F
:
ииF G
false
ииH M
)
ииM N
,
ииN O
DateCreated
йй 
=
йй  !
table
йй" '
.
йй' (
Column
йй( .
<
йй. /
DateTime
йй/ 7
>
йй7 8
(
йй8 9
type
йй9 =
:
йй= >
$str
йй? Y
,
ййY Z
nullable
йй[ c
:
ййc d
false
ййe j
)
ййj k
,
ййk l
DateUpdated
кк 
=
кк  !
table
кк" '
.
кк' (
Column
кк( .
<
кк. /
DateTime
кк/ 7
>
кк7 8
(
кк8 9
type
кк9 =
:
кк= >
$str
кк? Y
,
ккY Z
nullable
кк[ c
:
ккc d
true
ккe i
)
ккi j
}
лл 
,
лл 
constraints
мм 
:
мм 
table
мм "
=>
мм# %
{
нн 
table
оо 
.
оо 

PrimaryKey
оо $
(
оо$ %
$str
оо% 5
,
оо5 6
x
оо7 8
=>
оо9 ;
x
оо< =
.
оо= >
Id
оо> @
)
оо@ A
;
ооA B
table
пп 
.
пп 

ForeignKey
пп $
(
пп$ %
name
░░ 
:
░░ 
$str
░░ ;
,
░░; <
column
▒▒ 
:
▒▒ 
x
▒▒  !
=>
▒▒" $
x
▒▒% &
.
▒▒& '
UserId
▒▒' -
,
▒▒- .
principalTable
▓▓ &
:
▓▓& '
$str
▓▓( /
,
▓▓/ 0
principalColumn
││ '
:
││' (
$str
││) -
,
││- .
onDelete
┤┤  
:
┤┤  !
ReferentialAction
┤┤" 3
.
┤┤3 4
Cascade
┤┤4 ;
)
┤┤; <
;
┤┤< =
}
╡╡ 
)
╡╡ 
;
╡╡ 
migrationBuilder
╖╖ 
.
╖╖ 
CreateTable
╖╖ (
(
╖╖( )
name
╕╕ 
:
╕╕ 
$str
╕╕ &
,
╕╕& '
columns
╣╣ 
:
╣╣ 
table
╣╣ 
=>
╣╣ !
new
╣╣" %
{
║║ 
Id
╗╗ 
=
╗╗ 
table
╗╗ 
.
╗╗ 
Column
╗╗ %
<
╗╗% &
Guid
╗╗& *
>
╗╗* +
(
╗╗+ ,
type
╗╗, 0
:
╗╗0 1
$str
╗╗2 8
,
╗╗8 9
nullable
╗╗: B
:
╗╗B C
false
╗╗D I
)
╗╗I J
,
╗╗J K
	IPAddress
╝╝ 
=
╝╝ 
table
╝╝  %
.
╝╝% &
Column
╝╝& ,
<
╝╝, -
string
╝╝- 3
>
╝╝3 4
(
╝╝4 5
type
╝╝5 9
:
╝╝9 :
$str
╝╝; A
,
╝╝A B
nullable
╝╝C K
:
╝╝K L
false
╝╝M R
)
╝╝R S
,
╝╝S T
UserId
╜╜ 
=
╜╜ 
table
╜╜ "
.
╜╜" #
Column
╜╜# )
<
╜╜) *
Guid
╜╜* .
>
╜╜. /
(
╜╜/ 0
type
╜╜0 4
:
╜╜4 5
$str
╜╜6 <
,
╜╜< =
nullable
╜╜> F
:
╜╜F G
false
╜╜H M
)
╜╜M N
,
╜╜N O
DateCreated
╛╛ 
=
╛╛  !
table
╛╛" '
.
╛╛' (
Column
╛╛( .
<
╛╛. /
DateTime
╛╛/ 7
>
╛╛7 8
(
╛╛8 9
type
╛╛9 =
:
╛╛= >
$str
╛╛? Y
,
╛╛Y Z
nullable
╛╛[ c
:
╛╛c d
false
╛╛e j
)
╛╛j k
,
╛╛k l
DateUpdated
┐┐ 
=
┐┐  !
table
┐┐" '
.
┐┐' (
Column
┐┐( .
<
┐┐. /
DateTime
┐┐/ 7
>
┐┐7 8
(
┐┐8 9
type
┐┐9 =
:
┐┐= >
$str
┐┐? Y
,
┐┐Y Z
nullable
┐┐[ c
:
┐┐c d
true
┐┐e i
)
┐┐i j
}
└└ 
,
└└ 
constraints
┴┴ 
:
┴┴ 
table
┴┴ "
=>
┴┴# %
{
┬┬ 
table
├├ 
.
├├ 

PrimaryKey
├├ $
(
├├$ %
$str
├├% 8
,
├├8 9
x
├├: ;
=>
├├< >
x
├├? @
.
├├@ A
Id
├├A C
)
├├C D
;
├├D E
table
── 
.
── 

ForeignKey
── $
(
──$ %
name
┼┼ 
:
┼┼ 
$str
┼┼ >
,
┼┼> ?
column
╞╞ 
:
╞╞ 
x
╞╞  !
=>
╞╞" $
x
╞╞% &
.
╞╞& '
UserId
╞╞' -
,
╞╞- .
principalTable
╟╟ &
:
╟╟& '
$str
╟╟( /
,
╟╟/ 0
principalColumn
╚╚ '
:
╚╚' (
$str
╚╚) -
,
╚╚- .
onDelete
╔╔  
:
╔╔  !
ReferentialAction
╔╔" 3
.
╔╔3 4
Cascade
╔╔4 ;
)
╔╔; <
;
╔╔< =
}
╩╩ 
)
╩╩ 
;
╩╩ 
migrationBuilder
╠╠ 
.
╠╠ 
CreateTable
╠╠ (
(
╠╠( )
name
══ 
:
══ 
$str
══ )
,
══) *
columns
╬╬ 
:
╬╬ 
table
╬╬ 
=>
╬╬ !
new
╬╬" %
{
╧╧ 
Id
╨╨ 
=
╨╨ 
table
╨╨ 
.
╨╨ 
Column
╨╨ %
<
╨╨% &
Guid
╨╨& *
>
╨╨* +
(
╨╨+ ,
type
╨╨, 0
:
╨╨0 1
$str
╨╨2 8
,
╨╨8 9
nullable
╨╨: B
:
╨╨B C
false
╨╨D I
)
╨╨I J
,
╨╨J K
UserId
╤╤ 
=
╤╤ 
table
╤╤ "
.
╤╤" #
Column
╤╤# )
<
╤╤) *
Guid
╤╤* .
>
╤╤. /
(
╤╤/ 0
type
╤╤0 4
:
╤╤4 5
$str
╤╤6 <
,
╤╤< =
nullable
╤╤> F
:
╤╤F G
false
╤╤H M
)
╤╤M N
,
╤╤N O$
PreviousPasswordHashed
╥╥ *
=
╥╥+ ,
table
╥╥- 2
.
╥╥2 3
Column
╥╥3 9
<
╥╥9 :
string
╥╥: @
>
╥╥@ A
(
╥╥A B
type
╥╥B F
:
╥╥F G
$str
╥╥H N
,
╥╥N O
nullable
╥╥P X
:
╥╥X Y
false
╥╥Z _
)
╥╥_ `
,
╥╥` a
DateCreated
╙╙ 
=
╙╙  !
table
╙╙" '
.
╙╙' (
Column
╙╙( .
<
╙╙. /
DateTime
╙╙/ 7
>
╙╙7 8
(
╙╙8 9
type
╙╙9 =
:
╙╙= >
$str
╙╙? Y
,
╙╙Y Z
nullable
╙╙[ c
:
╙╙c d
false
╙╙e j
)
╙╙j k
,
╙╙k l
DateUpdated
╘╘ 
=
╘╘  !
table
╘╘" '
.
╘╘' (
Column
╘╘( .
<
╘╘. /
DateTime
╘╘/ 7
>
╘╘7 8
(
╘╘8 9
type
╘╘9 =
:
╘╘= >
$str
╘╘? Y
,
╘╘Y Z
nullable
╘╘[ c
:
╘╘c d
true
╘╘e i
)
╘╘i j
}
╒╒ 
,
╒╒ 
constraints
╓╓ 
:
╓╓ 
table
╓╓ "
=>
╓╓# %
{
╫╫ 
table
╪╪ 
.
╪╪ 

PrimaryKey
╪╪ $
(
╪╪$ %
$str
╪╪% ;
,
╪╪; <
x
╪╪= >
=>
╪╪? A
x
╪╪B C
.
╪╪C D
Id
╪╪D F
)
╪╪F G
;
╪╪G H
table
┘┘ 
.
┘┘ 

ForeignKey
┘┘ $
(
┘┘$ %
name
┌┌ 
:
┌┌ 
$str
┌┌ A
,
┌┌A B
column
██ 
:
██ 
x
██  !
=>
██" $
x
██% &
.
██& '
UserId
██' -
,
██- .
principalTable
▄▄ &
:
▄▄& '
$str
▄▄( /
,
▄▄/ 0
principalColumn
▌▌ '
:
▌▌' (
$str
▌▌) -
,
▌▌- .
onDelete
▐▐  
:
▐▐  !
ReferentialAction
▐▐" 3
.
▐▐3 4
Cascade
▐▐4 ;
)
▐▐; <
;
▐▐< =
}
▀▀ 
)
▀▀ 
;
▀▀ 
migrationBuilder
сс 
.
сс 
CreateTable
сс (
(
сс( )
name
тт 
:
тт 
$str
тт &
,
тт& '
columns
уу 
:
уу 
table
уу 
=>
уу !
new
уу" %
{
фф 
Id
хх 
=
хх 
table
хх 
.
хх 
Column
хх %
<
хх% &
Guid
хх& *
>
хх* +
(
хх+ ,
type
хх, 0
:
хх0 1
$str
хх2 8
,
хх8 9
nullable
хх: B
:
ххB C
false
ххD I
)
ххI J
,
ххJ K
Quantity
цц 
=
цц 
table
цц $
.
цц$ %
Column
цц% +
<
цц+ ,
double
цц, 2
>
цц2 3
(
цц3 4
type
цц4 8
:
цц8 9
$str
цц: L
,
ццL M
nullable
ццN V
:
ццV W
false
ццX ]
)
цц] ^
,
цц^ _

Commission
чч 
=
чч  
table
чч! &
.
чч& '
Column
чч' -
<
чч- .
double
чч. 4
>
чч4 5
(
чч5 6
type
чч6 :
:
чч: ;
$str
чч< N
,
ччN O
nullable
ччP X
:
ччX Y
false
ччZ _
)
чч_ `
,
чч` a
UserId
шш 
=
шш 
table
шш "
.
шш" #
Column
шш# )
<
шш) *
Guid
шш* .
>
шш. /
(
шш/ 0
type
шш0 4
:
шш4 5
$str
шш6 <
,
шш< =
nullable
шш> F
:
шшF G
false
шшH M
)
шшM N
,
шшN O
DateCreated
щщ 
=
щщ  !
table
щщ" '
.
щщ' (
Column
щщ( .
<
щщ. /
DateTime
щщ/ 7
>
щщ7 8
(
щщ8 9
type
щщ9 =
:
щщ= >
$str
щщ? Y
,
щщY Z
nullable
щщ[ c
:
щщc d
false
щщe j
)
щщj k
,
щщk l
DateUpdated
ъъ 
=
ъъ  !
table
ъъ" '
.
ъъ' (
Column
ъъ( .
<
ъъ. /
DateTime
ъъ/ 7
>
ъъ7 8
(
ъъ8 9
type
ъъ9 =
:
ъъ= >
$str
ъъ? Y
,
ъъY Z
nullable
ъъ[ c
:
ъъc d
true
ъъe i
)
ъъi j
}
ыы 
,
ыы 
constraints
ьь 
:
ьь 
table
ьь "
=>
ьь# %
{
ээ 
table
юю 
.
юю 

PrimaryKey
юю $
(
юю$ %
$str
юю% 8
,
юю8 9
x
юю: ;
=>
юю< >
x
юю? @
.
юю@ A
Id
ююA C
)
ююC D
;
ююD E
table
яя 
.
яя 

ForeignKey
яя $
(
яя$ %
name
ЁЁ 
:
ЁЁ 
$str
ЁЁ >
,
ЁЁ> ?
column
ёё 
:
ёё 
x
ёё  !
=>
ёё" $
x
ёё% &
.
ёё& '
UserId
ёё' -
,
ёё- .
principalTable
ЄЄ &
:
ЄЄ& '
$str
ЄЄ( /
,
ЄЄ/ 0
principalColumn
єє '
:
єє' (
$str
єє) -
,
єє- .
onDelete
ЇЇ  
:
ЇЇ  !
ReferentialAction
ЇЇ" 3
.
ЇЇ3 4
Cascade
ЇЇ4 ;
)
ЇЇ; <
;
ЇЇ< =
}
її 
)
її 
;
її 
migrationBuilder
ўў 
.
ўў 
CreateTable
ўў (
(
ўў( )
name
°° 
:
°° 
$str
°° $
,
°°$ %
columns
∙∙ 
:
∙∙ 
table
∙∙ 
=>
∙∙ !
new
∙∙" %
{
·· 
Id
√√ 
=
√√ 
table
√√ 
.
√√ 
Column
√√ %
<
√√% &
Guid
√√& *
>
√√* +
(
√√+ ,
type
√√, 0
:
√√0 1
$str
√√2 8
,
√√8 9
nullable
√√: B
:
√√B C
false
√√D I
)
√√I J
,
√√J K
CoinName
№№ 
=
№№ 
table
№№ $
.
№№$ %
Column
№№% +
<
№№+ ,
string
№№, 2
>
№№2 3
(
№№3 4
type
№№4 8
:
№№8 9
$str
№№: @
,
№№@ A
nullable
№№B J
:
№№J K
false
№№L Q
)
№№Q R
,
№№R S
Quantity
¤¤ 
=
¤¤ 
table
¤¤ $
.
¤¤$ %
Column
¤¤% +
<
¤¤+ ,
double
¤¤, 2
>
¤¤2 3
(
¤¤3 4
type
¤¤4 8
:
¤¤8 9
$str
¤¤: L
,
¤¤L M
nullable
¤¤N V
:
¤¤V W
false
¤¤X ]
)
¤¤] ^
,
¤¤^ _
SenderId
■■ 
=
■■ 
table
■■ $
.
■■$ %
Column
■■% +
<
■■+ ,
Guid
■■, 0
>
■■0 1
(
■■1 2
type
■■2 6
:
■■6 7
$str
■■8 >
,
■■> ?
nullable
■■@ H
:
■■H I
false
■■J O
)
■■O P
,
■■P Q

ReceiverId
   
=
    
table
  ! &
.
  & '
Column
  ' -
<
  - .
Guid
  . 2
>
  2 3
(
  3 4
type
  4 8
:
  8 9
$str
  : @
,
  @ A
nullable
  B J
:
  J K
false
  L Q
)
  Q R
,
  R S
DateCreated
АА 
=
АА  !
table
АА" '
.
АА' (
Column
АА( .
<
АА. /
DateTime
АА/ 7
>
АА7 8
(
АА8 9
type
АА9 =
:
АА= >
$str
АА? Y
,
ААY Z
nullable
АА[ c
:
ААc d
false
ААe j
)
ААj k
,
ААk l
DateUpdated
ББ 
=
ББ  !
table
ББ" '
.
ББ' (
Column
ББ( .
<
ББ. /
DateTime
ББ/ 7
>
ББ7 8
(
ББ8 9
type
ББ9 =
:
ББ= >
$str
ББ? Y
,
ББY Z
nullable
ББ[ c
:
ББc d
true
ББe i
)
ББi j
}
ВВ 
,
ВВ 
constraints
ГГ 
:
ГГ 
table
ГГ "
=>
ГГ# %
{
ДД 
table
ЕЕ 
.
ЕЕ 

PrimaryKey
ЕЕ $
(
ЕЕ$ %
$str
ЕЕ% 6
,
ЕЕ6 7
x
ЕЕ8 9
=>
ЕЕ: <
x
ЕЕ= >
.
ЕЕ> ?
Id
ЕЕ? A
)
ЕЕA B
;
ЕЕB C
table
ЖЖ 
.
ЖЖ 

ForeignKey
ЖЖ $
(
ЖЖ$ %
name
ЗЗ 
:
ЗЗ 
$str
ЗЗ @
,
ЗЗ@ A
column
ИИ 
:
ИИ 
x
ИИ  !
=>
ИИ" $
x
ИИ% &
.
ИИ& '

ReceiverId
ИИ' 1
,
ИИ1 2
principalTable
ЙЙ &
:
ЙЙ& '
$str
ЙЙ( /
,
ЙЙ/ 0
principalColumn
КК '
:
КК' (
$str
КК) -
,
КК- .
onDelete
ЛЛ  
:
ЛЛ  !
ReferentialAction
ЛЛ" 3
.
ЛЛ3 4
Restrict
ЛЛ4 <
)
ЛЛ< =
;
ЛЛ= >
table
ММ 
.
ММ 

ForeignKey
ММ $
(
ММ$ %
name
НН 
:
НН 
$str
НН >
,
НН> ?
column
ОО 
:
ОО 
x
ОО  !
=>
ОО" $
x
ОО% &
.
ОО& '
SenderId
ОО' /
,
ОО/ 0
principalTable
ПП &
:
ПП& '
$str
ПП( /
,
ПП/ 0
principalColumn
РР '
:
РР' (
$str
РР) -
,
РР- .
onDelete
СС  
:
СС  !
ReferentialAction
СС" 3
.
СС3 4
Restrict
СС4 <
)
СС< =
;
СС= >
}
ТТ 
)
ТТ 
;
ТТ 
migrationBuilder
ФФ 
.
ФФ 
CreateTable
ФФ (
(
ФФ( )
name
ХХ 
:
ХХ 
$str
ХХ "
,
ХХ" #
columns
ЦЦ 
:
ЦЦ 
table
ЦЦ 
=>
ЦЦ !
new
ЦЦ" %
{
ЧЧ 
Id
ШШ 
=
ШШ 
table
ШШ 
.
ШШ 
Column
ШШ %
<
ШШ% &
Guid
ШШ& *
>
ШШ* +
(
ШШ+ ,
type
ШШ, 0
:
ШШ0 1
$str
ШШ2 8
,
ШШ8 9
nullable
ШШ: B
:
ШШB C
false
ШШD I
)
ШШI J
,
ШШJ K
UserId
ЩЩ 
=
ЩЩ 
table
ЩЩ "
.
ЩЩ" #
Column
ЩЩ# )
<
ЩЩ) *
Guid
ЩЩ* .
>
ЩЩ. /
(
ЩЩ/ 0
type
ЩЩ0 4
:
ЩЩ4 5
$str
ЩЩ6 <
,
ЩЩ< =
nullable
ЩЩ> F
:
ЩЩF G
false
ЩЩH M
)
ЩЩM N
,
ЩЩN O
CoinId
ЪЪ 
=
ЪЪ 
table
ЪЪ "
.
ЪЪ" #
Column
ЪЪ# )
<
ЪЪ) *
Guid
ЪЪ* .
>
ЪЪ. /
(
ЪЪ/ 0
type
ЪЪ0 4
:
ЪЪ4 5
$str
ЪЪ6 <
,
ЪЪ< =
nullable
ЪЪ> F
:
ЪЪF G
false
ЪЪH M
)
ЪЪM N
,
ЪЪN O
DateCreated
ЫЫ 
=
ЫЫ  !
table
ЫЫ" '
.
ЫЫ' (
Column
ЫЫ( .
<
ЫЫ. /
DateTime
ЫЫ/ 7
>
ЫЫ7 8
(
ЫЫ8 9
type
ЫЫ9 =
:
ЫЫ= >
$str
ЫЫ? Y
,
ЫЫY Z
nullable
ЫЫ[ c
:
ЫЫc d
false
ЫЫe j
)
ЫЫj k
,
ЫЫk l
DateUpdated
ЬЬ 
=
ЬЬ  !
table
ЬЬ" '
.
ЬЬ' (
Column
ЬЬ( .
<
ЬЬ. /
DateTime
ЬЬ/ 7
>
ЬЬ7 8
(
ЬЬ8 9
type
ЬЬ9 =
:
ЬЬ= >
$str
ЬЬ? Y
,
ЬЬY Z
nullable
ЬЬ[ c
:
ЬЬc d
true
ЬЬe i
)
ЬЬi j
}
ЭЭ 
,
ЭЭ 
constraints
ЮЮ 
:
ЮЮ 
table
ЮЮ "
=>
ЮЮ# %
{
ЯЯ 
table
аа 
.
аа 

PrimaryKey
аа $
(
аа$ %
$str
аа% 4
,
аа4 5
x
аа6 7
=>
аа8 :
x
аа; <
.
аа< =
Id
аа= ?
)
аа? @
;
аа@ A
table
бб 
.
бб 

ForeignKey
бб $
(
бб$ %
name
вв 
:
вв 
$str
вв :
,
вв: ;
column
гг 
:
гг 
x
гг  !
=>
гг" $
x
гг% &
.
гг& '
CoinId
гг' -
,
гг- .
principalTable
дд &
:
дд& '
$str
дд( /
,
дд/ 0
principalColumn
ее '
:
ее' (
$str
ее) -
,
ее- .
onDelete
жж  
:
жж  !
ReferentialAction
жж" 3
.
жж3 4
Cascade
жж4 ;
)
жж; <
;
жж< =
table
зз 
.
зз 

ForeignKey
зз $
(
зз$ %
name
ии 
:
ии 
$str
ии :
,
ии: ;
column
йй 
:
йй 
x
йй  !
=>
йй" $
x
йй% &
.
йй& '
UserId
йй' -
,
йй- .
principalTable
кк &
:
кк& '
$str
кк( /
,
кк/ 0
principalColumn
лл '
:
лл' (
$str
лл) -
,
лл- .
onDelete
мм  
:
мм  !
ReferentialAction
мм" 3
.
мм3 4
Cascade
мм4 ;
)
мм; <
;
мм< =
}
нн 
)
нн 
;
нн 
migrationBuilder
пп 
.
пп 
CreateTable
пп (
(
пп( )
name
░░ 
:
░░ 
$str
░░ #
,
░░# $
columns
▒▒ 
:
▒▒ 
table
▒▒ 
=>
▒▒ !
new
▒▒" %
{
▓▓ 
Id
││ 
=
││ 
table
││ 
.
││ 
Column
││ %
<
││% &
Guid
││& *
>
││* +
(
││+ ,
type
││, 0
:
││0 1
$str
││2 8
,
││8 9
nullable
││: B
:
││B C
false
││D I
)
││I J
,
││J K
Quantity
┤┤ 
=
┤┤ 
table
┤┤ $
.
┤┤$ %
Column
┤┤% +
<
┤┤+ ,
double
┤┤, 2
>
┤┤2 3
(
┤┤3 4
type
┤┤4 8
:
┤┤8 9
$str
┤┤: L
,
┤┤L M
nullable
┤┤N V
:
┤┤V W
false
┤┤X ]
)
┤┤] ^
,
┤┤^ _

Commission
╡╡ 
=
╡╡  
table
╡╡! &
.
╡╡& '
Column
╡╡' -
<
╡╡- .
double
╡╡. 4
>
╡╡4 5
(
╡╡5 6
type
╡╡6 :
:
╡╡: ;
$str
╡╡< N
,
╡╡N O
nullable
╡╡P X
:
╡╡X Y
false
╡╡Z _
)
╡╡_ `
,
╡╡` a
UserId
╢╢ 
=
╢╢ 
table
╢╢ "
.
╢╢" #
Column
╢╢# )
<
╢╢) *
Guid
╢╢* .
>
╢╢. /
(
╢╢/ 0
type
╢╢0 4
:
╢╢4 5
$str
╢╢6 <
,
╢╢< =
nullable
╢╢> F
:
╢╢F G
false
╢╢H M
)
╢╢M N
,
╢╢N O
DateCreated
╖╖ 
=
╖╖  !
table
╖╖" '
.
╖╖' (
Column
╖╖( .
<
╖╖. /
DateTime
╖╖/ 7
>
╖╖7 8
(
╖╖8 9
type
╖╖9 =
:
╖╖= >
$str
╖╖? Y
,
╖╖Y Z
nullable
╖╖[ c
:
╖╖c d
false
╖╖e j
)
╖╖j k
,
╖╖k l
DateUpdated
╕╕ 
=
╕╕  !
table
╕╕" '
.
╕╕' (
Column
╕╕( .
<
╕╕. /
DateTime
╕╕/ 7
>
╕╕7 8
(
╕╕8 9
type
╕╕9 =
:
╕╕= >
$str
╕╕? Y
,
╕╕Y Z
nullable
╕╕[ c
:
╕╕c d
true
╕╕e i
)
╕╕i j
}
╣╣ 
,
╣╣ 
constraints
║║ 
:
║║ 
table
║║ "
=>
║║# %
{
╗╗ 
table
╝╝ 
.
╝╝ 

PrimaryKey
╝╝ $
(
╝╝$ %
$str
╝╝% 5
,
╝╝5 6
x
╝╝7 8
=>
╝╝9 ;
x
╝╝< =
.
╝╝= >
Id
╝╝> @
)
╝╝@ A
;
╝╝A B
table
╜╜ 
.
╜╜ 

ForeignKey
╜╜ $
(
╜╜$ %
name
╛╛ 
:
╛╛ 
$str
╛╛ ;
,
╛╛; <
column
┐┐ 
:
┐┐ 
x
┐┐  !
=>
┐┐" $
x
┐┐% &
.
┐┐& '
UserId
┐┐' -
,
┐┐- .
principalTable
└└ &
:
└└& '
$str
└└( /
,
└└/ 0
principalColumn
┴┴ '
:
┴┴' (
$str
┴┴) -
,
┴┴- .
onDelete
┬┬  
:
┬┬  !
ReferentialAction
┬┬" 3
.
┬┬3 4
Cascade
┬┬4 ;
)
┬┬; <
;
┬┬< =
}
├├ 
)
├├ 
;
├├ 
migrationBuilder
┼┼ 
.
┼┼ 
CreateIndex
┼┼ (
(
┼┼( )
name
╞╞ 
:
╞╞ 
$str
╞╞ +
,
╞╞+ ,
table
╟╟ 
:
╟╟ 
$str
╟╟ "
,
╟╟" #
column
╚╚ 
:
╚╚ 
$str
╚╚  
)
╚╚  !
;
╚╚! "
migrationBuilder
╩╩ 
.
╩╩ 
CreateIndex
╩╩ (
(
╩╩( )
name
╦╦ 
:
╦╦ 
$str
╦╦ -
,
╦╦- .
table
╠╠ 
:
╠╠ 
$str
╠╠ $
,
╠╠$ %
column
══ 
:
══ 
$str
══  
)
══  !
;
══! "
migrationBuilder
╧╧ 
.
╧╧ 
CreateIndex
╧╧ (
(
╧╧( )
name
╨╨ 
:
╨╨ 
$str
╨╨ -
,
╨╨- .
table
╤╤ 
:
╤╤ 
$str
╤╤ $
,
╤╤$ %
column
╥╥ 
:
╥╥ 
$str
╥╥  
)
╥╥  !
;
╥╥! "
migrationBuilder
╘╘ 
.
╘╘ 
CreateIndex
╘╘ (
(
╘╘( )
name
╒╒ 
:
╒╒ 
$str
╒╒ 0
,
╒╒0 1
table
╓╓ 
:
╓╓ 
$str
╓╓ '
,
╓╓' (
column
╫╫ 
:
╫╫ 
$str
╫╫  
)
╫╫  !
;
╫╫! "
migrationBuilder
┘┘ 
.
┘┘ 
CreateIndex
┘┘ (
(
┘┘( )
name
┌┌ 
:
┌┌ 
$str
┌┌ 3
,
┌┌3 4
table
██ 
:
██ 
$str
██ *
,
██* +
column
▄▄ 
:
▄▄ 
$str
▄▄  
)
▄▄  !
;
▄▄! "
migrationBuilder
▐▐ 
.
▐▐ 
CreateIndex
▐▐ (
(
▐▐( )
name
▀▀ 
:
▀▀ 
$str
▀▀ 0
,
▀▀0 1
table
рр 
:
рр 
$str
рр '
,
рр' (
column
сс 
:
сс 
$str
сс  
)
сс  !
;
сс! "
migrationBuilder
уу 
.
уу 
CreateIndex
уу (
(
уу( )
name
фф 
:
фф 
$str
фф 2
,
фф2 3
table
хх 
:
хх 
$str
хх %
,
хх% &
column
цц 
:
цц 
$str
цц $
)
цц$ %
;
цц% &
migrationBuilder
шш 
.
шш 
CreateIndex
шш (
(
шш( )
name
щщ 
:
щщ 
$str
щщ 0
,
щщ0 1
table
ъъ 
:
ъъ 
$str
ъъ %
,
ъъ% &
column
ыы 
:
ыы 
$str
ыы "
)
ыы" #
;
ыы# $
migrationBuilder
ээ 
.
ээ 
CreateIndex
ээ (
(
ээ( )
name
юю 
:
юю 
$str
юю ,
,
юю, -
table
яя 
:
яя 
$str
яя #
,
яя# $
column
ЁЁ 
:
ЁЁ 
$str
ЁЁ  
)
ЁЁ  !
;
ЁЁ! "
migrationBuilder
ЄЄ 
.
ЄЄ 
CreateIndex
ЄЄ (
(
ЄЄ( )
name
єє 
:
єє 
$str
єє ,
,
єє, -
table
ЇЇ 
:
ЇЇ 
$str
ЇЇ #
,
ЇЇ# $
column
її 
:
її 
$str
її  
)
її  !
;
її! "
migrationBuilder
ўў 
.
ўў 
CreateIndex
ўў (
(
ўў( )
name
°° 
:
°° 
$str
°° -
,
°°- .
table
∙∙ 
:
∙∙ 
$str
∙∙ $
,
∙∙$ %
column
·· 
:
·· 
$str
··  
)
··  !
;
··! "
}
√√ 	
	protected
■■ 
override
■■ 
void
■■ 
Down
■■  $
(
■■$ %
MigrationBuilder
■■% 5
migrationBuilder
■■6 F
)
■■F G
{
   	
migrationBuilder
АА 
.
АА 
	DropTable
АА &
(
АА& '
name
ББ 
:
ББ 
$str
ББ !
)
ББ! "
;
ББ" #
migrationBuilder
ГГ 
.
ГГ 
	DropTable
ГГ &
(
ГГ& '
name
ДД 
:
ДД 
$str
ДД #
)
ДД# $
;
ДД$ %
migrationBuilder
ЖЖ 
.
ЖЖ 
	DropTable
ЖЖ &
(
ЖЖ& '
name
ЗЗ 
:
ЗЗ 
$str
ЗЗ #
)
ЗЗ# $
;
ЗЗ$ %
migrationBuilder
ЙЙ 
.
ЙЙ 
	DropTable
ЙЙ &
(
ЙЙ& '
name
КК 
:
КК 
$str
КК 2
)
КК2 3
;
КК3 4
migrationBuilder
ММ 
.
ММ 
	DropTable
ММ &
(
ММ& '
name
НН 
:
НН 
$str
НН &
)
НН& '
;
НН' (
migrationBuilder
ПП 
.
ПП 
	DropTable
ПП &
(
ПП& '
name
РР 
:
РР 
$str
РР )
)
РР) *
;
РР* +
migrationBuilder
ТТ 
.
ТТ 
	DropTable
ТТ &
(
ТТ& '
name
УУ 
:
УУ 
$str
УУ &
)
УУ& '
;
УУ' (
migrationBuilder
ХХ 
.
ХХ 
	DropTable
ХХ &
(
ХХ& '
name
ЦЦ 
:
ЦЦ 
$str
ЦЦ ,
)
ЦЦ, -
;
ЦЦ- .
migrationBuilder
ШШ 
.
ШШ 
	DropTable
ШШ &
(
ШШ& '
name
ЩЩ 
:
ЩЩ 
$str
ЩЩ  
)
ЩЩ  !
;
ЩЩ! "
migrationBuilder
ЫЫ 
.
ЫЫ 
	DropTable
ЫЫ &
(
ЫЫ& '
name
ЬЬ 
:
ЬЬ 
$str
ЬЬ $
)
ЬЬ$ %
;
ЬЬ% &
migrationBuilder
ЮЮ 
.
ЮЮ 
	DropTable
ЮЮ &
(
ЮЮ& '
name
ЯЯ 
:
ЯЯ 
$str
ЯЯ "
)
ЯЯ" #
;
ЯЯ# $
migrationBuilder
бб 
.
бб 
	DropTable
бб &
(
бб& '
name
вв 
:
вв 
$str
вв #
)
вв# $
;
вв$ %
migrationBuilder
дд 
.
дд 
	DropTable
дд &
(
дд& '
name
ее 
:
ее 
$str
ее %
)
ее% &
;
ее& '
migrationBuilder
зз 
.
зз 
	DropTable
зз &
(
зз& '
name
ии 
:
ии 
$str
ии 
)
ии 
;
ии 
migrationBuilder
кк 
.
кк 
	DropTable
кк &
(
кк& '
name
лл 
:
лл 
$str
лл 
)
лл 
;
лл 
}
мм 	
}
нн 
}оо п'
NC:\work\BSUIR\crypto-wallet\Backend\Middlewares\ExceptionHandlingMiddleware.cs
	namespace 	
ProjectX
 
. 
Middlewares 
; 
public 
class '
ExceptionHandlingMiddleware (
{		 
private

 
readonly

 
ILogger

 
<

 '
ExceptionHandlingMiddleware

 8
>

8 9
_logger

: A
;

A B
private 
readonly 
RequestDelegate $
_next% *
;* +
public 
'
ExceptionHandlingMiddleware &
(& '
RequestDelegate 
next 
, 
ILogger 
< '
ExceptionHandlingMiddleware +
>+ ,
logger- 3
)3 4
{ 
_next 
= 
next 
; 
_logger 
= 
logger 
; 
} 
public 

async 
Task 
InvokeAsync !
(! "
HttpContext" -
httpContext. 9
)9 :
{ 
try 
{ 	
await 
_next 
( 
httpContext #
)# $
;$ %
} 	
catch 
( #
EntityNotFoundException &
ex' )
)) *
{ 	
await  
HandleExceptionAsync &
(& '
httpContext' 2
,2 3
ex 
. 
Message 
, 
HttpStatusCode 
. 
NotFound '
,' (
ex   
.   
Message   
)   
;   
}!! 	
catch"" 
("" "
IncorrectDataException"" %
ex""& (
)""( )
{## 	
await$$  
HandleExceptionAsync$$ &
($$& '
httpContext$$' 2
,$$2 3
ex%% 
.%% 
Message%% 
,%% 
HttpStatusCode&& 
.&& 

BadRequest&& )
,&&) *
ex'' 
.'' 
Message'' 
)'' 
;'' 
}(( 	
catch)) 
())  
KeyNotFoundException)) #
ex))$ &
)))& '
{** 	
await++  
HandleExceptionAsync++ &
(++& '
httpContext++' 2
,++2 3
ex,, 
.,, 
Message,, 
,,, 
HttpStatusCode-- 
.-- 
NotFound-- '
,--' (
ex.. 
... 
Message.. 
).. 
;.. 
}// 	
catch00 
(00 #
AuthenticationException00 &
ex00' )
)00) *
{11 	
await22  
HandleExceptionAsync22 &
(22& '
httpContext22' 2
,222 3
ex33 
.33 
Message33 
,33 
HttpStatusCode44 
.44 
NotFound44 '
,44' (
ex55 
.55 
Message55 
)55 
;55 
}66 	
catch77 
(77 
	Exception77 
ex77 
)77 
{88 	
await99  
HandleExceptionAsync99 &
(99& '
httpContext99' 2
,992 3
ex:: 
.:: 
Message:: 
,:: 
HttpStatusCode;; 
.;; 
InternalServerError;; 2
,;;2 3
$str<< '
)<<' (
;<<( )
}== 	
}>> 
private@@ 
async@@ 
Task@@  
HandleExceptionAsync@@ +
(@@+ ,
HttpContext@@, 7
context@@8 ?
,@@? @
string@@A G
exMsg@@H M
,@@M N
HttpStatusCode@@O ]
httpStatusCode@@^ l
,@@l m
stringAA 
messageAA 
)AA 
{BB 
_loggerCC 
.CC 
LogErrorCC 
(CC 
exMsgCC 
)CC 
;CC  
varEE 
responseEE 
=EE 
contextEE 
.EE 
ResponseEE '
;EE' (
responseGG 
.GG 
ContentTypeGG 
=GG 
$strGG 1
;GG1 2
responseHH 
.HH 

StatusCodeHH 
=HH 
(HH 
intHH "
)HH" #
httpStatusCodeHH# 1
;HH1 2
ErrorDtoJJ 
errorDtoJJ 
=JJ 
newJJ 
(JJ  
)JJ  !
{KK 	
MessageLL 
=LL 
messageLL 
,LL 

StatusCodeMM 
=MM 
(MM 
intMM 
)MM 
httpStatusCodeMM ,
}NN 	
;NN	 

awaitPP 
responsePP 
.PP 
WriteAsJsonAsyncPP '
(PP' (
errorDtoPP( 0
)PP0 1
;PP1 2
}QQ 
}RR Н
8C:\work\BSUIR\crypto-wallet\Backend\Helpers\JWTHelper.cs
	namespace 	
Api
 
. 
OpenAI 
. 
Handlers 
; 
public 
class 
	JWTHelper 
{ 
} ┼
DC:\work\BSUIR\crypto-wallet\Backend\Helpers\Interfaces\IJWTHelper.cs
	namespace 	
Api
 
. 
OpenAI 
. 
Handlers 
. 

Interfaces (
;( )
public 
	interface 

IJWTHelper 
{ 
} й
FC:\work\BSUIR\crypto-wallet\Backend\Helpers\Interfaces\IHashHelpers.cs
	namespace 	
Api
 
. 
OpenAI 
. 
Handlers 
. 

Interfaces (
;( )
public 
	interface 
IHashHelpers 
{ 
public 

string 
GenerateSalt 
( 
int "
size# '
)' (
;( )
public 

string 
HashPassword 
( 
string %
password& .
,. /
string0 6
salt7 ;
); <
;< =
} ╙
:C:\work\BSUIR\crypto-wallet\Backend\Helpers\HashHelpers.cs
	namespace 	
Api
 
. 
OpenAI 
. 
Handlers 
; 
public 
class 
HashHelpers 
: 
IHashHelpers '
{ 
public		 

string		 
GenerateSalt		 
(		 
int		 "
size		# '
)		' (
{

 
using 
( 
var 
rng 
= 
new $
RNGCryptoServiceProvider 5
(5 6
)6 7
)7 8
{ 	
var 
	saltBytes 
= 
new 
byte  $
[$ %
size% )
]) *
;* +
rng 
. 
GetBytes 
( 
	saltBytes "
)" #
;# $
return 
Convert 
. 
ToBase64String )
() *
	saltBytes* 3
)3 4
;4 5
} 	
} 
public 

string 
HashPassword 
( 
string %
password& .
,. /
string0 6
salt7 ;
); <
{ 
using 
( 
var 
sha256 
= 
SHA256 "
." #
Create# )
() *
)* +
)+ ,
{ 	
var 
passwordBytes 
= 
Encoding  (
.( )
UTF8) -
.- .
GetBytes. 6
(6 7
password7 ?
)? @
;@ A
var 
passwordHash 
= 
sha256 %
.% &
ComputeHash& 1
(1 2
passwordBytes2 ?
)? @
;@ A
var 
	saltBytes 
= 
Convert #
.# $
FromBase64String$ 4
(4 5
salt5 9
)9 :
;: ;
var 
combinedBytes 
= 
new  #
byte$ (
[( )
passwordHash) 5
.5 6
Length6 <
+= >
	saltBytes? H
.H I
LengthI O
]O P
;P Q
Array 
. 
Copy 
( 
passwordHash #
,# $
$num% &
,& '
combinedBytes( 5
,5 6
$num7 8
,8 9
passwordHash: F
.F G
LengthG M
)M N
;N O
Array 
. 
Copy 
( 
	saltBytes  
,  !
$num" #
,# $
combinedBytes% 2
,2 3
passwordHash4 @
.@ A
LengthA G
,G H
	saltBytesI R
.R S
LengthS Y
)Y Z
;Z [
var   
hashedBytes   
=   
sha256   $
.  $ %
ComputeHash  % 0
(  0 1
combinedBytes  1 >
)  > ?
;  ? @
return"" 
Convert"" 
."" 
ToBase64String"" )
("") *
hashedBytes""* 5
)""5 6
;""6 7
}## 	
}$$ 
}%% ╡
9C:\work\BSUIR\crypto-wallet\Backend\Handlers\IPHandler.cs
	namespace 	

Analitique
 
. 
BackEnd 
. 
Handlers %
;% &
public 
class 
	IPHandler 
{ 
public 

static 
string 
GetIpAddress %
(% &
)& '
{		 
try

 
{ 	
var 
	ipAddress 
= 
Dns 
.  
GetHostEntry  ,
(, -
Dns- 0
.0 1
GetHostName1 <
(< =
)= >
)> ?
. 
AddressList 
. 
FirstOrDefault 
(  
ip  "
=># %
ip& (
.( )
AddressFamily) 6
==7 9
AddressFamily: G
.G H
InterNetworkH T
)T U
?U V
. 
ToString 
( 
) 
; 
return 
	ipAddress 
?? 
$str  6
;6 7
} 	
catch 
( 
	Exception 
ex 
) 
{ 	
return 
$" 
$str 
{ 
ex 
.  
Message  '
}' (
"( )
;) *
} 	
} 
} █
;C:\work\BSUIR\crypto-wallet\Backend\Handlers\HashHandler.cs
	namespace 	

Analitique
 
. 
BackEnd 
. 
Handlers %
;% &
public 
class 
HashHandler 
{ 
public 

static 
string 
GenerateSalt %
(% &
int& )
size* .
). /
{		 
using

 
(

 
var

 
rng

 
=

 
new

 $
RNGCryptoServiceProvider

 5
(

5 6
)

6 7
)

7 8
{ 	
var 
	saltBytes 
= 
new 
byte  $
[$ %
size% )
]) *
;* +
rng 
. 
GetBytes 
( 
	saltBytes "
)" #
;# $
return 
Convert 
. 
ToBase64String )
() *
	saltBytes* 3
)3 4
;4 5
} 	
} 
public 

static 
string 
HashPassword %
(% &
string& ,
password- 5
,5 6
string7 =
salt> B
)B C
{ 
using 
( 
var 
sha256 
= 
SHA256 "
." #
Create# )
() *
)* +
)+ ,
{ 	
var 
passwordBytes 
= 
Encoding  (
.( )
UTF8) -
.- .
GetBytes. 6
(6 7
password7 ?
)? @
;@ A
var 
passwordHash 
= 
sha256 %
.% &
ComputeHash& 1
(1 2
passwordBytes2 ?
)? @
;@ A
var 
	saltBytes 
= 
Convert #
.# $
FromBase64String$ 4
(4 5
salt5 9
)9 :
;: ;
var 
combinedBytes 
= 
new  #
byte$ (
[( )
passwordHash) 5
.5 6
Length6 <
+= >
	saltBytes? H
.H I
LengthI O
]O P
;P Q
Array 
. 
Copy 
( 
passwordHash #
,# $
$num% &
,& '
combinedBytes( 5
,5 6
$num7 8
,8 9
passwordHash: F
.F G
LengthG M
)M N
;N O
Array   
.   
Copy   
(   
	saltBytes    
,    !
$num  " #
,  # $
combinedBytes  % 2
,  2 3
passwordHash  4 @
.  @ A
Length  A G
,  G H
	saltBytes  I R
.  R S
Length  S Y
)  Y Z
;  Z [
var## 
hashedBytes## 
=## 
sha256## $
.##$ %
ComputeHash##% 0
(##0 1
combinedBytes##1 >
)##> ?
;##? @
return&& 
Convert&& 
.&& 
ToBase64String&& )
(&&) *
hashedBytes&&* 5
)&&5 6
;&&6 7
}'' 	
}(( 
})) е
HC:\work\BSUIR\crypto-wallet\Backend\Exceptions\IncorrectDataException.cs
	namespace 	
ProjectX
 
. 

Exceptions 
; 
public 
class "
IncorrectDataException #
:$ %
	Exception& /
{ 
public 
"
IncorrectDataException !
(! "
string" (
message) 0
)0 1
:2 3
base4 8
(8 9
message9 @
)@ A
{ 
} 
} и
IC:\work\BSUIR\crypto-wallet\Backend\Exceptions\EntityNotFoundException.cs
	namespace 	
ProjectX
 
. 

Exceptions 
; 
public 
class #
EntityNotFoundException $
:% &
	Exception' 0
{ 
public 
#
EntityNotFoundException "
(" #
string# )
message* 1
)1 2
:3 4
base5 9
(9 :
message: A
)A B
{ 
} 
} л
:C:\work\BSUIR\crypto-wallet\Backend\DTO\WithdrawRequest.cs
	namespace 	
UP
 
. 
DTO 
; 
public 
class 
WithdrawRequest 
{ 
public 

Guid 
UserId 
{ 
get 
; 
set !
;! "
}# $
public 

double 
QuantityForWithdraw %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
} л
=C:\work\BSUIR\crypto-wallet\Backend\DTO\VerifyEmailRequest.cs
	namespace 	
TestApplication
 
. 
DTO 
; 
public 
class 
VerifyEmailRequest 
{ 
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
public 

string 
Code 
{ 
get 
; 
set !
;! "
}# $
} е
FC:\work\BSUIR\crypto-wallet\Backend\DTO\SendVerificationCodeRequest.cs
	namespace 	
TestApplication
 
. 
DTO 
; 
public 
class '
SendVerificationCodeRequest (
{ 
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
} е
=C:\work\BSUIR\crypto-wallet\Backend\DTO\SendMessageRequest.cs
	namespace 	
UP
 
. 
DTO 
; 
public 
class 
SendMessageRequest 
{ 
public 

Guid 
UserId 
{ 
get 
; 
set !
;! "
}# $
public 

string 
Message 
{ 
get 
;  
set! $
;$ %
}& '
} ш
<C:\work\BSUIR\crypto-wallet\Backend\DTO\SendCryptoRequest.cs
	namespace 	
UP
 
. 
DTO 
; 
public 
class 
SendCryptoRequest 
{ 
public 

SendCryptoRequest 
( 
Guid !

receiverId" ,
,, -
Guid. 2
senderId3 ;
,; <
string= C
coinNameD L
,L M
doubleN T
quantityForSendU d
)d e
{ 

ReceiverId 
= 

receiverId 
;  
SenderId 
= 
senderId 
; 
CoinName		 
=		 
coinName		 
;		 
QuantityForSend

 
=

 
quantityForSend

 )
;

) *
} 
public 

Guid 

ReceiverId 
{ 
get  
;  !
set" %
;% &
}' (
public 

Guid 
SenderId 
{ 
get 
; 
set  #
;# $
}% &
public 

string 
CoinName 
{ 
get  
;  !
set" %
;% &
}' (
public 

double 
QuantityForSend !
{" #
get$ '
;' (
set) ,
;, -
}. /
} ╜	
<C:\work\BSUIR\crypto-wallet\Backend\DTO\SellCryptoRequest.cs
	namespace 	
UP
 
. 
DTO 
; 
public 
class 
SellCryptoRequest 
{ 
public 

SellCryptoRequest 
( 
Guid !
userId" (
,( )
string* 0
coinName1 9
,9 :
double; A
quantityForSellB Q
)Q R
{ 
UserId 
= 
userId 
; 
CoinName 
= 
coinName 
; 
QuantityForSell		 
=		 
quantityForSell		 )
;		) *
}

 
public 

Guid 
UserId 
{ 
get 
; 
set !
;! "
}# $
public 

string 
CoinName 
{ 
get  
;  !
set" %
;% &
}' (
public 

double 
QuantityForSell !
{" #
get$ '
;' (
set) ,
;, -
}. /
} ╛
AC:\work\BSUIR\crypto-wallet\Backend\DTO\RestorePasswordRequest.cs
	namespace 	
TestApplication
 
. 
DTO 
; 
public 
class "
RestorePasswordRequest #
{ 
public 

string 
NewPassword 
{ 
get  #
;# $
set% (
;( )
}* +
public 

Guid 
UserId 
{ 
get 
; 
set !
;! "
}# $
} Ы
AC:\work\BSUIR\crypto-wallet\Backend\DTO\RestorePasswordCodeDto.cs
	namespace 	
TestApplication
 
. 
DTO 
; 
public 
class "
RestorePasswordCodeDto #
{ 
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
} б
EC:\work\BSUIR\crypto-wallet\Backend\DTO\ReplenishTheBalanceRequest.cs
	namespace 	
UP
 
. 
DTO 
; 
public 
class &
ReplenishTheBalanceRequest '
{ 
public 
&
ReplenishTheBalanceRequest %
(% &
Guid& *
userId+ 1
,1 2
double3 9
quantityUsd: E
)E F
{ 
UserId 
= 
userId 
; 
QuantityUsd 
= 
quantityUsd !
;! "
}		 
public 
&
ReplenishTheBalanceRequest %
(% &
)& '
{ 
} 
public 

Guid 
UserId 
{ 
get 
; 
set !
;! "
}# $
public 

double 
QuantityUsd 
{ 
get  #
;# $
set% (
;( )
}* +
} ▄
:C:\work\BSUIR\crypto-wallet\Backend\DTO\RegisterRequest.cs
	namespace 	
UP
 
. 
DTO 
; 
public 
class 
RegisterRequest 
{ 
public 

string 
Login 
{ 
get 
; 
set "
;" #
}$ %
public 

string 
Password 
{ 
get  
;  !
set" %
;% &
}' (
public 

string 
Email 
{ 
get 
; 
set "
;" #
}$ %
public 

string 
PasswordRepeat  
{! "
get# &
;& '
set( +
;+ ,
}- .
}		 Е
:C:\work\BSUIR\crypto-wallet\Backend\DTO\GetTokenRequest.cs
	namespace 	
UP
 
. 
DTO 
; 
public 
class 
GetTokenRequest 
{ 
public 

string 
Email 
{ 
get 
; 
set "
;" #
}$ %
} Ю
LC:\work\BSUIR\crypto-wallet\Backend\DTO\GetQuantityAfterConversionRequest.cs
	namespace 	
UP
 
. 
DTO 
; 
public 
class -
!GetQuantityAfterConversionRequest .
{ 
public 
-
!GetQuantityAfterConversionRequest ,
(, -
string- 3
shortNameStart4 B
,B C
stringD J
shortNameFinalK Y
,Y Z
double[ a
quantityb j
,j k
intl o
userIdp v
)v w
{ 
ShortNameStart 
= 
shortNameStart '
;' (
ShortNameFinal 
= 
shortNameFinal '
;' (
Quantity		 
=		 
quantity		 
;		 
UserId

 
=

 
userId

 
;

 
} 
public 

string 
ShortNameStart  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 

string 
ShortNameFinal  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 

double 
Quantity 
{ 
get  
;  !
set" %
;% &
}' (
public 

int 
UserId 
{ 
get 
; 
set  
;  !
}" #
} ├
7C:\work\BSUIR\crypto-wallet\Backend\DTO\GetCoinRatio.cs
	namespace 	
UP
 
. 
DTO 
; 
public 
class 
GetCoinRatio 
{ 
public 

string 
CoinShortName 
{  !
get" %
;% &
set' *
;* +
}, -
public 

DateTime 
	StartDate 
{ 
get  #
;# $
set% (
;( )
}* +
public		 

DateTime		 
EndDate		 
{		 
get		 !
;		! "
set		# &
;		& '
}		( )
}

 б
3C:\work\BSUIR\crypto-wallet\Backend\DTO\ErrorDto.cs
	namespace 	
TestApplication
 
. 
DTO 
; 
public 
class 
ErrorDto 
{ 
public 

int 

StatusCode 
{ 
get 
;  
set! $
;$ %
}& '
public 

string 
Message 
{ 
get 
;  
set! $
;$ %
}& '
} ╟
:C:\work\BSUIR\crypto-wallet\Backend\DTO\EditUserRequest.cs
	namespace 	
UP
 
. 
DTO 
; 
public 
class 
EditUserRequest 
{ 
public 

EditUserRequest 
( 
int 
id !
,! "
string# )
login* /
,/ 0
string1 7
password8 @
,@ A
stringB H
passwordRepeatI W
,W X
stringY _
email` e
)e f
{ 
Id 

= 
id 
; 
Login 
= 
login 
; 
Password		 
=		 
password		 
;		 
PasswordRepeat

 
=

 
passwordRepeat

 '
;

' (
Email 
= 
email 
; 
} 
public 

int 
Id 
{ 
get 
; 
set 
; 
} 
public 

string 
Login 
{ 
get 
; 
set "
;" #
}$ %
public 

string 
Password 
{ 
get  
;  !
set" %
;% &
}' (
public 

string 
PasswordRepeat  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 

string 
Email 
{ 
get 
; 
set "
;" #
}$ %
} ╬
BC:\work\BSUIR\crypto-wallet\Backend\DTO\EditUserPasswordRequest.cs
	namespace 	
UP
 
. 
DTO 
; 
public 
class #
EditUserPasswordRequest $
{ 
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
public 

string 
Password 
{ 
get  
;  !
set" %
;% &
}' (
public 

string 
PasswordRepeat  
{! "
get# &
;& '
set( +
;+ ,
}- .
} г
?C:\work\BSUIR\crypto-wallet\Backend\DTO\EditUserLoginRequest.cs
	namespace 	
UP
 
. 
DTO 
; 
public 
class  
EditUserLoginRequest !
{ 
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
public 

string 
Login 
{ 
get 
; 
set "
;" #
}$ %
} г
?C:\work\BSUIR\crypto-wallet\Backend\DTO\EditUserEmailRequest.cs
	namespace 	
UP
 
. 
DTO 
; 
public 
class  
EditUserEmailRequest !
{ 
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
public 

string 
Email 
{ 
get 
; 
set "
;" #
}$ %
} Ь
<C:\work\BSUIR\crypto-wallet\Backend\DTO\CreateUserRequest.cs
	namespace 	
Api
 
. 
OpenAI 
. 
DTO 
; 
public 
class 
CreateUserRequest 
{ 
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
public 

string 
Nickname 
{ 
get  
;  !
set" %
;% &
}' (
public		 

string		 
Password		 
{		 
get		  
;		  !
set		" %
;		% &
}		' (
public 

string 
	IPAddress 
{ 
get !
;! "
set# &
;& '
}( )
public 

Guid 
ApplicationId 
{ 
get  #
;# $
set% (
;( )
}* +
} т
9C:\work\BSUIR\crypto-wallet\Backend\DTO\ConvertRequest.cs
	namespace 	
UP
 
. 
DTO 
; 
public 
class 
ConvertRequest 
{ 
public 

string 
ShortNameStart  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 

string 
ShortNameFinal  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 

double 
Quantity 
{ 
get  
;  !
set" %
;% &
}' (
public 

Guid 
UserId 
{ 
get 
; 
set !
;! "
}# $
}		 й
=C:\work\BSUIR\crypto-wallet\Backend\DTO\CoinRationResponse.cs
	namespace 	
UP
 
. 
DTO 
; 
public 
class 
CoinRationResponse 
{ 
public 

double 

Persentage 
{ 
get "
;" #
set$ '
;' (
}) *
public 

double 
Price 
{ 
get 
; 
set "
;" #
}$ %
} ╩
@C:\work\BSUIR\crypto-wallet\Backend\DTO\ChangePasswordRequest.cs
	namespace 	
UP
 
. 
DTO 
; 
public 
class !
ChangePasswordRequest "
{ 
public 

Guid 
Id 
{ 
get 
; 
set 
; 
}  
public 

string 
Password 
{ 
get  
;  !
set" %
;% &
}' (
public 

string 
PasswordRepeat  
{! "
get# &
;& '
set( +
;+ ,
}- .
} Ю	
;C:\work\BSUIR\crypto-wallet\Backend\DTO\BuyCryptoRequest.cs
	namespace 	
UP
 
. 
DTO 
; 
public 
class 
BuyCryptoRequest 
{ 
public 

BuyCryptoRequest 
( 
Guid  
userId! '
,' (
string) /
coinName0 8
,8 9
double: @
quantityA I
)I J
{ 
UserId 
= 
userId 
; 
CoinName 
= 
coinName 
; 
Quantity		 
=		 
quantity		 
;		 
}

 
public 

Guid 
UserId 
{ 
get 
; 
set !
;! "
}# $
public 

string 
CoinName 
{ 
get  
;  !
set" %
;% &
}' (
public 

double 
Quantity 
{ 
get  
;  !
set" %
;% &
}' (
} Ч
7C:\work\BSUIR\crypto-wallet\Backend\DTO\AuthResponse.cs
	namespace 	
UP
 
. 
DTO 
; 
public 
class 
AuthResponse 
{ 
public 

string 
Token 
{ 
get 
; 
set "
;" #
}$ %
public 

Guid 
UserId 
{ 
get 
; 
set !
;! "
}# $
} Щ
6C:\work\BSUIR\crypto-wallet\Backend\DTO\AuthRequest.cs
	namespace 	
UP
 
. 
DTO 
; 
public 
class 
AuthRequest 
{ 
public 

string 
Login 
{ 
get 
; 
set "
;" #
}$ %
public 

string 
Password 
{ 
get  
;  !
set" %
;% &
}' (
} О
@C:\work\BSUIR\crypto-wallet\Backend\DTO\AuthenticationRequest.cs
	namespace 	
UP
 
. 
DTO 
; 
public 
class !
AuthenticationRequest "
{ 
public 
!
AuthenticationRequest  
(  !
string! '
login( -
,- .
string/ 5
password6 >
)> ?
{ 
Login 
= 
login 
; 
Password 
= 
password 
; 
}		 
public 

string 
Login 
{ 
get 
; 
set "
;" #
}$ %
public 

string 
Password 
{ 
get  
;  !
set" %
;% &
}' (
} ╚D
;C:\work\BSUIR\crypto-wallet\Backend\Data\DataInitializer.cs
	namespace 	
UP
 
. 
Data 
{ 
public 

class 
DataInitializer  
{		 
public

 
static

 
void

 

Initialize

 %
(

% &
DataContext

& 1
context

2 9
)

9 :
{ 	
context 
. 
Database 
. 
EnsureCreated *
(* +
)+ ,
;, -
if 
( 
! 
context 
. 
Services !
.! "
Any" %
(% &
)& '
)' (
{ 
var 
services 
= 
new "
[" #
]# $
{ 
new 
Service 
{ 
Name 
= 
$str *
,* +
About 
= 
$str  V
,V W
	PhotoName !
=" #
$str$ /
} 
, 
new 
Service 
{ 
Name 
= 
$str %
,% &
About 
= 
$str  O
,O P
	PhotoName !
=" #
$str$ .
} 
, 
new 
Service 
{ 
Name 
= 
$str (
,( )
About   
=   
$str    D
,  D E
	PhotoName!! !
=!!" #
$str!!$ 1
}"" 
,"" 
new## 
Service## 
{$$ 
Name%% 
=%% 
$str%% '
,%%' (
About&& 
=&& 
$str&&  K
,&&K L
	PhotoName'' !
=''" #
$str''$ 0
}(( 
,(( 
new)) 
Service)) 
{** 
Name++ 
=++ 
$str++ -
,++- .
About,, 
=,, 
$str,,  L
,,,L M
	PhotoName-- !
=--" #
$str--$ 0
}.. 
}// 
;// 
context00 
.00 
Services00  
.00  !
AddRange00! )
(00) *
services00* 2
)002 3
;003 4
context11 
.11 
SaveChanges11 #
(11# $
)11$ %
;11% &
}22 
if33 
(33 
!33 
context33 
.33 
Users33 
.33 
Any33 "
(33" #
)33# $
)33$ %
{44 
var55 
users55 
=55 
new55 
[55  
]55  !
{66 
new77 
User77 
{88 
DateCreated99 #
=99$ %
DateTime99& .
.99. /
UtcNow99/ 5
,995 6
Login:: 
=:: 
$str::  )
,::) *
Password;;  
=;;! "
$str;;# ,
,;;, -
Email<< 
=<< 
$str<<  )
,<<) *
	IsDeleted== !
===" #
false==$ )
,==) *
RoleId>> 
=>>  
$num>>! "
,>>" #
	IsBlocked?? !
=??" #
false??$ )
,??) *
Salt@@ 
=@@ 
$str@@ (
}AA 
,AA 
newBB 
UserBB 
{CC 
DateCreatedDD #
=DD$ %
DateTimeDD& .
.DD. /
UtcNowDD/ 5
,DD5 6
LoginEE 
=EE 
$strEE  &
,EE& '
PasswordFF  
=FF! "
HashHandlerFF# .
.FF. /
HashPasswordFF/ ;
(FF; <
$strFF< B
,FFB C
$strFFD J
)FFJ K
,FFK L
EmailGG 
=GG 
$strGG  &
,GG& '
	IsDeletedHH !
=HH" #
falseHH$ )
,HH) *
RoleIdII 
=II  
$numII! "
,II" #
	IsBlockedJJ !
=JJ" #
falseJJ$ )
,JJ) *
SaltKK 
=KK 
$strKK %
}LL 
}MM 
;MM 
contextNN 
.NN 
UsersNN 
.NN 
AddRangeNN &
(NN& '
usersNN' ,
)NN, -
;NN- .
contextOO 
.OO 
SaveChangesOO #
(OO# $
)OO$ %
;OO% &
}PP 
ifRR 
(RR 
contextRR 
.RR 
CoinListInfosRR %
.RR% &
AnyRR& )
(RR) *
)RR* +
)RR+ ,
returnRR- 3
;RR3 4
varSS 
coinsSS 
=SS 
newSS 

DictionarySS &
<SS& '
stringSS' -
,SS- .
stringSS/ 5
>SS5 6
{TT 
{UU 
$strUU 
,UU 
$strUU !
}UU! "
,UU" #
{VV 
$strVV 
,VV 
$strVV "
}VV" #
,VV# $
{WW 
$strWW 
,WW 
$strWW !
}WW! "
,WW" #
{XX 
$strXX 
,XX 
$strXX &
}XX& '
,XX' (
{YY 
$strYY 
,YY 
$strYY  
}YY  !
,YY! "
{ZZ 
$strZZ 
,ZZ 
$strZZ !
}ZZ! "
,ZZ" #
{[[ 
$str[[ 
,[[ 
$str[[ 
}[[ 
,[[ 
{\\ 
$str\\ 
,\\ 
$str\\ "
}\\" #
,\\# $
{]] 
$str]] 
,]] 
$str]] #
}]]# $
,]]$ %
{^^ 
$str^^ 
,^^ 
$str^^ !
}^^! "
,^^" #
{__ 
$str__ 
,__ 
$str__  
}__  !
,__! "
{`` 
$str`` 
,`` 
$str`` $
}``$ %
,``% &
{aa 
$straa 
,aa 
$straa $
}aa$ %
,aa% &
{bb 
$strbb 
,bb 
$strbb #
}bb# $
,bb$ %
{cc 
$strcc 
,cc 
$strcc $
}cc$ %
,cc% &
{dd 
$strdd 
,dd 
$strdd !
}dd! "
,dd" #
{ee 
$stree 
,ee 
$stree "
}ee" #
,ee# $
{ff 
$strff 
,ff 
$strff 
}ff  
,ff  !
{gg 
$strgg 
,gg 
$strgg "
}gg" #
,gg# $
{hh 
$strhh 
,hh 
$strhh #
}hh# $
,hh$ %
{ii 
$strii 
,ii 
$strii #
}ii# $
,ii$ %
{jj 
$strjj 
,jj 
$strjj !
}jj! "
,jj" #
{kk 
$strkk 
,kk 
$strkk 
}kk 
,kk 
{ll 
$strll 
,ll 
$strll  
}ll  !
,ll! "
{mm 
$strmm 
,mm 
$strmm  
}mm  !
,mm! "
{nn 
$strnn 
,nn 
$strnn &
}nn& '
,nn' (
{oo 
$stroo 
,oo 
$stroo &
}oo& '
,oo' (
{pp 
$strpp 
,pp 
$strpp %
}pp% &
,pp& '
{qq 
$strqq 
,qq 
$strqq  
}qq  !
,qq! "
{rr 
$strrr 
,rr 
$strrr "
}rr" #
}ss 
;ss 
foreachuu 
(uu 
varuu 
coinuu 
inuu  
coinsuu! &
)uu& '
{vv 
contextww 
.ww 
CoinListInfosww %
.ww% &
Addww& )
(ww) *
newww* -
CoinListInfoww. :
{xx 
Idyy 
=yy 
Guidyy 
.yy 
NewGuidyy %
(yy% &
)yy& '
,yy' (
	ShortNamezz 
=zz 
coinzz  $
.zz$ %
Keyzz% (
,zz( )
FullName{{ 
={{ 
coin{{ #
.{{# $
Value{{$ )
,{{) *
IsActive|| 
=|| 
true|| #
}}} 
)}} 
;}} 
}~~ 
context
АА 
.
АА 
SaveChanges
АА 
(
АА  
)
АА  !
;
АА! "
}
ББ 	
}
ВВ 
}ГГ Л.
7C:\work\BSUIR\crypto-wallet\Backend\Data\DataContext.cs
	namespace 	
TestApplication
 
. 
Data 
; 
public 
class 
DataContext 
: 
	DbContext $
{ 
public		 

DataContext		 
(		 
DbContextOptions		 '
<		' (
DataContext		( 3
>		3 4
options		5 <
)		< =
:		> ?
base		@ D
(		D E
options		E L
)		L M
{

 
} 
public 

DbSet 
< 
User 
> 
Users 
{ 
get "
;" #
set$ '
;' (
}) *
public 

DbSet 
< 
Blocking 
> 
	Blockings $
{% &
get' *
;* +
set, /
;/ 0
}1 2
public 

DbSet 
< 
Coin 
> 
Coins 
{ 
get "
;" #
set$ '
;' (
}) *
public 

DbSet 
< 

Conversion 
> 
Conversions (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
public 

DbSet 
< 
LoginHistory 
> 
LoginHistories -
{. /
get0 3
;3 4
set5 8
;8 9
}: ;
public 

DbSet 
< $
RestorePasswordCodeModel )
>) * 
RestorePasswordCodes+ ?
{@ A
getB E
;E F
setG J
;J K
}L M
public 

DbSet 
< 
PreviousPassword !
>! "
PreviousPasswords# 4
{5 6
get7 :
;: ;
set< ?
;? @
}A B
public 

DbSet 
< &
EmailVerificationCodeModel +
>+ ,
VerifyEmailCode- <
{= >
get? B
;B C
setD G
;G H
}I J
public 

DbSet 
< 
Transactions 
> 
Transactions +
{, -
get. 1
;1 2
set3 6
;6 7
}8 9
public 

DbSet 
<  
CryptoCurrencyPrices %
>% &
CoinHistory' 2
{3 4
get5 8
;8 9
set: =
;= >
}? @
public 

DbSet 
< 

UsersCoins 
> 

UsersCoins '
{( )
get* -
;- .
set/ 2
;2 3
}4 5
public 

DbSet 
< 

Withdrawal 
> 
Withdrawals (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
public 

DbSet 
< 
Replenishment 
> 
Replenishments  .
{/ 0
get1 4
;4 5
set6 9
;9 :
}; <
public 

DbSet 
< 
Service 
> 
Services "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 

DbSet 
< 
CoinListInfo 
> 
CoinListInfos ,
{- .
get/ 2
;2 3
set4 7
;7 8
}9 :
public 

DbSet 
< &
EmailVerificationCodeModel +
>+ ,'
EmailVerificationCodeModels- H
{I J
getK N
;N O
setP S
;S T
}U V
	protected   
override   
void   
OnModelCreating   +
(  + ,
ModelBuilder  , 8
modelBuilder  9 E
)  E F
{!! 
modelBuilder"" 
."" 
Entity"" 
<"" 
Transactions"" (
>""( )
("") *
)""* +
.## 
HasOne## 
(## 
t## 
=>## 
t## 
.## 
Sender## !
)##! "
.$$ 
WithMany$$ 
($$ 
u$$ 
=>$$ 
u$$ 
.$$ 
SentTransactions$$ -
)$$- .
.%% 
HasForeignKey%% 
(%% 
t%% 
=>%% 
t%%  !
.%%! "
SenderId%%" *
)%%* +
.&& 
OnDelete&& 
(&& 
DeleteBehavior&& $
.&&$ %
Restrict&&% -
)&&- .
;&&. /
modelBuilder(( 
.(( 
Entity(( 
<(( 
Transactions(( (
>((( )
((() *
)((* +
.)) 
HasOne)) 
()) 
t)) 
=>)) 
t)) 
.)) 
Receiver)) #
)))# $
.** 
WithMany** 
(** 
u** 
=>** 
u** 
.**  
ReceivedTransactions** 1
)**1 2
.++ 
HasForeignKey++ 
(++ 
t++ 
=>++ 
t++  !
.++! "

ReceiverId++" ,
)++, -
.,, 
OnDelete,, 
(,, 
DeleteBehavior,, $
.,,$ %
Restrict,,% -
),,- .
;,,. /
base.. 
... 
OnModelCreating.. 
(.. 
modelBuilder.. )
)..) *
;..* +
}// 
}00 Яу
AC:\work\BSUIR\crypto-wallet\Backend\Controllers\UserController.cs
	namespace 	
UP
 
. 
Controllers 
; 
[ 
ApiController 
] 
[ 
Route 
( 
$str 
) 
] 
public 
class 
UserController 
( 
IDbRepository )
dbRepository* 6
,6 7
IHashHelpers8 D
hashHelpersE P
)P Q
: 
ControllerBase 
{ 
[ 
HttpPut 
] 
[ 
Route 

(
 
$str 
) 
] 
public 

async 
Task 
< 
ActionResult "
>" #
EditUserLogin$ 1
(1 2
[2 3
FromBody3 ;
]; < 
EditUserLoginRequest= Q
requestR Y
)Y Z
{ 
var 
existingUser 
= 
await  
dbRepository! -
.- .
Get. 1
<1 2
User2 6
>6 7
(7 8
)8 9
.9 :
FirstOrDefaultAsync: M
(M N
xN O
=>P R
xS T
.T U
IdU W
==X Z
request[ b
.b c
Idc e
)e f
;f g
if 

( 
existingUser 
== 
null  
)  !
throw 
new #
EntityNotFoundException -
(- .
$str. >
)> ?
;? @
if 

( 
request 
. 
Login 
== 
null !
)! "
throw 
new #
EntityNotFoundException -
(- .
$str. F
)F G
;G H
if   

(   
request   
.   
Login   
.   
Length    
<  ! "
$num  # $
)  $ %
throw!! 
new!! #
EntityNotFoundException!! -
(!!- .
$str!!. U
)!!U V
;!!V W
if"" 

("" 
request"" 
."" 
Login"" 
."" 
Length""  
>""! "
$num""# %
)""% &
throw## 
new## #
EntityNotFoundException## -
(##- .
$str##. W
)##W X
;##X Y
if%% 

(%% 
!%% 
await%% 
IsNicknameUnique%% #
(%%# $
request%%$ +
.%%+ ,
Login%%, 1
,%%1 2
existingUser%%3 ?
.%%? @
Id%%@ B
)%%B C
)%%C D
throw&& 
new&& "
IncorrectDataException&& ,
(&&, -
$str&&- F
)&&F G
;&&G H
existingUser'' 
.'' 
Login'' 
='' 
request'' $
.''$ %
Login''% *
;''* +
await)) 
dbRepository)) 
.)) 
SaveChangesAsync)) +
())+ ,
))), -
;))- .
return** 
Ok** 
(** 
$str** )
)**) *
;*** +
},, 
[44 
HttpPost44 
]44 
[55 
Route55 

(55
 
$str55 
)55 
]55  
private66 
async66 
Task66 
<66 
bool66 
>66 
IsNicknameUnique66 -
(66- .
string66. 4
nickname665 =
,66= >
Guid66? C
currentUserId66D Q
)66Q R
{77 
return88 
await88 
dbRepository88 !
.88! "
Get88" %
<88% &
User88& *
>88* +
(88+ ,
x88, -
=>88. 0
x881 2
.882 3
Login883 8
==889 ;
nickname88< D
&&88E G
x88H I
.88I J
Id88J L
!=88M O
currentUserId88P ]
)88] ^
.88^ _
FirstOrDefaultAsync88_ r
(88r s
)88s t
==88u w
null99 
;99 
}:: 
[AA 
HttpPutAA 
]AA 
[BB 
RouteBB 

(BB
 
$strBB 
)BB 
]BB 
publicCC 

asyncCC 
TaskCC 
<CC 
ActionResultCC "
>CC" #
EditUserCC$ ,
(CC, -
[CC- .
FromBodyCC. 6
]CC6 7#
EditUserPasswordRequestCC8 O
requestCCP W
)CCW X
{DD 
varEE 
existingUserEE 
=EE 
awaitEE  
dbRepositoryEE! -
.EE- .
GetEE. 1
<EE1 2
UserEE2 6
>EE6 7
(EE7 8
)EE8 9
.EE9 :
FirstOrDefaultAsyncEE: M
(EEM N
xEEN O
=>EEP R
xEES T
.EET U
IdEEU W
==EEX Z
requestEE[ b
.EEb c
IdEEc e
)EEe f
;EEf g
ifFF 

(FF 
existingUserFF 
==FF 
nullFF  
)FF  !
throwGG 
newGG #
EntityNotFoundExceptionGG -
(GG- .
$strGG. >
)GG> ?
;GG? @
ifHH 

(HH 
requestHH 
.HH 
PasswordHH 
==HH 
nullHH  $
)HH$ %
throwII 
newII #
EntityNotFoundExceptionII -
(II- .
$strII. F
)IIF G
;IIG H
ifJJ 

(JJ 
requestJJ 
.JJ 
PasswordJJ 
.JJ 
LengthJJ #
<JJ$ %
$numJJ& '
)JJ' (
throwKK 
newKK #
EntityNotFoundExceptionKK -
(KK- .
$strKK. U
)KKU V
;KKV W
ifLL 

(LL 
requestLL 
.LL 
PasswordLL 
.LL 
LengthLL #
>LL$ %
$numLL& (
)LL( )
throwMM 
newMM #
EntityNotFoundExceptionMM -
(MM- .
$strMM. W
)MMW X
;MMX Y
existingUserOO 
.OO 
PasswordOO 
=OO 
hashHelpersOO  +
.OO+ ,
HashPasswordOO, 8
(OO8 9
requestOO9 @
.OO@ A
PasswordOOA I
,OOI J
existingUserOOK W
.OOW X
SaltOOX \
)OO\ ]
;OO] ^
awaitQQ 
dbRepositoryQQ 
.QQ 
SaveChangesAsyncQQ +
(QQ+ ,
)QQ, -
;QQ- .
returnRR 
OkRR 
(RR 
$strRR *
)RR* +
;RR+ ,
}SS 
[ZZ 
HttpPutZZ 
]ZZ 
[[[ 
Route[[ 

([[
 
$str[[ 
)[[ 
][[ 
public\\ 

async\\ 
Task\\ 
<\\ 
ActionResult\\ "
>\\" #
EditUserEmail\\$ 1
(\\1 2
[\\2 3
FromBody\\3 ;
]\\; < 
EditUserEmailRequest\\= Q
request\\R Y
)\\Y Z
{]] 
var^^ 
existingUser^^ 
=^^ 
await^^  
dbRepository^^! -
.^^- .
Get^^. 1
<^^1 2
User^^2 6
>^^6 7
(^^7 8
)^^8 9
.^^9 :
FirstOrDefaultAsync^^: M
(^^M N
x^^N O
=>^^P R
x^^S T
.^^T U
Id^^U W
==^^X Z
request^^[ b
.^^b c
Id^^c e
)^^e f
;^^f g
if__ 

(__ 
existingUser__ 
==__ 
null__  
)__  !
throw`` 
new`` #
EntityNotFoundException`` -
(``- .
$str``. >
)``> ?
;``? @
ifaa 

(aa 
requestaa 
.aa 
Emailaa 
==aa 
nullaa !
)aa! "
throwbb 
newbb "
IncorrectDataExceptionbb ,
(bb, -
$strbb- B
)bbB C
;bbC D
switchcc 
(cc 
requestcc 
.cc 
Emailcc 
.cc 
Lengthcc $
)cc$ %
{dd 	
caseee 
<ee 
$numee 
:ee 
throwff 
newff "
IncorrectDataExceptionff 0
(ff0 1
$strff1 U
)ffU V
;ffV W
casegg 
>gg 
$numgg 
:gg 
throwhh 
newhh "
IncorrectDataExceptionhh 0
(hh0 1
$strhh1 W
)hhW X
;hhX Y
}ii 	
ifkk 

(kk 
IsEmailValidkk 
(kk 
requestkk  
.kk  !
Emailkk! &
)kk& '
)kk' (
throwll 
newll "
IncorrectDataExceptionll ,
(ll, -
$strll- S
)llS T
;llT U
ifnn 

(nn 
!nn 
awaitnn 
IsEmailUniqueAsyncnn %
(nn% &
requestnn& -
.nn- .
Emailnn. 3
,nn3 4
existingUsernn5 A
.nnA B
IdnnB D
)nnD E
)nnE F
throwoo 
newoo "
IncorrectDataExceptionoo ,
(oo, -
$stroo- C
)ooC D
;ooD E
existingUserpp 
.pp 
Loginpp 
=pp 
requestpp $
.pp$ %
Emailpp% *
;pp* +
awaitrr 
dbRepositoryrr 
.rr 
SaveChangesAsyncrr +
(rr+ ,
)rr, -
;rr- .
returnss 
Okss 
(ss 
$strss )
)ss) *
;ss* +
}uu 
[|| 
HttpPut|| 
]|| 
[}} 
Route}} 

(}}
 
$str}} 
)}} 
]}} 
public~~ 

Task~~ 
<~~ 
ActionResult~~ 
>~~ 
EditUser~~ &
(~~& '
[~~' (
FromBody~~( 0
]~~0 1
EditUserRequest~~2 A
request~~B I
)~~I J
{ 
return
АА 
Task
АА 
.
АА 

FromResult
АА 
<
АА 
ActionResult
АА +
>
АА+ ,
(
АА, -
Ok
АА- /
(
АА/ 0
$str
АА0 6
)
АА6 7
)
АА7 8
;
АА8 9
}
ББ 
[
ИИ 
HttpGet
ИИ 
]
ИИ 
[
ЙЙ 
Route
ЙЙ 

(
ЙЙ
 
$str
ЙЙ %
)
ЙЙ% &
]
ЙЙ& '
public
КК 

async
КК 
Task
КК 
<
КК 
IActionResult
КК #
>
КК# $!
GetUserLoginHistory
КК% 8
(
КК8 9
Guid
КК9 =
id
КК> @
)
КК@ A
{
ЛЛ 
var
ММ 
loginHistory
ММ 
=
ММ 
await
ММ  
dbRepository
ММ! -
.
ММ- .
Get
ММ. 1
<
ММ1 2
LoginHistory
ММ2 >
>
ММ> ?
(
ММ? @
)
ММ@ A
.
ММA B
Where
ММB G
(
ММG H
x
ММH I
=>
ММJ L
x
ММM N
.
ММN O
UserId
ММO U
==
ММV X
id
ММY [
)
ММ[ \
.
ММ\ ]
ToListAsync
ММ] h
(
ММh i
)
ММi j
;
ММj k
if
НН 

(
НН 
loginHistory
НН 
==
НН 
null
НН  
)
НН  !
throw
ОО 
new
ОО %
EntityNotFoundException
ОО -
(
ОО- .
$str
ОО. F
)
ООF G
;
ООG H
return
ПП 
Ok
ПП 
(
ПП 
loginHistory
ПП 
)
ПП 
;
ПП  
}
РР 
[
ЧЧ 
HttpGet
ЧЧ 
]
ЧЧ 
[
ШШ 
Route
ШШ 

(
ШШ
 
$str
ШШ 
)
ШШ 
]
ШШ 
public
ЩЩ 

async
ЩЩ 
Task
ЩЩ 
<
ЩЩ 
IActionResult
ЩЩ #
>
ЩЩ# $
GetUserLoginById
ЩЩ% 5
(
ЩЩ5 6
Guid
ЩЩ6 :
id
ЩЩ; =
)
ЩЩ= >
{
ЪЪ 
var
ЫЫ 
existingUser
ЫЫ 
=
ЫЫ 
await
ЫЫ  
dbRepository
ЫЫ! -
.
ЫЫ- .
Get
ЫЫ. 1
<
ЫЫ1 2
User
ЫЫ2 6
>
ЫЫ6 7
(
ЫЫ7 8
)
ЫЫ8 9
.
ЫЫ9 :!
FirstOrDefaultAsync
ЫЫ: M
(
ЫЫM N
x
ЫЫN O
=>
ЫЫP R
x
ЫЫS T
.
ЫЫT U
Id
ЫЫU W
==
ЫЫX Z
id
ЫЫ[ ]
)
ЫЫ] ^
;
ЫЫ^ _
if
ЬЬ 

(
ЬЬ 
existingUser
ЬЬ 
==
ЬЬ 
null
ЬЬ  
)
ЬЬ  !
throw
ЭЭ 
new
ЭЭ %
EntityNotFoundException
ЭЭ -
(
ЭЭ- .
$str
ЭЭ. >
)
ЭЭ> ?
;
ЭЭ? @
return
ЮЮ 
Ok
ЮЮ 
(
ЮЮ 
existingUser
ЮЮ 
.
ЮЮ 
Login
ЮЮ $
)
ЮЮ$ %
;
ЮЮ% &
}
ЯЯ 
[
жж 

HttpDelete
жж 
]
жж 
[
зз 
Route
зз 

(
зз
 
$str
зз 
)
зз 
]
зз 
public
ии 

async
ии 
Task
ии 
<
ии 
ActionResult
ии "
>
ии" #
DeleteAccount
ии$ 1
(
ии1 2
Guid
ии2 6
id
ии7 9
)
ии9 :
{
йй 
var
кк 
existingUser
кк 
=
кк 
await
кк  
dbRepository
кк! -
.
кк- .
Get
кк. 1
<
кк1 2
User
кк2 6
>
кк6 7
(
кк7 8
)
кк8 9
.
кк9 :!
FirstOrDefaultAsync
кк: M
(
ккM N
x
ккN O
=>
ккP R
x
ккS T
.
ккT U
Id
ккU W
==
ккX Z
id
кк[ ]
)
кк] ^
;
кк^ _
if
лл 

(
лл 
existingUser
лл 
==
лл 
null
лл  
)
лл  !
throw
мм 
new
мм %
EntityNotFoundException
мм -
(
мм- .
$str
мм. >
)
мм> ?
;
мм? @
existingUser
оо 
.
оо 
	IsDeleted
оо 
=
оо  
true
оо! %
;
оо% &
existingUser
пп 
.
пп 
DateUpdated
пп  
=
пп! "
DateTime
пп# +
.
пп+ ,
UtcNow
пп, 2
;
пп2 3
await
▒▒ 
dbRepository
▒▒ 
.
▒▒ 
SaveChangesAsync
▒▒ +
(
▒▒+ ,
)
▒▒, -
;
▒▒- .
return
▓▓ 
Ok
▓▓ 
(
▓▓ 
$str
▓▓ '
)
▓▓' (
;
▓▓( )
}
││ 
[
╗╗ 
HttpPut
╗╗ 
]
╗╗ 
[
╝╝ 
Route
╝╝ 

(
╝╝
 
$str
╝╝ 
)
╝╝ 
]
╝╝ 
public
╜╜ 

async
╜╜ 
Task
╜╜ 
<
╜╜ 
ActionResult
╜╜ "
>
╜╜" #
ChangeUserName
╜╜$ 2
(
╜╜2 3
Guid
╜╜3 7
id
╜╜8 :
,
╜╜: ;
string
╜╜< B
newLogin
╜╜C K
)
╜╜K L
{
╛╛ 
var
┐┐ 
existingUser
┐┐ 
=
┐┐ 
await
┐┐  
dbRepository
┐┐! -
.
┐┐- .
Get
┐┐. 1
<
┐┐1 2
User
┐┐2 6
>
┐┐6 7
(
┐┐7 8
)
┐┐8 9
.
┐┐9 :!
FirstOrDefaultAsync
┐┐: M
(
┐┐M N
x
┐┐N O
=>
┐┐P R
x
┐┐S T
.
┐┐T U
Id
┐┐U W
==
┐┐X Z
id
┐┐[ ]
)
┐┐] ^
;
┐┐^ _
if
└└ 

(
└└ 
existingUser
└└ 
is
└└ 
null
└└  
)
└└  !
throw
┴┴ 
new
┴┴ %
EntityNotFoundException
┴┴ -
(
┴┴- .
$str
┴┴. >
)
┴┴> ?
;
┴┴? @
switch
┬┬ 
(
┬┬ 
newLogin
┬┬ 
.
┬┬ 
Length
┬┬ 
)
┬┬  
{
├├ 	
case
── 
$num
── 
:
── 
throw
┼┼ 
new
┼┼ $
IncorrectDataException
┼┼ 0
(
┼┼0 1
$str
┼┼1 C
)
┼┼C D
;
┼┼D E
case
╞╞ 
>
╞╞ 
$num
╞╞ 
:
╞╞ 
throw
╟╟ 
new
╟╟ $
IncorrectDataException
╟╟ 0
(
╟╟0 1
$str
╟╟1 X
)
╟╟X Y
;
╟╟Y Z
case
╚╚ 
<
╚╚ 
$num
╚╚ 
:
╚╚ 
throw
╔╔ 
new
╔╔ $
IncorrectDataException
╔╔ 0
(
╔╔0 1
$str
╔╔1 X
)
╔╔X Y
;
╔╔Y Z
}
╩╩ 	
existingUser
╠╠ 
.
╠╠ 
Login
╠╠ 
=
╠╠ 
newLogin
╠╠ %
;
╠╠% &
existingUser
══ 
.
══ 
DateUpdated
══  
=
══! "
DateTime
══# +
.
══+ ,
UtcNow
══, 2
;
══2 3
await
╧╧ 
dbRepository
╧╧ 
.
╧╧ 
SaveChangesAsync
╧╧ +
(
╧╧+ ,
)
╧╧, -
;
╧╧- .
return
╨╨ 
Ok
╨╨ 
(
╨╨ 
$str
╨╨ *
)
╨╨* +
;
╨╨+ ,
}
╤╤ 
[
╪╪ 
HttpPut
╪╪ 
]
╪╪ 
[
┘┘ 
Route
┘┘ 

(
┘┘
 
$str
┘┘ 
)
┘┘ 
]
┘┘ 
public
┌┌ 

async
┌┌ 
Task
┌┌ 
<
┌┌ 
ActionResult
┌┌ "
>
┌┌" #
ChangePassword
┌┌$ 2
(
┌┌2 3
[
┌┌3 4
FromBody
┌┌4 <
]
┌┌< =#
ChangePasswordRequest
┌┌> S
request
┌┌T [
)
┌┌[ \
{
██ 
var
▄▄ 
existingUser
▄▄ 
=
▄▄ 
await
▄▄  
dbRepository
▄▄! -
.
▄▄- .
Get
▄▄. 1
<
▄▄1 2
User
▄▄2 6
>
▄▄6 7
(
▄▄7 8
)
▄▄8 9
.
▄▄9 :!
FirstOrDefaultAsync
▄▄: M
(
▄▄M N
x
▄▄N O
=>
▄▄P R
x
▄▄S T
.
▄▄T U
Id
▄▄U W
==
▄▄X Z
request
▄▄[ b
.
▄▄b c
Id
▄▄c e
)
▄▄e f
;
▄▄f g
if
▌▌ 

(
▌▌ 
existingUser
▌▌ 
is
▌▌ 
null
▌▌  
)
▌▌  !
throw
▐▐ 
new
▐▐ %
EntityNotFoundException
▐▐ -
(
▐▐- .
$str
▐▐. >
)
▐▐> ?
;
▐▐? @
if
▀▀ 

(
▀▀ 
request
▀▀ 
.
▀▀ 
Password
▀▀ 
!=
▀▀ 
request
▀▀  '
.
▀▀' (
PasswordRepeat
▀▀( 6
)
▀▀6 7
return
▀▀8 >!
UnprocessableEntity
▀▀? R
(
▀▀R S
$str
▀▀S h
)
▀▀h i
;
▀▀i j
switch
рр 
(
рр 
request
рр 
.
рр 
Password
рр  
.
рр  !
Length
рр! '
)
рр' (
{
сс 	
case
тт 
$num
тт 
:
тт 
return
уу !
UnprocessableEntity
уу *
(
уу* +
$str
уу+ =
)
уу= >
;
уу> ?
case
фф 
>
фф 
$num
фф 
:
фф 
return
хх !
UnprocessableEntity
хх *
(
хх* +
$str
хх+ R
)
ххR S
;
ххS T
case
цц 
<
цц 
$num
цц 
:
цц 
return
чч !
UnprocessableEntity
чч *
(
чч* +
$str
чч+ R
)
ччR S
;
ччS T
}
шш 	
existingUser
ъъ 
.
ъъ 
Password
ъъ 
=
ъъ 
hashHelpers
ъъ  +
.
ъъ+ ,
HashPassword
ъъ, 8
(
ъъ8 9
request
ъъ9 @
.
ъъ@ A
Password
ъъA I
,
ъъI J
existingUser
ъъK W
.
ъъW X
Salt
ъъX \
)
ъъ\ ]
;
ъъ] ^
existingUser
ыы 
.
ыы 
DateUpdated
ыы  
=
ыы! "
DateTime
ыы# +
.
ыы+ ,
UtcNow
ыы, 2
;
ыы2 3
await
ээ 
dbRepository
ээ 
.
ээ 
SaveChangesAsync
ээ +
(
ээ+ ,
)
ээ, -
;
ээ- .
return
яя 
Ok
яя 
(
яя 
$str
яя *
)
яя* +
;
яя+ ,
}
ЁЁ 
[
ўў 
HttpPost
ўў 
]
ўў 
[
°° 
Route
°° 

(
°°
 
$str
°° 
)
°° 
]
°° 
public
∙∙ 

async
∙∙ 
Task
∙∙ 
CreateUserAsync
∙∙ %
(
∙∙% &
CreateUserRequest
∙∙& 7
request
∙∙8 ?
)
∙∙? @
{
·· 
if
√√ 

(
√√ 
request
√√ 
==
√√ 
null
√√ 
)
√√ 
throw
№№ 
new
№№ %
EntityNotFoundException
№№ -
(
№№- .
$str
№№. <
)
№№< =
;
№№= >
if
¤¤ 

(
¤¤ 
request
¤¤ 
.
¤¤ 
Nickname
¤¤ 
==
¤¤ 
null
¤¤  $
)
¤¤$ %
throw
■■ 
new
■■ %
EntityNotFoundException
■■ -
(
■■- .
$str
■■. F
)
■■F G
;
■■G H
switch
   
(
   
request
   
.
   
Nickname
    
.
    !
Length
  ! '
)
  ' (
{
АА 	
case
ББ 
<
ББ 
$num
ББ 
:
ББ 
throw
ВВ 
new
ВВ %
EntityNotFoundException
ВВ 1
(
ВВ1 2
$str
ВВ2 Y
)
ВВY Z
;
ВВZ [
case
ГГ 
>
ГГ 
$num
ГГ 
:
ГГ 
throw
ДД 
new
ДД %
EntityNotFoundException
ДД 1
(
ДД1 2
$str
ДД2 [
)
ДД[ \
;
ДД\ ]
}
ЕЕ 	
if
ЗЗ 

(
ЗЗ 
request
ЗЗ 
.
ЗЗ 
Password
ЗЗ 
==
ЗЗ 
null
ЗЗ  $
)
ЗЗ$ %
throw
ИИ 
new
ИИ %
EntityNotFoundException
ИИ -
(
ИИ- .
$str
ИИ. F
)
ИИF G
;
ИИG H
switch
КК 
(
КК 
request
КК 
.
КК 
Password
КК  
.
КК  !
Length
КК! '
)
КК' (
{
ЛЛ 	
case
ММ 
<
ММ 
$num
ММ 
:
ММ 
throw
НН 
new
НН %
EntityNotFoundException
НН 1
(
НН1 2
$str
НН2 Y
)
ННY Z
;
ННZ [
case
ОО 
>
ОО 
$num
ОО 
:
ОО 
throw
ПП 
new
ПП %
EntityNotFoundException
ПП 1
(
ПП1 2
$str
ПП2 [
)
ПП[ \
;
ПП\ ]
}
РР 	
var
ТТ 
user
ТТ 
=
ТТ 
new
ТТ 
User
ТТ 
(
ТТ 
)
ТТ 
;
ТТ 
if
УУ 

(
УУ 
!
УУ 
await
УУ 
IsNicknameUnique
УУ #
(
УУ# $
request
УУ$ +
.
УУ+ ,
Nickname
УУ, 4
)
УУ4 5
)
УУ5 6
throw
УУ7 <
new
УУ= @$
IncorrectDataException
УУA W
(
УУW X
$str
УУX q
)
УУq r
;
УУr s
user
ФФ 
.
ФФ 
Login
ФФ 
=
ФФ 
request
ФФ 
.
ФФ 
Nickname
ФФ %
;
ФФ% &
user
ХХ 
.
ХХ 
Salt
ХХ 
=
ХХ 
hashHelpers
ХХ 
.
ХХ  
GenerateSalt
ХХ  ,
(
ХХ, -
$num
ХХ- /
)
ХХ/ 0
;
ХХ0 1
user
ЦЦ 
.
ЦЦ 
Password
ЦЦ 
=
ЦЦ 
hashHelpers
ЦЦ #
.
ЦЦ# $
HashPassword
ЦЦ$ 0
(
ЦЦ0 1
request
ЦЦ1 8
.
ЦЦ8 9
Password
ЦЦ9 A
,
ЦЦA B
user
ЦЦC G
.
ЦЦG H
Salt
ЦЦH L
)
ЦЦL M
;
ЦЦM N
user
ЧЧ 
.
ЧЧ 
DateCreated
ЧЧ 
=
ЧЧ 
DateTime
ЧЧ #
.
ЧЧ# $
UtcNow
ЧЧ$ *
;
ЧЧ* +
user
ШШ 
.
ШШ 
Id
ШШ 
=
ШШ 
request
ШШ 
.
ШШ 
Id
ШШ 
;
ШШ 
await
ЩЩ 
dbRepository
ЩЩ 
.
ЩЩ 
Add
ЩЩ 
(
ЩЩ 
user
ЩЩ #
)
ЩЩ# $
;
ЩЩ$ %
await
ЪЪ 
dbRepository
ЪЪ 
.
ЪЪ 
SaveChangesAsync
ЪЪ +
(
ЪЪ+ ,
)
ЪЪ, -
;
ЪЪ- .
}
ЫЫ 
[
вв 
HttpPost
вв 
]
вв 
[
гг 
Route
гг 

(
гг
 
$str
гг 
)
гг 
]
гг 
private
дд 
async
дд 
Task
дд 
<
дд 
bool
дд 
>
дд 
IsNicknameUnique
дд -
(
дд- .
string
дд. 4
nickname
дд5 =
)
дд= >
=>
дд? A
await
ддB G
dbRepository
ддH T
.
ддT U
Get
ддU X
<
ддX Y
User
ддY ]
>
дд] ^
(
дд^ _
x
дд_ `
=>
ддa c
x
ддd e
.
ддe f
Login
ддf k
==
ддl n
nickname
ддo w
)
ддw x
.
ддx y"
FirstOrDefaultAsyncддy М
(ддМ Н
)ддН О
==ддП С
nullддТ Ц
;ддЦ Ч
[
мм 
HttpPost
мм 
]
мм 
[
нн 
Route
нн 

(
нн
 
$str
нн 
)
нн  
]
нн  !
public
оо 

async
оо 
Task
оо 
<
оо 
bool
оо 
>
оо  
IsEmailUniqueAsync
оо .
(
оо. /
string
оо/ 5
email
оо6 ;
,
оо; <
Guid
оо= A
id
ооB D
)
ооD E
{
пп 
var
░░ 
users
░░ 
=
░░ 
await
░░ 
dbRepository
░░ &
.
░░& '
Get
░░' *
<
░░* +
User
░░+ /
>
░░/ 0
(
░░0 1
)
░░1 2
.
▒▒ 
Where
▒▒ 
(
▒▒ 
x
▒▒ 
=>
▒▒ 
x
▒▒ 
.
▒▒ 
Email
▒▒ 
==
▒▒  "
email
▒▒# (
&&
▒▒) +
x
▒▒, -
.
▒▒- .
Id
▒▒. 0
!=
▒▒1 3
id
▒▒4 6
)
▒▒6 7
.
▓▓ 
ToListAsync
▓▓ 
(
▓▓ 
)
▓▓ 
;
▓▓ 
return
┤┤ 
users
┤┤ 
.
┤┤ 
Count
┤┤ 
==
┤┤ 
$num
┤┤ 
;
┤┤  
}
╡╡ 
[
╝╝ 
HttpPost
╝╝ 
]
╝╝ 
[
╜╜ 
Route
╜╜ 

(
╜╜
 
$str
╜╜ 
)
╜╜  
]
╜╜  !
public
╛╛ 

async
╛╛ 
Task
╛╛ 
<
╛╛ 
bool
╛╛ 
>
╛╛  
IsLoginUniqueAsync
╛╛ .
(
╛╛. /
string
╛╛/ 5
login
╛╛6 ;
)
╛╛; <
{
┐┐ 
var
└└ 
userWithSameEmail
└└ 
=
└└ 
await
└└  %
dbRepository
└└& 2
.
└└2 3
Get
└└3 6
<
└└6 7
User
└└7 ;
>
└└; <
(
└└< =
)
└└= >
.
┴┴ 
Where
┴┴ 
(
┴┴ 
x
┴┴ 
=>
┴┴ 
x
┴┴ 
.
┴┴ 
Login
┴┴ 
==
┴┴  "
login
┴┴# (
)
┴┴( )
.
┬┬ 
ToListAsync
┬┬ 
(
┬┬ 
)
┬┬ 
;
┬┬ 
return
── 
userWithSameEmail
──  
.
──  !
Count
──! &
==
──' )
$num
──* +
;
──+ ,
}
┼┼ 
[
╠╠ 
HttpPost
╠╠ 
]
╠╠ 
[
══ 
Route
══ 

(
══
 
$str
══ 
)
══ 
]
══ 
public
╬╬ 

bool
╬╬ 
IsEmailValid
╬╬ 
(
╬╬ 
string
╬╬ #
email
╬╬$ )
)
╬╬) *
=>
╬╬+ -
Regex
╬╬. 3
.
╬╬3 4
IsMatch
╬╬4 ;
(
╬╬; <
email
╬╬< A
,
╬╬A B
$str
╬╬C j
,
╬╬j k
RegexOptions
╬╬l x
.
╬╬x y

IgnoreCase╬╬y Г
)╬╬Г Д
;╬╬Д Е
}╧╧ Жч
HC:\work\BSUIR\crypto-wallet\Backend\Controllers\TransactionController.cs
	namespace		 	
UP		
 
.		 
Controllers		 
;		 
[ 
ApiController 
] 
[ 
Route 
( 
$str 
) 
] 
public 
class !
TransactionController "
(" #
IDbRepository 
dbRepository 
, 
ILogger 
< !
TransactionController !
>! "
logger# )
,) *
IUserRepository 
userRepository "
," #
ICurrencyRepository 
currencyRepository *
,* +#
ITransactionsRepository "
transactionsRepository 2
,2 3
IEmailService 
emailService 
) 
: 
ControllerBase 
{ 
[ 
HttpGet 
] 
[ 
Route 

(
 
$str 5
)5 6
]6 7
public 

async 
Task 
< 
ActionResult "
>" #
GetCoinQuantity$ 3
(3 4
string4 :
coinName; C
,C D
doubleE K
quantityUSDL W
)W X
{ 
return   
Ok   
(   
await   
currencyRepository   *
.  * +
GetCoinQuantity  + :
(  : ;
quantityUSD  ; F
,  F G
coinName  H P
)  P Q
)  Q R
;  R S
}!! 
[(( 
HttpGet(( 
](( 
[)) 
Route)) 

())
 
$str)) -
)))- .
])). /
public** 

Task** 
<** 
ActionResult** 
>** 
GetUserList** )
(**) *
Guid*** .
id**/ 1
)**1 2
{++ 
return,, 
Task,, 
.,, 

FromResult,, 
<,, 
ActionResult,, +
>,,+ ,
(,,, -
Ok,,- /
(,,/ 0"
transactionsRepository,,0 F
.,,F G%
GetUserConversionsHistory,,G `
(,,` a
id,,a c
),,c d
),,d e
),,e f
;,,f g
}-- 
[44 
HttpGet44 
]44 
[55 
Route55 

(55
 
$str55 '
)55' (
]55( )
public66 

Task66 
<66 
ActionResult66 
>66 !
GetUserDepositHistory66 3
(663 4
Guid664 8
id669 ;
)66; <
{77 
return88 
Task88 
.88 

FromResult88 
<88 
ActionResult88 +
>88+ ,
(88, -
Ok88- /
(88/ 0"
transactionsRepository880 F
.88F G!
GetUserDepositHistory88G \
(88\ ]
id88] _
)88_ `
)88` a
)88a b
;88b c
}99 
[@@ 
HttpPost@@ 
]@@ 
[AA 
RouteAA 

(AA
 
$strAA 
)AA 
]AA 
publicBB 

asyncBB 
TaskBB 
<BB 
ActionResultBB "
>BB" #
ConvertBB$ +
(BB+ ,
[BB, -
FromBodyBB- 5
]BB5 6
ConvertRequestBB7 E
requestBBF M
)BBM N
{CC 
switchDD 
(DD 
requestDD 
.DD 
QuantityDD  
)DD  !
{EE 	
caseFF 
$numFF 
:FF 
loggerGG 
.GG 
LogInformationGG %
(GG% &
$strGG& O
)GGO P
;GGP Q
returnHH 

BadRequestHH !
(HH! "
$strHH" F
)HHF G
;HHG H
caseII 
<II 
$numII 
:II 
loggerJJ 
.JJ 
LogInformationJJ %
(JJ% &
$strJJ& O
)JJO P
;JJP Q
returnKK 

BadRequestKK !
(KK! "
$strKK" F
)KKF G
;KKG H
}LL 	
varNN 
apiKeyNN 
=NN 
$strNN W
;NNW X
usingOO 
varOO 

httpClientOO 
=OO 
newOO "

HttpClientOO# -
(OO- .
)OO. /
;OO/ 0

httpClientPP 
.PP !
DefaultRequestHeadersPP (
.PP( )
AddPP) ,
(PP, -
$strPP- ;
,PP; <
apiKeyPP= C
)PPC D
;PPD E
varQQ 
urlQQ 
=QQ 
$strQQ F
+QQG H
requestQQI P
.QQP Q
ShortNameStartQQQ _
+QQ` a
$strQQb k
+QQl m
requestRR 
.RR 
ShortNameFinalRR (
;RR( )
varSS 
responseSS 
=SS 
awaitSS 

httpClientSS '
.SS' (
GetAsyncSS( 0
(SS0 1
urlSS1 4
)SS4 5
;SS5 6
varTT 
responseContentTT 
=TT 
awaitTT #
responseTT$ ,
.TT, -
ContentTT- 4
.TT4 5
ReadAsStringAsyncTT5 F
(TTF G
)TTG H
;TTH I
varUU 
jsonUU 
=UU 
JObjectUU 
.UU 
ParseUU  
(UU  !
responseContentUU! 0
)UU0 1
;UU1 2
varVV 

priceRatioVV 
=VV 
(VV 
doubleVV  
)VV  !
jsonVV! %
[VV% &
requestVV& -
.VV- .
ShortNameFinalVV. <
.VV< =
ToUpperVV= D
(VVD E
)VVE F
]VVF G
;VVG H
varWW 
finalQuantityWW 
=WW 

priceRatioWW &
*WW' (
requestWW) 0
.WW0 1
QuantityWW1 9
;WW9 :
varXX )
startCoinQuantityInUserWalletXX )
=XX* +
userRepositoryYY 
.YY '
GetCoinQuantityInUserWalletYY 6
(YY6 7
requestYY7 >
.YY> ?
UserIdYY? E
,YYE F
requestYYG N
.YYN O
ShortNameStartYYO ]
)YY] ^
;YY^ _
ifZZ 

(ZZ )
startCoinQuantityInUserWalletZZ )
<ZZ* +
requestZZ, 3
.ZZ3 4
QuantityZZ4 <
)ZZ< =
{[[ 	
logger\\ 
.\\ 
LogInformation\\ !
(\\! "
$str\\" a
)\\a b
;\\b c
return]] 

BadRequest]] 
(]] 
$str]] M
)]]M N
;]]N O
}^^ 	
currencyRepository`` 
.``  
SubtractCoinFromUser`` /
(``/ 0
request``0 7
.``7 8
UserId``8 >
,``> ?
request``@ G
.``G H
ShortNameStart``H V
,``V W
request``X _
.``_ `
Quantity``` h
)``h i
;``i j
currencyRepositoryaa 
.aa !
AddCryptoToUserWalletaa 0
(aa0 1
requestaa1 8
.aa8 9
UserIdaa9 ?
,aa? @
requestaaA H
.aaH I
ShortNameFinalaaI W
,aaW X
finalQuantityaaY f
)aaf g
;aag h
varcc 
conversionDatacc 
=cc 
newcc  

Conversioncc! +
{dd 	
Idee 
=ee 
Guidee 
.ee 
Emptyee 
,ee 

Commissionff 
=ff 
$numff 
,ff 
BeginCoinQuantitygg 
=gg 
requestgg  '
.gg' (
Quantitygg( 0
,gg0 1
EndCoinQuantityhh 
=hh 
finalQuantityhh +
,hh+ ,
QuantityUSDii 
=ii 
awaitii 
currencyRepositoryii  2
.ii2 3
GetCoinPriceii3 ?
(ii? @
requestii@ G
.iiG H
QuantityiiH P
,iiP Q
requestiiR Y
.iiY Z
ShortNameStartiiZ h
)iih i
,iii j
BeginCoinShortnamejj 
=jj  
requestjj! (
.jj( )
ShortNameStartjj) 7
,jj7 8
EndCoinShortnamekk 
=kk 
requestkk &
.kk& '
ShortNameFinalkk' 5
,kk5 6
UserIdll 
=ll 
requestll 
.ll 
UserIdll #
}mm 	
;mm	 

awaitoo 
dbRepositoryoo 
.oo 
Addoo 
(oo 
conversionDataoo -
)oo- .
;oo. /
awaitpp 
dbRepositorypp 
.pp 
SaveChangesAsyncpp +
(pp+ ,
)pp, -
;pp- .
loggerrr 
.rr 
LogInformationrr 
(rr 
$strrr 6
)rr6 7
;rr7 8
returnss 
Okss 
(ss 
$strss 1
)ss1 2
;ss2 3
}tt 
[{{ 
HttpPost{{ 
]{{ 
[|| 
Route|| 

(||
 
$str|| 
)|| 
]|| 
public}} 

async}} 
Task}} 
<}} 
ActionResult}} "
>}}" #
	BuyCrypto}}$ -
(}}- .
[}}. /
FromBody}}/ 7
]}}7 8
BuyCryptoRequest}}9 I
request}}J Q
)}}Q R
{~~ 
if 

( 
request 
. 
Quantity 
== 
$num  !
)! "
{
АА 	
logger
ББ 
.
ББ 
LogInformation
ББ !
(
ББ! "
$str
ББ" D
)
ББD E
;
ББE F
return
ВВ !
UnprocessableEntity
ВВ &
(
ВВ& '
$str
ВВ' K
)
ВВK L
;
ВВL M
}
ГГ 	
var
ЕЕ &
quantityUsdtInUserWallet
ЕЕ $
=
ЕЕ% &
userRepository
ЕЕ' 5
.
ЕЕ5 6)
GetCoinQuantityInUserWallet
ЕЕ6 Q
(
ЕЕQ R
request
ЕЕR Y
.
ЕЕY Z
UserId
ЕЕZ `
,
ЕЕ` a
$str
ЕЕb h
)
ЕЕh i
;
ЕЕi j
if
ЖЖ 

(
ЖЖ &
quantityUsdtInUserWallet
ЖЖ $
<
ЖЖ% &
request
ЖЖ' .
.
ЖЖ. /
Quantity
ЖЖ/ 7
)
ЖЖ7 8
{
ЗЗ 	
logger
ИИ 
.
ИИ 
LogInformation
ИИ !
(
ИИ! "
$str
ИИ" 6
)
ИИ6 7
;
ИИ7 8
return
ЙЙ !
UnprocessableEntity
ЙЙ &
(
ЙЙ& '
$str
ЙЙ' ;
)
ЙЙ; <
;
ЙЙ< =
}
КК 	 
currencyRepository
ММ 
.
ММ "
SubtractCoinFromUser
ММ /
(
ММ/ 0
request
ММ0 7
.
ММ7 8
UserId
ММ8 >
,
ММ> ?
$str
ММ@ F
,
ММF G
request
ММH O
.
ММO P
Quantity
ММP X
)
ММX Y
;
ММY Z
var
НН 
coinQuantity
НН 
=
НН 
await
НН   
currencyRepository
НН! 3
.
НН3 4
GetCoinQuantity
НН4 C
(
ННC D
request
ННD K
.
ННK L
Quantity
ННL T
,
ННT U
request
ННV ]
.
НН] ^
CoinName
НН^ f
)
ННf g
;
ННg h 
currencyRepository
ОО 
.
ОО #
AddCryptoToUserWallet
ОО 0
(
ОО0 1
request
ОО1 8
.
ОО8 9
UserId
ОО9 ?
,
ОО? @
request
ООA H
.
ООH I
CoinName
ООI Q
,
ООQ R
coinQuantity
ООS _
)
ОО_ `
;
ОО` a
logger
ПП 
.
ПП 
LogInformation
ПП 
(
ПП 
$str
ПП '
+
ПП( )
request
ПП* 1
.
ПП1 2
UserId
ПП2 8
+
ПП9 :
$str
ПП; F
+
ППG H
coinQuantity
ППI U
+
ППV W
$str
ППX [
+
ПП\ ]
request
ПП^ e
.
ППe f
CoinName
ППf n
)
ППn o
;
ППo p
return
РР 
Ok
РР 
(
РР 
$str
РР 0
)
РР0 1
;
РР1 2
}
СС 
[
ШШ 
HttpPut
ШШ 
]
ШШ 
[
ЩЩ 
Route
ЩЩ 

(
ЩЩ
 
$str
ЩЩ 
)
ЩЩ 
]
ЩЩ 
public
ЪЪ 

async
ЪЪ 
Task
ЪЪ 
<
ЪЪ 
ActionResult
ЪЪ "
>
ЪЪ" #

SellCrypto
ЪЪ$ .
(
ЪЪ. /
[
ЪЪ/ 0
FromBody
ЪЪ0 8
]
ЪЪ8 9
SellCryptoRequest
ЪЪ: K
request
ЪЪL S
)
ЪЪS T
{
ЫЫ 
switch
ЬЬ 
(
ЬЬ 
request
ЬЬ 
.
ЬЬ 
QuantityForSell
ЬЬ '
)
ЬЬ' (
{
ЭЭ 	
case
ЮЮ 
$num
ЮЮ 
:
ЮЮ 
logger
ЯЯ 
.
ЯЯ 
LogInformation
ЯЯ %
(
ЯЯ% &
$str
ЯЯ& H
)
ЯЯH I
;
ЯЯI J
return
аа !
UnprocessableEntity
аа *
(
аа* +
$str
аа+ O
)
ааO P
;
ааP Q
case
бб 
<
бб 
$num
бб 
:
бб 
logger
вв 
.
вв 
LogInformation
вв %
(
вв% &
$str
вв& H
)
ввH I
;
ввI J
return
гг 

BadRequest
гг !
(
гг! "
$str
гг" F
)
ггF G
;
ггG H
}
дд 	
var
жж "
quantityInUserWallet
жж  
=
жж! "
userRepository
жж# 1
.
жж1 2)
GetCoinQuantityInUserWallet
жж2 M
(
жжM N
request
жжN U
.
жжU V
UserId
жжV \
,
жж\ ]
request
жж^ e
.
жжe f
CoinName
жжf n
)
жжn o
;
жжo p
if
зз 

(
зз "
quantityInUserWallet
зз  
<
зз! "
request
зз# *
.
зз* +
QuantityForSell
зз+ :
)
зз: ;
{
ии 	
logger
йй 
.
йй 
LogInformation
йй !
(
йй! "
$str
йй" 4
)
йй4 5
;
йй5 6
return
кк !
UnprocessableEntity
кк &
(
кк& '
$str
кк' ;
)
кк; <
;
кк< =
}
лл 	 
currencyRepository
нн 
.
нн "
SubtractCoinFromUser
нн /
(
нн/ 0
request
нн0 7
.
нн7 8
UserId
нн8 >
,
нн> ?
request
нн@ G
.
ннG H
CoinName
ннH P
,
ннP Q
request
ннR Y
.
ннY Z
QuantityForSell
ннZ i
)
ннi j
;
ннj k 
currencyRepository
оо 
.
оо #
AddCryptoToUserWallet
оо 0
(
оо0 1
request
оо1 8
.
оо8 9
UserId
оо9 ?
,
оо? @
$str
ооA G
,
ооG H
await
пп  
currencyRepository
пп $
.
пп$ %
GetCoinPrice
пп% 1
(
пп1 2
request
пп2 9
.
пп9 :
QuantityForSell
пп: I
,
ппI J
request
ппK R
.
ппR S
CoinName
ппS [
)
пп[ \
)
пп\ ]
;
пп] ^
return
░░ 
Ok
░░ 
(
░░ 
$str
░░ 0
)
░░0 1
;
░░1 2
}
▒▒ 
[
╕╕ 
HttpPost
╕╕ 
]
╕╕ 
[
╣╣ 
Route
╣╣ 

(
╣╣
 
$str
╣╣ 
)
╣╣ 
]
╣╣ 
public
║║ 

Task
║║ 
<
║║ 
ActionResult
║║ 
>
║║ 

SendCrypto
║║ (
(
║║( )
[
║║) *
FromBody
║║* 2
]
║║2 3
SendCryptoRequest
║║4 E
request
║║F M
)
║║M N
{
╗╗ 
if
╝╝ 

(
╝╝ 
request
╝╝ 
.
╝╝ 

ReceiverId
╝╝ 
==
╝╝ !
request
╝╝" )
.
╝╝) *
SenderId
╝╝* 2
)
╝╝2 3
{
╜╜ 	
logger
╛╛ 
.
╛╛ 
LogInformation
╛╛ !
(
╛╛! "
$str
╛╛" M
)
╛╛M N
;
╛╛N O
return
┐┐ 
Task
┐┐ 
.
┐┐ 

FromResult
┐┐ "
<
┐┐" #
ActionResult
┐┐# /
>
┐┐/ 0
(
┐┐0 1!
UnprocessableEntity
┐┐1 D
(
┐┐D E
$str
┐┐E p
)
┐┐p q
)
┐┐q r
;
┐┐r s
}
└└ 	
switch
┬┬ 
(
┬┬ 
request
┬┬ 
.
┬┬ 
QuantityForSend
┬┬ '
)
┬┬' (
{
├├ 	
case
── 
$num
── 
:
── 
logger
┼┼ 
.
┼┼ 
LogInformation
┼┼ %
(
┼┼% &
$str
┼┼& H
)
┼┼H I
;
┼┼I J
return
╞╞ 
Task
╞╞ 
.
╞╞ 

FromResult
╞╞ &
<
╞╞& '
ActionResult
╞╞' 3
>
╞╞3 4
(
╞╞4 5!
UnprocessableEntity
╞╞5 H
(
╞╞H I
$str
╞╞I m
)
╞╞m n
)
╞╞n o
;
╞╞o p
case
╟╟ 
<
╟╟ 
$num
╟╟ 
:
╟╟ 
logger
╚╚ 
.
╚╚ 
LogInformation
╚╚ %
(
╚╚% &
$str
╚╚& H
)
╚╚H I
;
╚╚I J
return
╔╔ 
Task
╔╔ 
.
╔╔ 

FromResult
╔╔ &
<
╔╔& '
ActionResult
╔╔' 3
>
╔╔3 4
(
╔╔4 5!
UnprocessableEntity
╔╔5 H
(
╔╔H I
$str
╔╔I m
)
╔╔m n
)
╔╔n o
;
╔╔o p
}
╩╩ 	
var
╠╠ "
quantityInUserWallet
╠╠  
=
╠╠! "
userRepository
╠╠# 1
.
╠╠1 2)
GetCoinQuantityInUserWallet
╠╠2 M
(
╠╠M N
request
╠╠N U
.
╠╠U V
SenderId
╠╠V ^
,
╠╠^ _
request
╠╠` g
.
╠╠g h
CoinName
╠╠h p
)
╠╠p q
;
╠╠q r
if
══ 

(
══ "
quantityInUserWallet
══  
<
══! "
request
══# *
.
══* +
QuantityForSend
══+ :
)
══: ;
{
╬╬ 	
logger
╧╧ 
.
╧╧ 
LogInformation
╧╧ !
(
╧╧! "
$str
╧╧" 4
)
╧╧4 5
;
╧╧5 6
return
╨╨ 
Task
╨╨ 
.
╨╨ 

FromResult
╨╨ "
<
╨╨" #
ActionResult
╨╨# /
>
╨╨/ 0
(
╨╨0 1!
UnprocessableEntity
╨╨1 D
(
╨╨D E
$str
╨╨E Y
)
╨╨Y Z
)
╨╨Z [
;
╨╨[ \
}
╤╤ 	
try
╙╙ 
{
╘╘ 	 
currencyRepository
╒╒ 
.
╒╒ #
AddCryptoToUserWallet
╒╒ 4
(
╒╒4 5
request
╒╒5 <
.
╒╒< =

ReceiverId
╒╒= G
,
╒╒G H
request
╒╒I P
.
╒╒P Q
CoinName
╒╒Q Y
,
╒╒Y Z
request
╒╒[ b
.
╒╒b c
QuantityForSend
╒╒c r
)
╒╒r s
;
╒╒s t
}
╓╓ 	
catch
╫╫ 
(
╫╫ 
	Exception
╫╫ 
e
╫╫ 
)
╫╫ 
{
╪╪ 	
}
┌┌ 	 
currencyRepository
██ 
.
██ "
SubtractCoinFromUser
██ /
(
██/ 0
request
██0 7
.
██7 8
SenderId
██8 @
,
██@ A
request
██B I
.
██I J
CoinName
██J R
,
██R S
request
██T [
.
██[ \
QuantityForSend
██\ k
)
██k l
;
██l m 
currencyRepository
▄▄ 
.
▄▄ (
WriteTransactionToDatabase
▄▄ 5
(
▄▄5 6
request
▄▄6 =
.
▄▄= >
CoinName
▄▄> F
,
▄▄F G
request
▄▄H O
.
▄▄O P
QuantityForSend
▄▄P _
,
▄▄_ `
request
▄▄a h
.
▄▄h i
SenderId
▄▄i q
,
▄▄q r
request
▌▌ 
.
▌▌ 

ReceiverId
▌▌ 
)
▌▌ 
;
▌▌  
emailService
▀▀ 
.
▀▀ /
!SendEmailMessageTransactionsAsync
▀▀ 6
(
▀▀6 7
request
▀▀7 >
.
▀▀> ?
SenderId
▀▀? G
,
▀▀G H
request
▀▀I P
.
▀▀P Q
CoinName
▀▀Q Y
,
▀▀Y Z
request
▀▀[ b
.
▀▀b c
QuantityForSend
▀▀c r
,
▀▀r s
false
рр 
,
рр 
request
рр 
.
рр 

ReceiverId
рр %
)
рр% &
;
рр& '
emailService
сс 
.
сс /
!SendEmailMessageTransactionsAsync
сс 6
(
сс6 7
request
сс7 >
.
сс> ?

ReceiverId
сс? I
,
ссI J
request
ссK R
.
ссR S
CoinName
ссS [
,
сс[ \
request
сс] d
.
ссd e
QuantityForSend
ссe t
,
ссt u
true
тт 
,
тт 
request
тт 
.
тт 
SenderId
тт "
)
тт" #
;
тт# $
logger
фф 
.
фф 
LogInformation
фф 
(
фф 
$str
фф ?
)
фф? @
;
фф@ A
return
хх 
Task
хх 
.
хх 

FromResult
хх 
<
хх 
ActionResult
хх +
>
хх+ ,
(
хх, -
Ok
хх- /
(
хх/ 0
$str
хх0 J
)
ххJ K
)
ххK L
;
ххL M
}
цц 
[
ээ 
HttpPost
ээ 
]
ээ 
[
юю 
Route
юю 

(
юю
 
$str
юю  
)
юю  !
]
юю! "
public
яя 

Task
яя 
<
яя 
ActionResult
яя 
>
яя !
ReplenishTheBalance
яя 1
(
яя1 2
[
яя2 3
FromBody
яя3 ;
]
яя; <(
ReplenishTheBalanceRequest
яя= W
request
яяX _
)
яя_ `
{
ЁЁ 
logger
ёё 
.
ёё 
LogInformation
ёё 
(
ёё 
$str
ёё 8
+
ёё9 :
request
ёё; B
.
ёёB C
UserId
ёёC I
+
ёёJ K
$str
ёёL Q
+
ёёR S
request
ёёT [
.
ёё[ \
QuantityUsd
ёё\ g
+
ёёh i
$str
ёёj m
)
ёёm n
;
ёёn o
switch
ЄЄ 
(
ЄЄ 
request
ЄЄ 
.
ЄЄ 
QuantityUsd
ЄЄ #
)
ЄЄ# $
{
єє 	
case
ЇЇ 
$num
ЇЇ 
:
ЇЇ 
return
її 
Task
її 
.
її 

FromResult
її &
<
її& '
ActionResult
її' 3
>
її3 4
(
її4 5

BadRequest
її5 ?
(
її? @
$str
її@ d
)
їїd e
)
їїe f
;
їїf g
case
ЎЎ 
<
ЎЎ 
$num
ЎЎ 
:
ЎЎ 
return
ўў 
Task
ўў 
.
ўў 

FromResult
ўў &
<
ўў& '
ActionResult
ўў' 3
>
ўў3 4
(
ўў4 5

BadRequest
ўў5 ?
(
ўў? @
$str
ўў@ d
)
ўўd e
)
ўўe f
;
ўўf g
}
°° 	$
transactionsRepository
·· 
.
·· !
ReplenishTheBalance
·· 2
(
··2 3
request
··3 :
.
··: ;
UserId
··; A
,
··A B
request
··C J
.
··J K
QuantityUsd
··K V
)
··V W
;
··W X
logger
√√ 
.
√√ 
LogInformation
√√ 
(
√√ 
$str
√√ @
)
√√@ A
;
√√A B
return
№№ 
Task
№№ 
.
№№ 

FromResult
№№ 
<
№№ 
ActionResult
№№ +
>
№№+ ,
(
№№, -
Ok
№№- /
(
№№/ 0
$str
№№0 I
)
№№I J
)
№№J K
;
№№K L
}
¤¤ 
[
ДД 
HttpPut
ДД 
]
ДД 
[
ЕЕ 
Route
ЕЕ 

(
ЕЕ
 
$str
ЕЕ 
)
ЕЕ 
]
ЕЕ 
public
ЖЖ 

Task
ЖЖ 
<
ЖЖ 
ActionResult
ЖЖ 
>
ЖЖ 
WithdrawUSDT
ЖЖ *
(
ЖЖ* +
[
ЖЖ+ ,
FromBody
ЖЖ, 4
]
ЖЖ4 5
WithdrawRequest
ЖЖ6 E
request
ЖЖF M
)
ЖЖM N
{
ЗЗ 
logger
ИИ 
.
ИИ 
LogInformation
ИИ 
(
ИИ 
$str
ИИ 3
+
ИИ4 5
request
ИИ6 =
.
ИИ= >
UserId
ИИ> D
+
ИИE F
$str
ИИG L
+
ИИM N
request
ИИO V
.
ИИV W!
QuantityForWithdraw
ИИW j
+
ИИk l
$str
ИИm p
)
ИИp q
;
ИИq r
switch
ЙЙ 
(
ЙЙ 
request
ЙЙ 
.
ЙЙ !
QuantityForWithdraw
ЙЙ +
)
ЙЙ+ ,
{
КК 	
case
ЛЛ 
$num
ЛЛ 
:
ЛЛ 
return
ММ 
Task
ММ 
.
ММ 

FromResult
ММ &
<
ММ& '
ActionResult
ММ' 3
>
ММ3 4
(
ММ4 5!
UnprocessableEntity
ММ5 H
(
ММH I
$str
ММI m
)
ММm n
)
ММn o
;
ММo p
case
НН 
<
НН 
$num
НН 
:
НН 
logger
ОО 
.
ОО 
LogInformation
ОО %
(
ОО% &
$str
ОО& H
)
ООH I
;
ООI J
return
ПП 
Task
ПП 
.
ПП 

FromResult
ПП &
<
ПП& '
ActionResult
ПП' 3
>
ПП3 4
(
ПП4 5!
UnprocessableEntity
ПП5 H
(
ППH I
$str
ППI m
)
ППm n
)
ППn o
;
ППo p
}
РР 	
var
ТТ "
quantityInUserWallet
ТТ  
=
ТТ! "
userRepository
ТТ# 1
.
ТТ1 2)
GetCoinQuantityInUserWallet
ТТ2 M
(
ТТM N
request
ТТN U
.
ТТU V
UserId
ТТV \
,
ТТ\ ]
$str
ТТ^ d
)
ТТd e
;
ТТe f
if
УУ 

(
УУ "
quantityInUserWallet
УУ  
<
УУ! "
request
УУ# *
.
УУ* +!
QuantityForWithdraw
УУ+ >
)
УУ> ?
{
ФФ 	
logger
ХХ 
.
ХХ 
LogInformation
ХХ !
(
ХХ! "
$str
ХХ" 6
)
ХХ6 7
;
ХХ7 8
return
ЦЦ 
Task
ЦЦ 
.
ЦЦ 

FromResult
ЦЦ "
<
ЦЦ" #
ActionResult
ЦЦ# /
>
ЦЦ/ 0
(
ЦЦ0 1!
UnprocessableEntity
ЦЦ1 D
(
ЦЦD E
$str
ЦЦE Y
)
ЦЦY Z
)
ЦЦZ [
;
ЦЦ[ \
}
ЧЧ 	 
currencyRepository
ЩЩ 
.
ЩЩ "
SubtractCoinFromUser
ЩЩ /
(
ЩЩ/ 0
request
ЩЩ0 7
.
ЩЩ7 8
UserId
ЩЩ8 >
,
ЩЩ> ?
$str
ЩЩ@ F
,
ЩЩF G
request
ЩЩH O
.
ЩЩO P!
QuantityForWithdraw
ЩЩP c
)
ЩЩc d
;
ЩЩd e 
currencyRepository
ЪЪ 
.
ЪЪ %
WriteWithdrawToDatabase
ЪЪ 2
(
ЪЪ2 3
request
ЪЪ3 :
.
ЪЪ: ;!
QuantityForWithdraw
ЪЪ; N
,
ЪЪN O
request
ЪЪP W
.
ЪЪW X!
QuantityForWithdraw
ЪЪX k
*
ЪЪl m
$num
ЪЪn r
,
ЪЪr s
request
ЫЫ 
.
ЫЫ 
UserId
ЫЫ 
)
ЫЫ 
;
ЫЫ 
return
ЬЬ 
Task
ЬЬ 
.
ЬЬ 

FromResult
ЬЬ 
<
ЬЬ 
ActionResult
ЬЬ +
>
ЬЬ+ ,
(
ЬЬ, -
Ok
ЬЬ- /
(
ЬЬ/ 0
$str
ЬЬ0 N
)
ЬЬN O
)
ЬЬO P
;
ЬЬP Q
}
ЭЭ 
[
дд 
HttpGet
дд 
]
дд 
[
ее 
Route
ее 

(
ее
 
$str
ее /
)
ее/ 0
]
ее0 1
public
жж 

Task
жж 
<
жж 
IActionResult
жж 
>
жж '
GetUserWithdrawalsHistory
жж 8
(
жж8 9
Guid
жж9 =
userId
жж> D
)
жжD E
{
зз 
return
ии 
Task
ии 
.
ии 

FromResult
ии 
<
ии 
IActionResult
ии ,
>
ии, -
(
ии- .
Ok
ии. 0
(
ии0 1$
transactionsRepository
ии1 G
.
ииG H'
GetUserWithdrawalsHistory
ииH a
(
ииa b
userId
ииb h
)
ииh i
)
ииi j
)
ииj k
;
ииk l
}
йй 
[
░░ 
HttpGet
░░ 
]
░░ 
[
▒▒ 
Route
▒▒ 

(
▒▒
 
$str
▒▒ 0
)
▒▒0 1
]
▒▒1 2
public
▓▓ 

Task
▓▓ 
<
▓▓ 
IActionResult
▓▓ 
>
▓▓ (
GetUserTransactionsHistory
▓▓ 9
(
▓▓9 :
Guid
▓▓: >
userId
▓▓? E
)
▓▓E F
{
││ 
return
┤┤ 
Task
┤┤ 
.
┤┤ 

FromResult
┤┤ 
<
┤┤ 
IActionResult
┤┤ ,
>
┤┤, -
(
┤┤- .
Ok
┤┤. 0
(
┤┤0 1$
transactionsRepository
┤┤1 G
.
┤┤G H(
GetUserTransactionsHistory
┤┤H b
(
┤┤b c
userId
┤┤c i
)
┤┤i j
)
┤┤j k
)
┤┤k l
;
┤┤l m
}
╡╡ 
}╢╢ П	
DC:\work\BSUIR\crypto-wallet\Backend\Controllers\ServiceController.cs
	namespace 	
UP
 
. 
Controllers 
; 
[ 
ApiController 
] 
[ 
Produces 	
(	 

$str
 
) 
] 
[ 
Route 
( 
$str 
) 
] 
public		 
class		 
ServiceController		 
(		 
IServiceService		 .
serviceService		/ =
)		= >
:		? @
ControllerBase		A O
{

 
[ 
HttpGet 
] 
public 

async 
Task 
< 
IActionResult #
># $
GetServices% 0
(0 1
)1 2
{ 
var 
users 
= 
await 
serviceService (
.( )
GetServices) 4
(4 5
)5 6
;6 7
return 
Ok 
( 
users 
) 
; 
} 
} л 
BC:\work\BSUIR\crypto-wallet\Backend\Controllers\EmailController.cs
	namespace 	
UP
 
. 
Controllers 
; 
[		 
ApiController		 
]		 
[

 
Route

 
(

 
$str

 
)

 
]

 
public 
class 
EmailController 
: 
ControllerBase -
{ 
private 
readonly 
IEmailService "
_emailService# 0
;0 1
public 

EmailController 
( 
IEmailService (
emailService) 5
)5 6
{ 
_emailService 
= 
emailService $
;$ %
} 
[ 
HttpPost 
( 
$str $
)$ %
]% &
public 

async 
Task 
< 
IActionResult #
># $ 
SendVerificationCode% 9
(9 :'
SendVerificationCodeRequest: U
requestV ]
)] ^
{ 
await 
_emailService 
.  
SendVerificationCode 0
(0 1
request1 8
.8 9
Id9 ;
); <
;< =
return 
Ok 
( 
) 
; 
} 
[%% 
HttpPost%% 
(%% 
$str%% 
)%% 
]%% 
public&& 

async&& 
Task&& 
<&& 
IActionResult&& #
>&&# $
VerifyEmail&&% 0
(&&0 1
[&&1 2
FromBody&&2 :
]&&: ;
VerifyEmailRequest&&< N
request&&O V
)&&V W
{'' 
await(( 
_emailService(( 
.(( 
VerifyEmail(( '
(((' (
request((( /
)((/ 0
;((0 1
return)) 
Ok)) 
()) 
))) 
;)) 
}** 
[11 
HttpPost11 
(11 
$str11 (
)11( )
]11) *
public22 

async22 
Task22 
<22 
IActionResult22 #
>22# $"
ConfirmRestorePassword22% ;
(22; <
[22< =
FromBody22= E
]22E F
VerifyEmailRequest22G Y
request22Z a
)22a b
{33 
await44 
_emailService44 
.44 
VerifyEmail44 '
(44' (
request44( /
)44/ 0
;440 1
return55 
Ok55 
(55 
)55 
;55 
}66 
[== 
	HttpPatch== 
(== 
$str== !
)==! "
]==" #
[>> 
AllowAnonymous>> 
]>> 
public?? 

async?? 
Task?? 
<?? 
IActionResult?? #
>??# $
RestorePassword??% 4
(??4 5
[??5 6
FromBody??6 >
]??> ?"
RestorePasswordRequest??@ V
request??W ^
)??^ _
{@@ 
awaitAA 
_emailServiceAA 
.AA 
RestorePasswordAA +
(AA+ ,
requestAA, 3
)AA3 4
;AA4 5
returnBB 
OkBB 
(BB 
)BB 
;BB 
}CC 
[JJ 
	HttpPatchJJ 
(JJ 
$strJJ #
)JJ# $
]JJ$ %
[KK 
AllowAnonymousKK 
]KK 
publicLL 

asyncLL 
TaskLL 
<LL 
IActionResultLL #
>LL# $
SendMessageLL% 0
(LL0 1
[LL1 2
FromBodyLL2 :
]LL: ;
SendMessageRequestLL< N
requestLLO V
)LLV W
{MM 
awaitNN 
_emailServiceNN 
.NN 
SendMessageBlockNN ,
(NN, -
requestNN- 4
)NN4 5
;NN5 6
returnOO 
OkOO 
(OO 
)OO 
;OO 
}PP 
}QQ хм
FC:\work\BSUIR\crypto-wallet\Backend\Controllers\Currency╨бontroller.cs
	namespace

 	
UP


 
.

 
Controllers

 
;

 
[ 
ApiController 
] 
[ 
Route 
( 
$str 
) 
] 
public 
class 
CurrencyController 
:  !
ControllerBase" 0
{ 
private 
readonly 
ICurrencyRepository (
_currencyRepository) <
;< =
private 
readonly 
ILogger 
< 
CurrencyController /
>/ 0
_logger1 8
;8 9
private 
readonly 
IUserRepository $
_userRepository% 4
;4 5
private 
readonly 
IDbRepository "
_dbRepository# 0
;0 1
public 

CurrencyController 
( 
ILogger %
<% &
CurrencyController& 8
>8 9
logger: @
,@ A
IUserRepositoryB Q
userRepositoryR `
,` a
ICurrencyRepository 
currencyRepository .
,. /
IDbRepository0 =
dbRepository> J
)J K
{ 
_logger 
= 
logger 
; 
_userRepository 
= 
userRepository (
;( )
_currencyRepository 
= 
currencyRepository 0
;0 1
_dbRepository 
= 
dbRepository $
;$ %
} 
[&& 
HttpGet&& 
]&& 
['' 
Route'' 

(''
 
$str'' 
)'' 
]'' 
public(( 

Task(( 
<(( 
ActionResult(( 
>(( 
GetUserCoins(( *
(((* +
Guid((+ /
userId((0 6
)((6 7
{)) 
_logger** 
.** 
LogInformation** 
(** 
$"** !
$str**! ;
{**; <
userId**< B
}**B C
"**C D
)**D E
;**E F
return++ 
Task++ 
.++ 

FromResult++ 
<++ 
ActionResult++ +
>+++ ,
(++, -
Ok++- /
(++/ 0
_userRepository++0 ?
.++? @
GetUserCoins++@ L
(++L M
userId++M S
)++S T
)++T U
)++U V
;++V W
},, 
[33 
HttpGet33 
]33 
[44 
Route44 

(44
 
$str44 
)44 
]44 
public55 

async55 
Task55 
<55 
IActionResult55 #
>55# $
GetUserCoinsFull55% 5
(555 6
Guid556 :
userId55; A
)55A B
{66 
return77 
Ok77 
(77 
await77 
_userRepository77 '
.77' (
GetUserCoinsFull77( 8
(778 9
userId779 ?
)77? @
)77@ A
;77A B
}88 
[BB 
HttpGetBB 
]BB 
[CC 
RouteCC 

(CC
 
$strCC '
)CC' (
]CC( )
publicDD 

asyncDD 
TaskDD 
<DD 
IActionResultDD #
>DD# $&
GetQuantityAfterConversionDD% ?
(DD? @
stringDD@ F
shortNameStartDDG U
,DDU V
stringDDW ]
shortNameFinalDD^ l
,DDl m
doubleEE 
quantityEE 
,EE 
GuidEE 
userIdEE $
)EE$ %
{FF 
tryGG 
{HH 	
_loggerII 
.II 
LogInformationII "
(II" #
$strII# *
+II+ ,
userIdII- 3
+II4 5
$strII6 B
+IIC D
quantityIIE M
+IIN O
$strIIP S
+IIT U
shortNameStartIIV d
+IIe f
$strIIg m
+IIn o
shortNameFinalJJ# 1
)JJ1 2
;JJ2 3
varKK 
apiKeyKK 
=KK 
$strKK [
;KK[ \
usingLL 
varLL 

httpClientLL  
=LL! "
newLL# &

HttpClientLL' 1
(LL1 2
)LL2 3
;LL3 4

httpClientMM 
.MM !
DefaultRequestHeadersMM ,
.MM, -
AddMM- 0
(MM0 1
$strMM1 ?
,MM? @
apiKeyMMA G
)MMG H
;MMH I
varNN 
urlNN 
=NN 
$strNN J
+NNK L
shortNameStartNNM [
+NN\ ]
$strNN^ g
+NNh i
shortNameFinalOO $
;OO$ %
varPP 
responsePP 
=PP 
awaitPP  

httpClientPP! +
.PP+ ,
GetAsyncPP, 4
(PP4 5
urlPP5 8
)PP8 9
;PP9 :
varQQ 
responseContentQQ 
=QQ  !
awaitQQ" '
responseQQ( 0
.QQ0 1
ContentQQ1 8
.QQ8 9
ReadAsStringAsyncQQ9 J
(QQJ K
)QQK L
;QQL M
varRR 
jsonRR 
=RR 
JObjectRR 
.RR 
ParseRR $
(RR$ %
responseContentRR% 4
)RR4 5
;RR5 6
varSS 

priceRatioSS 
=SS 
(SS 
doubleSS $
)SS$ %
jsonSS% )
[SS) *
shortNameFinalSS* 8
.SS8 9
ToUpperSS9 @
(SS@ A
)SSA B
]SSB C
;SSC D
varTT 
finalQuantityTT 
=TT 

priceRatioTT  *
*TT+ ,
quantityTT- 5
;TT5 6
returnUU 
OkUU 
(UU 
finalQuantityUU #
)UU# $
;UU$ %
}VV 	
catchWW 
(WW 
	ExceptionWW 
eWW 
)WW 
{XX 	
_loggerYY 
.YY 
LogInformationYY "
(YY" #
$strYY# N
)YYN O
;YYO P
returnZZ 

BadRequestZZ 
(ZZ 
$strZZ <
)ZZ< =
;ZZ= >
}[[ 	
}\\ 
[cc 
HttpGetcc 
]cc 
[dd 
Routedd 

(dd
 
$strdd 
)dd 
]dd 
publicee 

asyncee 
Taskee 
<ee 
ActionResultee "
>ee" #
GetUserBalanceee$ 2
(ee2 3
Guidee3 7
userIdee8 >
)ee> ?
{ff 
trygg 
{hh 	
varii 
balanceii 
=ii 
awaitii 
_currencyRepositoryii  3
.ii3 4
GetUserBalanceii4 B
(iiB C
userIdiiC I
)iiI J
;iiJ K
returnjj 
Okjj 
(jj 
balancejj 
)jj 
;jj 
}kk 	
catchll 
(ll 
	Exceptionll 
ell 
)ll 
{mm 	
returnnn 

BadRequestnn 
(nn 
$strnn F
)nnF G
;nnG H
}oo 	
}pp 
[xx 
HttpGetxx 
]xx 
[yy 
Routeyy 

(yy
 
$stryy (
)yy( )
]yy) *
publiczz 

Taskzz 
<zz 
ActionResultzz 
>zz '
GetCoinQuantityInUserWalletzz 9
(zz9 :
Guidzz: >
userIdzz? E
,zzE F
stringzzG M
coinNamezzN V
)zzV W
{{{ 
try|| 
{}} 	
var~~ 
quantity~~ 
=~~ 
_userRepository~~ *
.~~* +'
GetCoinQuantityInUserWallet~~+ F
(~~F G
userId~~G M
,~~M N
coinName~~O W
)~~W X
;~~X Y
return 
Task 
. 

FromResult "
<" #
ActionResult# /
>/ 0
(0 1
Ok1 3
(3 4
quantity4 <
)< =
)= >
;> ?
}
АА 	
catch
ББ 
(
ББ 
	Exception
ББ 
e
ББ 
)
ББ 
{
ВВ 	
return
ГГ 
Task
ГГ 
.
ГГ 

FromResult
ГГ "
<
ГГ" #
ActionResult
ГГ# /
>
ГГ/ 0
(
ГГ0 1

BadRequest
ГГ1 ;
(
ГГ; <
$str
ГГ< a
)
ГГa b
)
ГГb c
;
ГГc d
}
ДД 	
}
ЕЕ 
[
НН 
HttpGet
НН 
]
НН 
[
ОО 
Route
ОО 

(
ОО
 
$str
ОО 
)
ОО 
]
ОО 
public
ПП 

async
ПП 
Task
ПП 
<
ПП 
ActionResult
ПП "
>
ПП" #
GetCoinPrice
ПП$ 0
(
ПП0 1
double
ПП1 7
quantity
ПП8 @
,
ПП@ A
string
ППB H
coinName
ППI Q
)
ППQ R
{
РР 
try
СС 
{
ТТ 	
var
УУ 
price
УУ 
=
УУ 
await
УУ !
_currencyRepository
УУ 1
.
УУ1 2
GetCoinPrice
УУ2 >
(
УУ> ?
quantity
УУ? G
,
УУG H
coinName
УУI Q
)
УУQ R
;
УУR S
return
ФФ 
Ok
ФФ 
(
ФФ 
price
ФФ 
)
ФФ 
;
ФФ 
}
ХХ 	
catch
ЦЦ 
(
ЦЦ 
	Exception
ЦЦ 
e
ЦЦ 
)
ЦЦ 
{
ЧЧ 	
return
ШШ 

BadRequest
ШШ 
(
ШШ 
$str
ШШ 7
)
ШШ7 8
;
ШШ8 9
}
ЩЩ 	
}
ЪЪ 
[
бб 
HttpGet
бб 
]
бб 
[
вв 
Route
вв 

(
вв
 
$str
вв /
)
вв/ 0
]
вв0 1
public
гг 

async
гг 
Task
гг 
<
гг 
ActionResult
гг "
>
гг" #
GetCoinRatio
гг$ 0
(
гг0 1
string
гг1 7
	shortName
гг8 A
)
ггA B
{
дд 
var
ее 
coinSnapShots
ее 
=
ее 
await
ее !
_dbRepository
ее" /
.
ее/ 0
Get
ее0 3
<
ее3 4"
CryptoCurrencyPrices
ее4 H
>
ееH I
(
ееI J
)
ееJ K
.
жж 
Where
жж 
(
жж 
c
жж 
=>
жж 
c
жж 
.
жж 
CoinShortName
жж '
==
жж( *
	shortName
жж+ 4
)
жж4 5
.
зз 
Select
зз 
(
зз 
s
зз 
=>
зз 
s
зз 
.
зз 
Price
зз  
)
зз  !
.
ии 
ToListAsync
ии 
(
ии 
)
ии 
;
ии 
if
кк 

(
кк 
coinSnapShots
кк 
==
кк 
null
кк !
||
кк" $
coinSnapShots
кк% 2
.
кк2 3
Count
кк3 8
==
кк9 ;
$num
кк< =
)
кк= >
throw
лл 
new
лл %
EntityNotFoundException
лл -
(
лл- .
$"
лл. 0
$str
лл0 E
{
ллE F
	shortName
ллF O
}
ллO P
$str
ллP [
"
лл[ \
)
лл\ ]
;
лл] ^
var
нн 
result
нн 
=
нн 
AnalyzePrices
нн "
(
нн" #
coinSnapShots
нн# 0
)
нн0 1
;
нн1 2
return
пп 
Ok
пп 
(
пп 
result
пп 
)
пп 
;
пп 
}
░░ 
private
▓▓ 
static
▓▓ 
List
▓▓ 
<
▓▓ 
double
▓▓ 
>
▓▓ 
AnalyzePrices
▓▓  -
(
▓▓- .
IReadOnlyList
▓▓. ;
<
▓▓; <
double
▓▓< B
>
▓▓B C
prices
▓▓D J
)
▓▓J K
{
││ 
List
┤┤ 
<
┤┤ 
double
┤┤ 
>
┤┤ 
result
┤┤ 
=
┤┤ 
[
┤┤ 
]
┤┤  
;
┤┤  !
switch
╢╢ 
(
╢╢ 
prices
╢╢ 
.
╢╢ 
Count
╢╢ 
)
╢╢ 
{
╖╖ 	
case
╕╕ 
$num
╕╕ 
:
╕╕ 
return
╣╣ 
result
╣╣ 
;
╣╣ 
case
║║ 
$num
║║ 
:
║║ 
result
╗╗ 
.
╗╗ 
Add
╗╗ 
(
╗╗ 
prices
╗╗ !
[
╗╗! "
$num
╗╗" #
]
╗╗# $
)
╗╗$ %
;
╗╗% &
return
╝╝ 
result
╝╝ 
;
╝╝ 
}
╜╜ 	
var
┐┐ 
changes
┐┐ 
=
┐┐ 
new
┐┐ 
List
┐┐ 
<
┐┐ 
double
┐┐ %
>
┐┐% &
(
┐┐& '
)
┐┐' (
;
┐┐( )
for
└└ 
(
└└ 
var
└└ 
i
└└ 
=
└└ 
$num
└└ 
;
└└ 
i
└└ 
<
└└ 
prices
└└ "
.
└└" #
Count
└└# (
;
└└( )
i
└└* +
++
└└+ -
)
└└- .
{
┴┴ 	
changes
┬┬ 
.
┬┬ 
Add
┬┬ 
(
┬┬ 
prices
┬┬ 
[
┬┬ 
i
┬┬  
]
┬┬  !
-
┬┬" #
prices
┬┬$ *
[
┬┬* +
i
┬┬+ ,
-
┬┬- .
$num
┬┬/ 0
]
┬┬0 1
)
┬┬1 2
;
┬┬2 3
}
├├ 	
var
┼┼ 
interval
┼┼ 
=
┼┼ 
Math
┼┼ 
.
┼┼ 
Max
┼┼ 
(
┼┼  
$num
┼┼  !
,
┼┼! "
changes
┼┼# *
.
┼┼* +
Count
┼┼+ 0
/
┼┼1 2
$num
┼┼3 5
)
┼┼5 6
;
┼┼6 7
for
╞╞ 
(
╞╞ 
var
╞╞ 
i
╞╞ 
=
╞╞ 
$num
╞╞ 
;
╞╞ 
i
╞╞ 
<
╞╞ 
changes
╞╞ #
.
╞╞# $
Count
╞╞$ )
;
╞╞) *
i
╞╞+ ,
+=
╞╞- /
interval
╞╞0 8
)
╞╞8 9
{
╟╟ 	
var
╚╚ 
value
╚╚ 
=
╚╚ 
prices
╚╚ 
[
╚╚ 
i
╚╚  
]
╚╚  !
;
╚╚! "
if
╔╔ 
(
╔╔ 
changes
╔╔ 
[
╔╔ 
i
╔╔ 
]
╔╔ 
>
╔╔ 
$num
╔╔ 
)
╔╔ 
result
╩╩ 
.
╩╩ 
Add
╩╩ 
(
╩╩ 
value
╩╩  
)
╩╩  !
;
╩╩! "
else
╦╦ 
{
╠╠ 
result
══ 
.
══ 
Add
══ 
(
══ 
i
══ 
>
══ 
$num
══  
?
══! "
prices
══# )
[
══) *
i
══* +
-
══, -
$num
══. /
]
══/ 0
:
══1 2
value
══3 8
)
══8 9
;
══9 :
}
╬╬ 
}
╧╧ 	
return
╤╤ 
result
╤╤ 
;
╤╤ 
}
╥╥ 
[
╪╪ 
HttpGet
╪╪ 
]
╪╪ 
[
┘┘ 
Route
┘┘ 

(
┘┘
 
$str
┘┘ 
)
┘┘ 
]
┘┘  
public
┌┌ 

async
┌┌ 
Task
┌┌ 
<
┌┌ 
ActionResult
┌┌ "
>
┌┌" #
GetCoinsList
┌┌$ 0
(
┌┌0 1
)
┌┌1 2
{
██ 
var
▄▄ 
	coinsList
▄▄ 
=
▄▄ 
await
▄▄ 
_dbRepository
▄▄ +
.
▄▄+ ,
Get
▄▄, /
<
▄▄/ 0
CoinListInfo
▄▄0 <
>
▄▄< =
(
▄▄= >
)
▄▄> ?
.
▌▌ 
Where
▌▌ 
(
▌▌ 
x
▌▌ 
=>
▌▌ 
x
▌▌ 
.
▌▌ 
IsActive
▌▌ "
==
▌▌# %
true
▌▌& *
)
▌▌* +
.
▐▐ 
ToListAsync
▐▐ 
(
▐▐ 
)
▐▐ 
;
▐▐ 
var
рр 
cryptoDictionary
рр 
=
рр 
	coinsList
рр (
.
рр( )
ToDictionary
рр) 5
(
рр5 6
coin
сс 
=>
сс 
coin
сс 
.
сс 
	ShortName
сс "
.
сс" #
ToLower
сс# *
(
сс* +
)
сс+ ,
,
сс, -
coin
тт 
=>
тт 
coin
тт 
.
тт 
FullName
тт !
.
тт! "
ToLower
тт" )
(
тт) *
)
тт* +
)
уу 	
;
уу	 

var
фф 
coins
фф 
=
фф 
new
фф 
List
фф 
<
фф 
CoinsInformation
фф -
>
фф- .
(
фф. /
)
фф/ 0
;
фф0 1
foreach
хх 
(
хх 
var
хх 
key
хх 
in
хх 
cryptoDictionary
хх ,
.
хх, -
Keys
хх- 1
)
хх1 2
{
цц 	
var
чч 
temp
чч 
=
чч 
await
чч !
_currencyRepository
чч 0
.
чч0 1$
GetFullCoinInformation
чч1 G
(
ччG H
key
ччH K
)
ччK L
;
ччL M
coins
шш 
.
шш 
Add
шш 
(
шш 
new
шш 
CoinsInformation
шш *
{
щщ 
Id
ъъ 
=
ъъ 
temp
ъъ 
.
ъъ 
Id
ъъ 
,
ъъ 
	ShortName
ыы 
=
ыы 
temp
ыы  
.
ыы  !
	ShortName
ыы! *
,
ыы* +
FullName
ьь 
=
ьь 
temp
ьь 
.
ьь  
FullName
ьь  (
,
ьь( )
IconPath
ээ 
=
ээ 
temp
ээ 
.
ээ  
IconPath
ээ  (
,
ээ( )
DailyVolume
юю 
=
юю 
temp
юю "
.
юю" #
DailyVolume
юю# .
,
юю. /
DailyImpact
яя 
=
яя 
temp
яя "
.
яя" #
DailyImpact
яя# .
,
яя. /
Price
ЁЁ 
=
ЁЁ 
temp
ЁЁ 
.
ЁЁ 
Price
ЁЁ "
,
ЁЁ" #)
PercentagePriceChangePerDay
ёё +
=
ёё, -
temp
ёё. 2
.
ёё2 3)
PercentagePriceChangePerDay
ёё3 N
,
ёёN O
Quantity
ЄЄ 
=
ЄЄ 
temp
ЄЄ 
.
ЄЄ  
Quantity
ЄЄ  (
}
єє 
)
єє 
;
єє 
var
її 
coin
її 
=
її 
await
її 
_dbRepository
її *
.
її* +
Get
її+ .
<
її. /
CoinListInfo
її/ ;
>
її; <
(
її< =
)
її= >
.
ЎЎ !
FirstOrDefaultAsync
ЎЎ $
(
ЎЎ$ %
c
ЎЎ% &
=>
ЎЎ' )
c
ЎЎ* +
.
ЎЎ+ ,
	ShortName
ЎЎ, 5
.
ЎЎ5 6
ToLower
ЎЎ6 =
(
ЎЎ= >
)
ЎЎ> ?
==
ЎЎ@ B
temp
ЎЎC G
.
ЎЎG H
FullName
ЎЎH P
.
ЎЎP Q
ToLower
ЎЎQ X
(
ЎЎX Y
)
ЎЎY Z
)
ЎЎZ [
;
ЎЎ[ \
if
ўў 
(
ўў 
coin
ўў 
==
ўў 
null
ўў 
)
ўў 
throw
°° 
new
°° %
EntityNotFoundException
°° 1
(
°°1 2
$"
°°2 4
$str
°°4 I
{
°°I J
temp
°°J N
.
°°N O
FullName
°°O W
}
°°W X
$str
°°X c
"
°°c d
)
°°d e
;
°°e f
var
·· 
currentTime
·· 
=
·· 
DateTime
·· &
.
··& '
UtcNow
··' -
;
··- .
var
√√ 
tenMinutesAgo
√√ 
=
√√ 
currentTime
√√  +
.
√√+ ,

AddMinutes
√√, 6
(
√√6 7
-
√√7 8
$num
√√8 9
)
√√9 :
;
√√: ;
var
¤¤ 
existingPrice
¤¤ 
=
¤¤ 
_dbRepository
¤¤  -
.
¤¤- .
Get
¤¤. 1
<
¤¤1 2"
CryptoCurrencyPrices
¤¤2 F
>
¤¤F G
(
¤¤G H
)
¤¤H I
.
■■ 
FirstOrDefault
■■ 
(
■■  
p
■■  !
=>
■■" $
p
■■% &
.
■■& '
CoinId
■■' -
==
■■. 0
coin
■■1 5
.
■■5 6
Id
■■6 8
&&
■■9 ;
p
■■< =
.
■■= >
	Timestamp
■■> G
>=
■■H J
tenMinutesAgo
■■K X
)
■■X Y
;
■■Y Z
if
АА 
(
АА 
existingPrice
АА 
!=
АА  
null
АА! %
)
АА% &
continue
АА' /
;
АА/ 0
var
ББ 
newPrice
ББ 
=
ББ 
new
ББ "
CryptoCurrencyPrices
ББ 3
{
ВВ 
Id
ГГ 
=
ГГ 
Guid
ГГ 
.
ГГ 
NewGuid
ГГ !
(
ГГ! "
)
ГГ" #
,
ГГ# $
CoinShortName
ДД 
=
ДД 
temp
ДД  $
.
ДД$ %
FullName
ДД% -
,
ДД- .
Price
ЕЕ 
=
ЕЕ 
temp
ЕЕ 
.
ЕЕ 
Price
ЕЕ "
,
ЕЕ" #
	Timestamp
ЖЖ 
=
ЖЖ 
currentTime
ЖЖ '
,
ЖЖ' (
CoinId
ЗЗ 
=
ЗЗ 
coin
ЗЗ 
.
ЗЗ 
Id
ЗЗ  
}
ИИ 
;
ИИ 
await
ЙЙ 
_dbRepository
ЙЙ 
.
ЙЙ  
Add
ЙЙ  #
(
ЙЙ# $
newPrice
ЙЙ$ ,
)
ЙЙ, -
;
ЙЙ- .
}
КК 	
await
ЛЛ 
_dbRepository
ЛЛ 
.
ЛЛ 
SaveChangesAsync
ЛЛ ,
(
ЛЛ, -
)
ЛЛ- .
;
ЛЛ. /
return
ММ 
Ok
ММ 
(
ММ 
coins
ММ 
)
ММ 
;
ММ 
}
НН 
}ОО ёJ
JC:\work\BSUIR\crypto-wallet\Backend\Controllers\AuthorizationController.cs
	namespace 	
UP
 
. 
Controllers 
; 
[ 
ApiController 
] 
[ 
Route 
( 
$str 
) 
] 
public 
class #
AuthorizationController $
:% &
ControllerBase' 5
{ 
private 
readonly 
IDbRepository "
_dbRepository# 0
;0 1
private 
readonly 
IHashHelpers !
_hashHelpers" .
;. /
public 
#
AuthorizationController "
(" #
IDbRepository 
dbRepository "
," #
IHashHelpers 
hashHelpers  
)  !
{ 
_dbRepository 
= 
dbRepository $
;$ %
_hashHelpers 
= 
hashHelpers "
;" #
} 
[## 
HttpPost## 
]## 
[$$ 
Route$$ 

($$
 
$str$$ 
)$$ 
]$$ 
public%% 

async%% 
Task%% 
<%% 
IActionResult%% #
>%%# $
Login%%% *
(%%* +
[%%+ ,
FromBody%%, 4
]%%4 5!
AuthenticationRequest%%6 K
request%%L S
)%%S T
{&& 
var'' 
users'' 
='' 
await'' 
_dbRepository'' '
.''' (
Get''( +
<''+ ,
User'', 0
>''0 1
(''1 2
)''2 3
.(( 
Where(( 
((( 
x(( 
=>(( 
x(( 
.(( 
Login(( 
==((  "
request((# *
.((* +
Login((+ 0
)((0 1
.)) 
ToListAsync)) 
()) 
))) 
;)) 
var++ 
user++ 
=++ 
users++ 
.++ 
FirstOrDefault++ '
(++' (
x++( )
=>++* ,
x++- .
.++. /
Password++/ 7
==++8 :
HashHandler++; F
.++F G
HashPassword++G S
(++S T
request++T [
.++[ \
Password++\ d
,++d e
x++f g
.++g h
Salt++h l
)++l m
)++m n
;++n o
if-- 

(-- 
user-- 
==-- 
null-- 
)-- 
throw-- 
new--  ##
EntityNotFoundException--$ ;
(--; <
$str--< T
)--T U
;--U V
if// 

(// 
user// 
.// 
	IsBlocked// 
)// 
throw00 
new00 #
EntityNotFoundException00 -
(00- .
$str00. H
)00H I
;00I J
var22 
record22 
=22 
new22 
LoginHistory22 %
{33 	
Id44 
=44 
Guid44 
.44 
NewGuid44 
(44 
)44 
,44  
UserId55 
=55 
user55 
.55 
Id55 
,55 
DateCreated66 
=66 
DateTime66 "
.66" #
UtcNow66# )
,66) *
	IPAddress77 
=77 
LoginHistory77 $
.77$ %
GetIPAddress77% 1
(771 2
)772 3
}88 	
;88	 

await99 
_dbRepository99 
.99 
Add99 
(99  
record99  &
)99& '
;99' (
await:: 
_dbRepository:: 
.:: 
SaveChangesAsync:: ,
(::, -
)::- .
;::. /
return<< 
Ok<< 
(<< 
user<< 
)<< 
;<< 
}== 
[FF 
HttpPostFF 
]FF 
[GG 
RouteGG 

(GG
 
$strGG 
)GG 
]GG 
publicHH 

asyncHH 
TaskHH 
<HH 
IActionResultHH #
>HH# $
RegisterNewUserHH% 4
(HH4 5
[HH5 6
FromBodyHH6 >
]HH> ?
RegisterRequestHH@ O
requestHHP W
)HHW X
{II 
ifJJ 

(JJ 
requestJJ 
.JJ 
LoginJJ 
==JJ 
nullJJ !
||JJ" $
requestJJ% ,
.JJ, -
PasswordJJ- 5
==JJ6 8
nullJJ9 =
||JJ> @
requestJJA H
.JJH I
EmailJJI N
==JJO Q
nullJJR V
)JJV W
throwKK 
newKK "
IncorrectDataExceptionKK ,
(KK, -
$strKK- A
)KKA B
;KKB C
switchLL 
(LL 
requestLL 
.LL 
LoginLL 
.LL 
LengthLL $
)LL$ %
{MM 	
caseNN 
>NN 
$numNN 
:NN 
throwOO 
newOO "
IncorrectDataExceptionOO 0
(OO0 1
$strOO1 W
)OOW X
;OOX Y
casePP 
<PP 
$numPP 
:PP 
throwQQ 
newQQ "
IncorrectDataExceptionQQ 0
(QQ0 1
$strQQ1 W
)QQW X
;QQX Y
}RR 	
switchTT 
(TT 
requestTT 
.TT 
PasswordTT  
.TT  !
LengthTT! '
)TT' (
{UU 	
caseVV 
>VV 
$numVV 
:VV 
throwWW 
newWW "
IncorrectDataExceptionWW 0
(WW0 1
$strWW1 X
)WWX Y
;WWY Z
caseXX 
<XX 
$numXX 
:XX 
throwYY 
newYY "
IncorrectDataExceptionYY 0
(YY0 1
$strYY1 X
)YYX Y
;YYY Z
}ZZ 	
if\\ 

(\\ 
!\\ 
IsEmailValid\\ 
(\\ 
request\\ !
.\\! "
Email\\" '
)\\' (
)\\( )
throw\\* /
new\\0 3"
IncorrectDataException\\4 J
(\\J K
$str\\K b
)\\b c
;\\c d
if]] 

(]] 
await]] 
_dbRepository]] 
.]]  
Get]]  #
<]]# $
User]]$ (
>]]( )
(]]) *
)]]* +
.]]+ ,
FirstOrDefaultAsync]], ?
(]]? @
x]]@ A
=>]]B D
x]]E F
.]]F G
Email]]G L
==]]M O
request]]P W
.]]W X
Email]]X ]
)]]] ^
!=]]_ a
null]]b f
)]]f g
throw^^ 
new^^ "
IncorrectDataException^^ ,
(^^, -
$str^^- E
)^^E F
;^^F G
if__ 

(__ 
await__ 
_dbRepository__ 
.__  
Get__  #
<__# $
User__$ (
>__( )
(__) *
)__* +
.__+ ,
FirstOrDefaultAsync__, ?
(__? @
x__@ A
=>__B D
x__E F
.__F G
Login__G L
==__M O
request__P W
.__W X
Login__X ]
)__] ^
!=___ a
null__b f
)__f g
throw`` 
new`` "
IncorrectDataException`` ,
(``, -
$str``- E
)``E F
;``F G
varbb 
saltbb 
=bb 
_hashHelpersbb 
.bb  
GenerateSaltbb  ,
(bb, -
$numbb- /
)bb/ 0
;bb0 1
varcc 
entitycc 
=cc 
newcc 
Usercc 
{dd 	
Loginee 
=ee 
requestee 
.ee 
Loginee !
,ee! "
Passwordff 
=ff 
_hashHelpersff #
.ff# $
HashPasswordff$ 0
(ff0 1
requestff1 8
.ff8 9
Passwordff9 A
,ffA B
saltffC G
)ffG H
,ffH I
Emailgg 
=gg 
requestgg 
.gg 
Emailgg !
,gg! "
DateCreatedhh 
=hh 
DateTimehh "
.hh" #
UtcNowhh# )
,hh) *
	IsDeletedii 
=ii 
falseii 
,ii 
	IsBlockedjj 
=jj 
falsejj 
,jj 
RoleIdkk 
=kk 
$numkk 
,kk 
Saltll 
=ll 
saltll 
}mm 	
;mm	 

awaitnn 
_dbRepositorynn 
.nn 
Addnn 
(nn  
entitynn  &
)nn& '
;nn' (
awaitoo 
_dbRepositoryoo 
.oo 
SaveChangesAsyncoo ,
(oo, -
)oo- .
;oo. /
returnqq 
Okqq 
(qq 
$strqq *
)qq* +
;qq+ ,
boolss 
IsEmailValidss 
(ss 
stringss  
emailss! &
)ss& '
{tt 	
constuu 
stringuu 
regexuu 
=uu  
$struu! H
;uuH I
returnvv 
Regexvv 
.vv 
IsMatchvv  
(vv  !
emailvv! &
,vv& '
regexvv( -
,vv- .
RegexOptionsvv/ ;
.vv; <

IgnoreCasevv< F
)vvF G
;vvG H
}ww 	
}xx 
}yy ┼q
BC:\work\BSUIR\crypto-wallet\Backend\Controllers\AdminController.cs
	namespace

 	
UP


 
.

 
Controllers

 
;

 
[ 
ApiController 
] 
[ 
Route 
( 
$str 
) 
] 
public 
class 
AdminController 
: 
ControllerBase -
{ 
private 
readonly 
IDbRepository "
_dbRepository# 0
;0 1
private 
readonly 
IAuthService !
_authService" .
;. /
public 

AdminController 
( 
IDbRepository (
dbRepository) 5
,5 6
IAuthService7 C
authServiceD O
)O P
{ 
_dbRepository 
= 
dbRepository $
;$ %
_authService 
= 
authService "
;" #
} 
['' 
HttpPost'' 
('' 
$str'' 
)'' 
]'' 
public)) 

async)) 
Task)) 
<)) 
ActionResult)) "
>))" #
	BlockUser))$ -
())- .
Guid)). 2
id))3 5
,))5 6
string))7 =
reason))> D
)))D E
{** 
var++ 
existingUser++ 
=++ 
await++  
_dbRepository++! .
.++. /
Get++/ 2
<++2 3
User++3 7
>++7 8
(++8 9
)++9 :
.++: ;
FirstOrDefaultAsync++; N
(++N O
x++O P
=>++Q S
x++T U
.++U V
Id++V X
==++Y [
id++\ ^
)++^ _
;++_ `
if,, 

(,, 
existingUser,, 
==,, 
null,,  
),,  !
throw-- 
new-- #
EntityNotFoundException-- -
(--- .
$str--. >
)--> ?
;--? @
existingUser// 
.// 
	IsBlocked// 
=//  
true//! %
;//% &
await11 
_dbRepository11 
.11 
SaveChangesAsync11 ,
(11, -
)11- .
;11. /
return22 
Ok22 
(22 
$str22 -
)22- .
;22. /
}33 
[:: 
HttpPost:: 
(:: 
$str:: 
):: 
]:: 
public;; 

async;; 
Task;; 
<;; 
ActionResult;; "
>;;" #

DeleteUser;;$ .
(;;. /
Guid;;/ 3
id;;4 6
);;6 7
{<< 
var== 
existingUser== 
=== 
await==  
_dbRepository==! .
.==. /
Get==/ 2
<==2 3
User==3 7
>==7 8
(==8 9
)==9 :
.==: ;
FirstOrDefaultAsync==; N
(==N O
x==O P
=>==Q S
x==T U
.==U V
Id==V X
====Y [
id==\ ^
)==^ _
;==_ `
if>> 

(>> 
existingUser>> 
==>> 
null>>  
)>>  !
throw?? 
new?? #
EntityNotFoundException?? -
(??- .
$str??. >
)??> ?
;??? @
existingUserAA 
.AA 
	IsDeletedAA 
=AA  
trueAA! %
;AA% &
awaitCC 
_dbRepositoryCC 
.CC 
SaveChangesAsyncCC ,
(CC, -
)CC- .
;CC. /
returnDD 
OkDD 
(DD 
$strDD '
)DD' (
;DD( )
}EE 
[MM 
HttpPutMM 
(MM 
$strMM 
)MM 
]MM 
publicNN 

asyncNN 
TaskNN 
<NN 
IActionResultNN #
>NN# $
SetStatusDelNN% 1
(NN1 2
GuidNN2 6
idNN7 9
,NN9 :
boolNN; ?
statusNN@ F
)NNF G
{OO 
varPP 
existingUserPP 
=PP 
awaitPP  
_dbRepositoryPP! .
.PP. /
GetPP/ 2
<PP2 3
UserPP3 7
>PP7 8
(PP8 9
)PP9 :
.PP: ;
FirstOrDefaultAsyncPP; N
(PPN O
xPPO P
=>PPQ S
xPPT U
.PPU V
IdPPV X
==PPY [
idPP\ ^
)PP^ _
;PP_ `
ifQQ 

(QQ 
existingUserQQ 
==QQ 
nullQQ  
)QQ  !
throwRR 
newRR #
EntityNotFoundExceptionRR -
(RR- .
$strRR. >
)RR> ?
;RR? @
existingUserTT 
.TT 
	IsDeletedTT 
=TT  
statusTT! '
;TT' (
awaitVV 
_dbRepositoryVV 
.VV 
SaveChangesAsyncVV ,
(VV, -
)VV- .
;VV. /
returnWW 
OkWW 
(WW 
$strWW -
)WW- .
;WW. /
}XX 
[`` 
HttpPut`` 
(`` 
$str`` 
)`` 
]`` 
publicaa 

asyncaa 
Taskaa 
<aa 
IActionResultaa #
>aa# $
SetStatusBlockaa% 3
(aa3 4
Guidaa4 8
idaa9 ;
,aa; <
boolaa= A
statusaaB H
)aaH I
{bb 
varcc 
existingUsercc 
=cc 
awaitcc  
_dbRepositorycc! .
.cc. /
Getcc/ 2
<cc2 3
Usercc3 7
>cc7 8
(cc8 9
)cc9 :
.cc: ;
FirstOrDefaultAsynccc; N
(ccN O
xccO P
=>ccQ S
xccT U
.ccU V
IdccV X
==ccY [
idcc\ ^
)cc^ _
;cc_ `
ifdd 

(dd 
existingUserdd 
==dd 
nulldd  
)dd  !
throwee 
newee #
EntityNotFoundExceptionee -
(ee- .
$stree. >
)ee> ?
;ee? @
existingUsergg 
.gg 
	IsBlockedgg 
=gg  
statusgg! '
;gg' (
awaithh 
_dbRepositoryhh 
.hh 
SaveChangesAsynchh ,
(hh, -
)hh- .
;hh. /
returnjj 
Okjj 
(jj 
$strjj -
)jj- .
;jj. /
}kk 
[qq 
	Authorizeqq 
]qq 
[rr 
HttpGetrr 
(rr 
$strrr 
)rr 
]rr 
publicss 

Taskss 
<ss 
ActionResultss 
>ss 
GetUserListss )
(ss) *
)ss* +
{tt 
varuu 
usersuu 
=uu 
_dbRepositoryuu !
.uu! "
Getuu" %
<uu% &
Useruu& *
>uu* +
(uu+ ,
)uu, -
.uu- .
ToListuu. 4
(uu4 5
)uu5 6
;uu6 7
ifvv 

(vv 
usersvv 
==vv 
nullvv 
)vv 
throwww 
newww #
EntityNotFoundExceptionww -
(ww- .
$strww. ?
)ww? @
;ww@ A
returnyy 
Taskyy 
.yy 

FromResultyy 
<yy 
ActionResultyy +
>yy+ ,
(yy, -
Okyy- /
(yy/ 0
usersyy0 5
)yy5 6
)yy6 7
;yy7 8
}zz 
[
ББ 
HttpGet
ББ 
(
ББ 
$str
ББ 
)
ББ 
]
ББ 
public
ВВ 

Task
ВВ 
<
ВВ 
IActionResult
ВВ 
>
ВВ 
GetUserById
ВВ *
(
ВВ* +
Guid
ВВ+ /
id
ВВ0 2
)
ВВ2 3
{
ГГ 
var
ДД 
users
ДД 
=
ДД 
_dbRepository
ДД !
.
ДД! "
Get
ДД" %
<
ДД% &
User
ДД& *
>
ДД* +
(
ДД+ ,
)
ДД, -
.
ДД- .!
FirstOrDefaultAsync
ДД. A
(
ДДA B
x
ДДB C
=>
ДДD F
x
ДДG H
.
ДДH I
Id
ДДI K
==
ДДL N
id
ДДO Q
)
ДДQ R
;
ДДR S
if
ЕЕ 

(
ЕЕ 
users
ЕЕ 
==
ЕЕ 
null
ЕЕ 
)
ЕЕ 
throw
ЖЖ 
new
ЖЖ %
EntityNotFoundException
ЖЖ -
(
ЖЖ- .
$str
ЖЖ. ?
)
ЖЖ? @
;
ЖЖ@ A
return
ИИ 
Task
ИИ 
.
ИИ 

FromResult
ИИ 
<
ИИ 
IActionResult
ИИ ,
>
ИИ, -
(
ИИ- .
Ok
ИИ. 0
(
ИИ0 1
users
ИИ1 6
)
ИИ6 7
)
ИИ7 8
;
ИИ8 9
}
ЙЙ 
[
ПП 
HttpGet
ПП 
(
ПП 
$str
ПП 
)
ПП 
]
ПП 
public
РР 

async
РР 
Task
РР 
<
РР 
IActionResult
РР #
>
РР# $
GetCoins
РР% -
(
РР- .
)
РР. /
{
СС 
var
ТТ 
	coinsList
ТТ 
=
ТТ 
await
ТТ 
_dbRepository
ТТ +
.
ТТ+ ,
Get
ТТ, /
<
ТТ/ 0
CoinListInfo
ТТ0 <
>
ТТ< =
(
ТТ= >
)
ТТ> ?
.
УУ 
ToListAsync
УУ 
(
УУ 
)
УУ 
;
УУ 
return
ХХ 
Ok
ХХ 
(
ХХ 
	coinsList
ХХ 
)
ХХ 
;
ХХ 
}
ЦЦ 
[
ЬЬ 
HttpGet
ЬЬ 
(
ЬЬ 
$str
ЬЬ 
)
ЬЬ  
]
ЬЬ  !
public
ЭЭ 

async
ЭЭ 
Task
ЭЭ 
<
ЭЭ 
IActionResult
ЭЭ #
>
ЭЭ# $
GetAllCoins
ЭЭ% 0
(
ЭЭ0 1
)
ЭЭ1 2
{
ЮЮ 
var
ЯЯ 
	coinsList
ЯЯ 
=
ЯЯ 
await
ЯЯ 
_dbRepository
ЯЯ +
.
ЯЯ+ ,
Get
ЯЯ, /
<
ЯЯ/ 0
CoinListInfo
ЯЯ0 <
>
ЯЯ< =
(
ЯЯ= >
)
ЯЯ> ?
.
аа 
ToListAsync
аа 
(
аа 
)
аа 
;
аа 
return
вв 
Ok
вв 
(
вв 
	coinsList
вв 
)
вв 
;
вв 
}
гг 
[
йй 
HttpGet
йй 
(
йй 
$str
йй $
)
йй$ %
]
йй% &
public
кк 

async
кк 
Task
кк 
<
кк 
IActionResult
кк #
>
кк# $
GetCoinsDict
кк% 1
(
кк1 2
)
кк2 3
{
лл 
var
мм 
	coinsList
мм 
=
мм 
await
мм 
_dbRepository
мм +
.
мм+ ,
Get
мм, /
<
мм/ 0
CoinListInfo
мм0 <
>
мм< =
(
мм= >
)
мм> ?
.
нн 
Where
нн 
(
нн 
x
нн 
=>
нн 
x
нн 
.
нн 
IsActive
нн "
)
нн" #
.
оо 
ToListAsync
оо 
(
оо 
)
оо 
;
оо 
var
░░ 
coins
░░ 
=
░░ 
	coinsList
░░ 
.
░░ 
ToDictionary
░░ *
(
░░* +
coin
▒▒ 
=>
▒▒ 
coin
▒▒ 
.
▒▒ 
	ShortName
▒▒ "
.
▒▒" #
ToLower
▒▒# *
(
▒▒* +
)
▒▒+ ,
,
▒▒, -
coin
▓▓ 
=>
▓▓ 
coin
▓▓ 
.
▓▓ 
FullName
▓▓ !
.
▓▓! "
ToLower
▓▓" )
(
▓▓) *
)
▓▓* +
)
││ 	
;
││	 

return
┤┤ 
Ok
┤┤ 
(
┤┤ 
coins
┤┤ 
)
┤┤ 
;
┤┤ 
}
╡╡ 
[
╜╜ 
	HttpPatch
╜╜ 
(
╜╜ 
$str
╜╜  
)
╜╜  !
]
╜╜! "
public
╛╛ 

async
╛╛ 
Task
╛╛ 
<
╛╛ 
IActionResult
╛╛ #
>
╛╛# $
SetCoinStatus
╛╛% 2
(
╛╛2 3
string
╛╛3 9
coinName
╛╛: B
,
╛╛B C
bool
╛╛D H
status
╛╛I O
)
╛╛O P
{
└└ 
var
┴┴ 
coin
┴┴ 
=
┴┴ 
await
┴┴ 
_dbRepository
┴┴ &
.
┴┴& '
Get
┴┴' *
<
┴┴* +
CoinListInfo
┴┴+ 7
>
┴┴7 8
(
┴┴8 9
)
┴┴9 :
.
┬┬ 
Where
┬┬ 
(
┬┬ 
x
┬┬ 
=>
┬┬ 
x
┬┬ 
.
┬┬ 
	ShortName
┬┬ #
==
┬┬$ &
coinName
┬┬' /
)
┬┬/ 0
.
├├ !
FirstOrDefaultAsync
├├  
(
├├  !
)
├├! "
;
├├" #
if
┼┼ 

(
┼┼ 
coin
┼┼ 
==
┼┼ 
null
┼┼ 
)
┼┼ 
throw
╞╞ 
new
╞╞ %
EntityNotFoundException
╞╞ -
(
╞╞- .
$str
╞╞. @
)
╞╞@ A
;
╞╞A B
coin
╚╚ 
.
╚╚ 
IsActive
╚╚ 
=
╚╚ 
status
╚╚ 
;
╚╚ 
coin
╔╔ 
.
╔╔ 
DateUpdated
╔╔ 
=
╔╔ 
DateTime
╔╔ #
.
╔╔# $
UtcNow
╔╔$ *
;
╔╔* +
await
╩╩ 
_dbRepository
╩╩ 
.
╩╩ 
SaveChangesAsync
╩╩ ,
(
╩╩, -
)
╩╩- .
;
╩╩. /
return
╠╠ 
Ok
╠╠ 
(
╠╠ 
$str
╠╠ #
)
╠╠# $
;
╠╠$ %
}
══ 
[
╘╘ 
HttpPost
╘╘ 
(
╘╘ 
$str
╘╘  
)
╘╘  !
]
╘╘! "
public
╒╒ 

async
╒╒ 
Task
╒╒ 
<
╒╒ 
IActionResult
╒╒ #
>
╒╒# $
GetToken
╒╒% -
(
╒╒- .
string
╒╒. 4
email
╒╒5 :
)
╒╒: ;
{
╓╓ 
var
╫╫ 
response
╫╫ 
=
╫╫ 
await
╫╫ 
_authService
╫╫ )
.
╫╫) *
GetTokenAsync
╫╫* 7
(
╫╫7 8
email
╫╫8 =
)
╫╫= >
;
╫╫> ?
return
╪╪ 
Ok
╪╪ 
(
╪╪ 
response
╪╪ 
)
╪╪ 
;
╪╪ 
}
┘┘ 
}┌┌ ╗
*C:\work\BSUIR\crypto-wallet\Backend\API.cs
	namespace 	
UP
 
. 

Migrations 
; 
public 
class 
API 
{ 
private 
const 
string 
key 
= 
$str a
;a b
public 

async 
Task 
< 
double 
> 
getPrice &
(& '
string' -
	ShortName. 7
)7 8
{ 
using		 
var		 

httpClient		 
=		 
new		 "

HttpClient		# -
(		- .
)		. /
;		/ 0

httpClient

 
.

 !
DefaultRequestHeaders

 (
.

( )
Add

) ,
(

, -
$str

- ;
,

; <
key

= @
)

@ A
;

A B
var 
url 
= 
$str F
+G H
	ShortNameI R
+S T
$strU a
;a b
var 
response 
= 
await 

httpClient '
.' (
GetAsync( 0
(0 1
url1 4
)4 5
;5 6
var 
responseContent 
= 
await #
response$ ,
., -
Content- 4
.4 5
ReadAsStringAsync5 F
(F G
)G H
;H I
if 

( 
double 
. 
TryParse 
( 
responseContent +
,+ ,
out- 0
var1 4
result5 ;
); <
)< =
return 
result 
; 
return 
$num 
; 
} 
} 